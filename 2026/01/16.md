# Linux Hypervisor Setup: libvirt/qemu/kvm

```
mkandes@hardtack:~$ sudo apt-get install qemu-system
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following package was automatically installed and is no longer required:
  python3-proton-vpn-network-manager
Use 'sudo apt autoremove' to remove it.
The following additional packages will be installed:
  cpu-checker ipxe-qemu ipxe-qemu-256k-compat-efi-roms libaio1t64 libboost-iostreams1.83.0
  libboost-thread1.83.0 libcacard0 libdaxctl1 libfdt1 libiscsi7 libndctl6 libpmem1 libpmemobj1 librados2
  librbd1 librdmacm1t64 libslirp0 libspice-server1 libusbredirparser1t64 libvirglrenderer1 msr-tools ovmf
  qemu-block-extra qemu-efi-aarch64 qemu-efi-arm qemu-system-arm qemu-system-common qemu-system-data
  qemu-system-gui qemu-system-mips qemu-system-misc qemu-system-modules-opengl qemu-system-modules-spice
  qemu-system-ppc qemu-system-s390x qemu-system-sparc qemu-system-x86 qemu-utils seabios
Suggested packages:
  gstreamer1.0-libav samba vde2
The following NEW packages will be installed:
  cpu-checker ipxe-qemu ipxe-qemu-256k-compat-efi-roms libaio1t64 libboost-iostreams1.83.0
  libboost-thread1.83.0 libcacard0 libdaxctl1 libfdt1 libiscsi7 libndctl6 libpmem1 libpmemobj1 librados2
  librbd1 librdmacm1t64 libslirp0 libspice-server1 libusbredirparser1t64 libvirglrenderer1 msr-tools ovmf
  qemu-block-extra qemu-efi-aarch64 qemu-efi-arm qemu-system qemu-system-arm qemu-system-common
  qemu-system-data qemu-system-gui qemu-system-mips qemu-system-misc qemu-system-modules-opengl
  qemu-system-modules-spice qemu-system-ppc qemu-system-s390x qemu-system-sparc qemu-system-x86 qemu-utils
  seabios
0 upgraded, 40 newly installed, 0 to remove and 0 not upgraded.
Need to get 142 MB of archives.
After this operation, 1,048 MB of additional disk space will be used.
Do you want to continue? [Y/n] y
...
Setting up qemu-system-mips (1:8.2.2+ds-0ubuntu1.11) ...
Setting up qemu-system-sparc (1:8.2.2+ds-0ubuntu1.11) ...
Setting up qemu-system-x86 (1:8.2.2+ds-0ubuntu1.11) ...
Setting up qemu-system-ppc (1:8.2.2+ds-0ubuntu1.11) ...
Setting up qemu-system-misc (1:8.2.2+ds-0ubuntu1.11) ...
Setting up libpmemobj1:amd64 (1.13.1-1.1ubuntu2) ...
Setting up librbd1 (19.2.3-0ubuntu0.24.04.1) ...
Setting up qemu-system-arm (1:8.2.2+ds-0ubuntu1.11) ...
Setting up qemu-system-s390x (1:8.2.2+ds-0ubuntu1.11) ...
Setting up qemu-block-extra (1:8.2.2+ds-0ubuntu1.11) ...
Created symlink /etc/systemd/system/multi-user.target.wants/run-qemu.mount → /usr/lib/systemd/system/run-qemu.mount.
Setting up qemu-system-modules-opengl (1:8.2.2+ds-0ubuntu1.11) ...
Setting up qemu-system-gui (1:8.2.2+ds-0ubuntu1.11) ...
Setting up qemu-system (1:8.2.2+ds-0ubuntu1.11) ...
Setting up qemu-system-modules-spice (1:8.2.2+ds-0ubuntu1.11) ...
Processing triggers for hicolor-icon-theme (0.17-2) ...
Processing triggers for gnome-menus (3.36.0-1.1ubuntu3) ...
Processing triggers for libc-bin (2.39-0ubuntu8.6) ...
Processing triggers for man-db (2.12.0-4build2) ...
Processing triggers for desktop-file-utils (0.27-2build1) ...
mkandes@hardtack:~$
```

```
mkandes@hardtack:~$ sudo apt install virt-manager
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following package was automatically installed and is no longer required:
  python3-proton-vpn-network-manager
Use 'sudo apt autoremove' to remove it.
The following additional packages will be installed:
  dmeventd gir1.2-ayatanaappindicator3-0.1 gir1.2-gtk-vnc-2.0 gir1.2-gtksource-4 gir1.2-libosinfo-1.0
  gir1.2-libvirt-glib-1.0 gir1.2-spiceclientglib-2.0 gir1.2-spiceclientgtk-3.0 libdevmapper-event1.02.1
  libgtk-vnc-2.0-0 libgtksourceview-4-0 libgtksourceview-4-common libgvnc-1.0-0 libisoburn1t64
  liblvm2cmd2.03 libnss-mymachines libosinfo-1.0-0 libosinfo-l10n libphodav-3.0-0 libphodav-3.0-common
  libspice-client-glib-2.0-8 libspice-client-gtk-3.0-5 libtpms0 libusbredirhost1t64 libvirt-clients
  libvirt-daemon libvirt-daemon-config-network libvirt-daemon-config-nwfilter libvirt-daemon-driver-qemu
  libvirt-daemon-system libvirt-daemon-system-systemd libvirt-glib-1.0-0 libvirt-glib-1.0-data libvirt-l10n
  libvirt0 libxml2-utils libyajl2 lvm2 mdevctl osinfo-db python3-libvirt python3-libxml2
  spice-client-glib-usb-acl-helper swtpm swtpm-tools systemd-container thin-provisioning-tools virt-viewer
  virtinst xorriso
Suggested packages:
  gstreamer1.0-libav gstreamer1.0-plugins-bad libvirt-clients-qemu libvirt-login-shell
  libvirt-daemon-driver-storage-gluster libvirt-daemon-driver-storage-iscsi-direct
  libvirt-daemon-driver-storage-rbd libvirt-daemon-driver-storage-zfs libvirt-daemon-driver-lxc
  libvirt-daemon-driver-vbox libvirt-daemon-driver-xen numad passt auditd nfs-common open-iscsi pm-utils
  systemtap trousers python3-guestfs ssh-askpass python3-argcomplete xorriso-tcltk jigit cdck
The following NEW packages will be installed:
  dmeventd gir1.2-ayatanaappindicator3-0.1 gir1.2-gtk-vnc-2.0 gir1.2-gtksource-4 gir1.2-libosinfo-1.0
  gir1.2-libvirt-glib-1.0 gir1.2-spiceclientglib-2.0 gir1.2-spiceclientgtk-3.0 libdevmapper-event1.02.1
  libgtk-vnc-2.0-0 libgtksourceview-4-0 libgtksourceview-4-common libgvnc-1.0-0 libisoburn1t64
  liblvm2cmd2.03 libnss-mymachines libosinfo-1.0-0 libosinfo-l10n libphodav-3.0-0 libphodav-3.0-common
  libspice-client-glib-2.0-8 libspice-client-gtk-3.0-5 libtpms0 libusbredirhost1t64 libvirt-clients
  libvirt-daemon libvirt-daemon-config-network libvirt-daemon-config-nwfilter libvirt-daemon-driver-qemu
  libvirt-daemon-system libvirt-daemon-system-systemd libvirt-glib-1.0-0 libvirt-glib-1.0-data libvirt-l10n
  libvirt0 libxml2-utils libyajl2 lvm2 mdevctl osinfo-db python3-libvirt python3-libxml2
  spice-client-glib-usb-acl-helper swtpm swtpm-tools systemd-container thin-provisioning-tools virt-manager
  virt-viewer virtinst xorriso
0 upgraded, 51 newly installed, 0 to remove and 0 not upgraded.
Need to get 12.5 MB of archives.
After this operation, 53.3 MB of additional disk space will be used.
Do you want to continue? [Y/n] y
...
Created symlink /etc/systemd/system/multi-user.target.wants/virtlogd.service → /usr/lib/systemd/system/virtlo
gd.service.
Setting up libvirt-daemon dnsmasq configuration.
Setting up liblvm2cmd2.03:amd64 (2.03.16-3ubuntu3.2) ...
Setting up dmeventd (2:1.02.185-3ubuntu3.2) ...
Created symlink /etc/systemd/system/sockets.target.wants/dm-event.socket → /usr/lib/systemd/system/dm-event.s
ocket.
dm-event.service is a disabled or a static unit, not starting it.
Setting up lvm2 (2.03.16-3ubuntu3.2) ...
Created symlink /etc/systemd/system/sysinit.target.wants/blk-availability.service → /usr/lib/systemd/system/b
lk-availability.service.
Created symlink /etc/systemd/system/sysinit.target.wants/lvm2-monitor.service → /usr/lib/systemd/system/lvm2-
monitor.service.
Created symlink /etc/systemd/system/sysinit.target.wants/lvm2-lvmpolld.socket → /usr/lib/systemd/system/lvm2-
lvmpolld.socket.
Processing triggers for libglib2.0-0t64:amd64 (2.80.0-6ubuntu3.6) ...
Processing triggers for dbus (1.14.10-4ubuntu4.1) ...
Processing triggers for shared-mime-info (2.4-4) ...
Processing triggers for install-info (7.1-3build2) ...
Processing triggers for desktop-file-utils (0.27-2build1) ...
Processing triggers for initramfs-tools (0.142ubuntu25.5) ...
update-initramfs: Generating /boot/initrd.img-6.14.0-37-generic
cryptsetup: WARNING: dm_crypt-0: couldn't determine device type, assuming 
    default (plain).
cryptsetup: WARNING: Option 'cipher' missing in crypttab for plain dm-crypt 
    mapping dm_crypt-0. Please read 
    /usr/share/doc/cryptsetup-initramfs/README.initramfs.gz and add the correct 
    'cipher' option to your crypttab(5).
cryptsetup: WARNING: Option 'size' missing in crypttab for plain dm-crypt 
    mapping dm_crypt-0. Please read 
    /usr/share/doc/cryptsetup-initramfs/README.initramfs.gz and add the correct 
    'size' option to your crypttab(5).
cryptsetup: WARNING: Resume target dm_crypt-0 uses a key file
Processing triggers for hicolor-icon-theme (0.17-2) ...
Processing triggers for gnome-menus (3.36.0-1.1ubuntu3) ...
Processing triggers for libc-bin (2.39-0ubuntu8.6) ...
Processing triggers for man-db (2.12.0-4build2) ...
mkandes@hardtack:~$ 
```

```
mkandes@hardtack:~$ sudo apt install virt-viewer
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
virt-viewer is already the newest version (11.0-3build2).
virt-viewer set to manually installed.
The following package was automatically installed and is no longer required:
  python3-proton-vpn-network-manager
Use 'sudo apt autoremove' to remove it.
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
mkandes@hardtack:~$
```

```
mkandes@hardtack:~$ apt list --installed | grep dns

WARNING: apt does not have a stable CLI interface. Use with caution in scripts.

bind9-dnsutils/noble-updates,noble-security,now 1:9.18.39-0ubuntu0.24.04.2 amd64 [installed,automatic]
dns-root-data/noble-updates,now 2024071801~ubuntu0.24.04.1 all [installed,automatic]
dnsmasq-base/noble-updates,now 2.90-2ubuntu0.1 amd64 [installed,automatic]
libnss-mdns/noble,now 0.15.1-4build1 amd64 [installed,automatic]
python3-aiodns/noble,now 3.1.1-1 all [installed,automatic]
mkandes@hardtack:~$ apt install dnsmasq
E: Could not open lock file /var/lib/dpkg/lock-frontend - open (13: Permission denied)
E: Unable to acquire the dpkg frontend lock (/var/lib/dpkg/lock-frontend), are you root?
mkandes@hardtack:~$ sudo apt install dnsmasq
[sudo] password for mkandes: 
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following package was automatically installed and is no longer required:
  python3-proton-vpn-network-manager
Use 'sudo apt autoremove' to remove it.
The following NEW packages will be installed:
  dnsmasq
0 upgraded, 1 newly installed, 0 to remove and 0 not upgraded.
Need to get 17.9 kB of archives.
After this operation, 88.1 kB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu noble-updates/universe amd64 dnsmasq all 2.90-2ubuntu0.1 [17.9 kB]
Fetched 17.9 kB in 1s (33.1 kB/s)  
Selecting previously unselected package dnsmasq.
(Reading database ... 492142 files and directories currently installed.)
Preparing to unpack .../dnsmasq_2.90-2ubuntu0.1_all.deb ...
Unpacking dnsmasq (2.90-2ubuntu0.1) ...
Setting up dnsmasq (2.90-2ubuntu0.1) ...
Created symlink /etc/systemd/system/multi-user.target.wants/dnsmasq.service → /u
sr/lib/systemd/system/dnsmasq.service.
Could not execute systemctl:  at /usr/bin/deb-systemd-invoke line 148.
mkandes@hardtack:~$
```

```
mkandes@hardtack:~$ apt search dhclient
Sorting... Done
Full Text Search... Done
dhcpcd-base/noble-updates,now 1:10.0.6-1ubuntu3.2 amd64 [installed,automatic]
  DHCPv4 and DHCPv6 dual-stack client (binaries and exit hooks)

isc-dhcp-client/noble 4.4.3-P1-4ubuntu2 amd64
  DHCP client for automatically obtaining an IP address

isc-dhcp-common/noble 4.4.3-P1-4ubuntu2 amd64
  common manpages relevant to all of the isc-dhcp packages

python-aodhclient-doc/noble 3.5.1-0ubuntu1 all
  OpenStack Alarming as a Service - client doc

python3-aodhclient/noble 3.5.1-0ubuntu1 all
  OpenStack Alarming as a Service - Python 3.x client

mkandes@hardtack:~$ sudo apt-get install isc-dhcp-client
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following package was automatically installed and is no longer required:
  python3-proton-vpn-network-manager
Use 'sudo apt autoremove' to remove it.
The following additional packages will be installed:
  isc-dhcp-common
Suggested packages:
  avahi-autoipd isc-dhcp-client-ddns
The following NEW packages will be installed:
  isc-dhcp-client isc-dhcp-common
0 upgraded, 2 newly installed, 0 to remove and 0 not upgraded.
Need to get 375 kB of archives.
After this operation, 1,011 kB of additional disk space will be used.
Do you want to continue? [Y/n] y
Get:1 http://archive.ubuntu.com/ubuntu noble/universe amd64 isc-dhcp-client amd64 4.4.3-P1-4ubuntu2 [329 kB]
Get:2 http://archive.ubuntu.com/ubuntu noble/universe amd64 isc-dhcp-common amd64 4.4.3-P1-4ubuntu2 [45.8 kB]
Fetched 375 kB in 1s (485 kB/s)           
Selecting previously unselected package isc-dhcp-client.
(Reading database ... 492219 files and directories currently installed.)
Preparing to unpack .../isc-dhcp-client_4.4.3-P1-4ubuntu2_amd64.deb ...
Unpacking isc-dhcp-client (4.4.3-P1-4ubuntu2) ...
Selecting previously unselected package isc-dhcp-common.
Preparing to unpack .../isc-dhcp-common_4.4.3-P1-4ubuntu2_amd64.deb ...
Unpacking isc-dhcp-common (4.4.3-P1-4ubuntu2) ...
Setting up isc-dhcp-client (4.4.3-P1-4ubuntu2) ...
Setting up isc-dhcp-common (4.4.3-P1-4ubuntu2) ...
Processing triggers for man-db (2.12.0-4build2) ...
mkandes@hardtack:~$
```

```
mkandes@hardtack:~$ apt list --installed | grep dmidecode

WARNING: apt does not have a stable CLI interface. Use with caution in scripts.

dmidecode/noble-updates,now 3.5-3ubuntu0.1 amd64 [installed,automatic]
mkandes@hardtack:~$
```

```
mkandes@hardtack:~$ apt list --installed | grep ebtables

WARNING: apt does not have a stable CLI interface. Use with caution in scripts.

mkandes@hardtack:~$ sudo apt install ebtables
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following package was automatically installed and is no longer required:
  python3-proton-vpn-network-manager
Use 'sudo apt autoremove' to remove it.
The following NEW packages will be installed:
  ebtables
0 upgraded, 1 newly installed, 0 to remove and 0 not upgraded.
Need to get 88.4 kB of archives.
After this operation, 287 kB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu noble/main amd64 ebtables amd64 2.0.11-6build1 [88.4 kB]
Fetched 88.4 kB in 1s (173 kB/s)  
Selecting previously unselected package ebtables.
(Reading database ... 492164 files and directories currently installed.)
Preparing to unpack .../ebtables_2.0.11-6build1_amd64.deb ...
Unpacking ebtables (2.0.11-6build1) ...
Setting up ebtables (2.0.11-6build1) ...
Processing triggers for man-db (2.12.0-4build2) ...
mkandes@hardtack:~$
```

```
mkandes@hardtack:~$ apt list --installed | grep bridge

WARNING: apt does not have a stable CLI interface. Use with caution in scripts.

libatk-bridge2.0-0t64/noble,now 2.52.0-1build1 amd64 [installed,automatic]
mkandes@hardtack:~$ sudo apt install bridge-utils
[sudo] password for mkandes: 
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following package was automatically installed and is no longer required:
  python3-proton-vpn-network-manager
Use 'sudo apt autoremove' to remove it.
Suggested packages:
  ifupdown
The following NEW packages will be installed:
  bridge-utils
0 upgraded, 1 newly installed, 0 to remove and 0 not upgraded.
Need to get 33.9 kB of archives.
After this operation, 118 kB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu noble/main amd64 bridge-utils amd64 1.7.1-1ubuntu2 [33.9 kB]
Fetched 33.9 kB in 0s (125 kB/s)      
Selecting previously unselected package bridge-utils.
(Reading database ... 492189 files and directories currently installed.)
Preparing to unpack .../bridge-utils_1.7.1-1ubuntu2_amd64.deb ...
Unpacking bridge-utils (1.7.1-1ubuntu2) ...
Setting up bridge-utils (1.7.1-1ubuntu2) ...
Processing triggers for man-db (2.12.0-4build2) ...
mkandes@hardtack:~$
```

```
mkandes@hardtack:~$ apt list --installed | grep netcat

WARNING: apt does not have a stable CLI interface. Use with caution in scripts.

netcat-openbsd/noble,now 1.226-1ubuntu2 amd64 [installed,automatic]
mkandes@hardtack:~$ sudo apt install netcat
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
Package netcat is a virtual package provided by:
  netcat-traditional 1.10-48
  netcat-openbsd 1.226-1ubuntu2
You should explicitly select one to install.

E: Package 'netcat' has no installation candidate
mkandes@hardtack:~$
```

# Reference(s):
- https://www.youtube.com/watch?v=HfNKpT2jo7U&t=66s
- https://en.wikipedia.org/wiki/Kernel-based_Virtual_Machine
- https://linux-kvm.org
- https://en.wikipedia.org/wiki/QEMU
- https://www.qemu.org
- https://en.wikipedia.org/wiki/Libvirt
- https://libvirt.org
- https://www.libvirt.org/manpages/virsh.html
- https://en.wikipedia.org/wiki/Virt-manager
- https://virt-manager.org
- https://en.wikipedia.org/wiki/Dnsmasq
- https://thekelleys.org.uk/dnsmasq/doc.html
- https://en.wikipedia.org/wiki/Dmidecode
- https://www.nongnu.org/dmidecode
- https://en.wikipedia.org/wiki/Netfilter
- https://netfilter.org
- https://ebtables.netfilter.org
- https://en.wikipedia.org/wiki/Netcat
- https://nc110.sourceforge.io
- 
