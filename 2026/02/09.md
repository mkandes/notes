# Setup ZFS snapshots

```
mkandes@hardtack:~$ zfs list -t snapshot
no datasets available
mkandes@hardtack:~$
```

```
mkandes@hardtack:~$ zfs list
NAME                                               USED  AVAIL  REFER  MOUNTPOINT
bpool                                              217M  1.54G    96K  /boot
bpool/BOOT                                         216M  1.54G    96K  none
bpool/BOOT/ubuntu_ybsehk                           216M  1.54G   216M  /boot
rpool                                              613G  1.19T   192K  /
rpool/ROOT                                        21.8G  1.19T   192K  none
rpool/ROOT/ubuntu_ybsehk                          21.8G  1.19T  13.2G  /
rpool/ROOT/ubuntu_ybsehk/srv                       192K  1.19T   192K  /srv
rpool/ROOT/ubuntu_ybsehk/usr                       664K  1.19T   192K  /usr
rpool/ROOT/ubuntu_ybsehk/usr/local                 472K  1.19T   472K  /usr/local
rpool/ROOT/ubuntu_ybsehk/var                      8.60G  1.19T   192K  /var
rpool/ROOT/ubuntu_ybsehk/var/games                 192K  1.19T   192K  /var/games
rpool/ROOT/ubuntu_ybsehk/var/lib                  8.47G  1.19T  8.29G  /var/lib
rpool/ROOT/ubuntu_ybsehk/var/lib/AccountsService   212K  1.19T   212K  /var/lib/AccountsService
rpool/ROOT/ubuntu_ybsehk/var/lib/NetworkManager    684K  1.19T   684K  /var/lib/NetworkManager
rpool/ROOT/ubuntu_ybsehk/var/lib/apt               101M  1.19T   101M  /var/lib/apt
rpool/ROOT/ubuntu_ybsehk/var/lib/dpkg             84.5M  1.19T  84.5M  /var/lib/dpkg
rpool/ROOT/ubuntu_ybsehk/var/log                   121M  1.19T   121M  /var/log
rpool/ROOT/ubuntu_ybsehk/var/mail                  192K  1.19T   192K  /var/mail
rpool/ROOT/ubuntu_ybsehk/var/snap                 4.17M  1.19T  4.17M  /var/snap
rpool/ROOT/ubuntu_ybsehk/var/spool                2.80M  1.19T  2.80M  /var/spool
rpool/ROOT/ubuntu_ybsehk/var/www                   192K  1.19T   192K  /var/www
rpool/USERDATA                                     591G  1.19T   192K  none
rpool/USERDATA/home_fdun0v                         591G  1.19T   591G  /home
rpool/USERDATA/root_fdun0v                         688K  1.19T   688K  /root
rpool/keystore                                    22.5M  1.19T  16.5M  -
mkandes@hardtack:~$
```

```
mkandes@hardtack:~$ sudo zfs allow mkandes snapshot rpool/USERDATA/home_fdun0v
[sudo] password for mkandes: 
mkandes@hardtack:~$
```

```
mkandes@hardtack:~$ zfs allow rpool/USERDATA/home_fdun0v
---- Permissions on rpool/USERDATA/home_fdun0v -----------------------
Local+Descendent permissions:
	user mkandes snapshot
mkandes@hardtack:~$
```

```
mkandes@hardtack:~$ zfs snapshot rpool/USERDATA/home_fdun0v@snapshot-$(date -u +'%Y%m%dT%H%M%S')
mkandes@hardtack:~$ zfs list -t snapshot
NAME                                                  USED  AVAIL  REFER  MOUNTPOINT
rpool/USERDATA/home_fdun0v@snapshot-20260210T035238   700K      -   591G  -
mkandes@hardtack:~$
```

```
mkandes@hardtack:~$ zfs diff rpool/USERDATA/home_fdun0v@snapshot-20260210T035238
Unable to obtain diffs: 
   The sys_mount privilege or diff delegated permission is needed
   to execute the diff ioctl
mkandes@hardtack:~$ zfs allow mkandes diff rpool/USERDATA/home_fdun0v
cannot set permissions on 'rpool/USERDATA/home_fdun0v': permission denied
mkandes@hardtack:~$ sudo zfs allow mkandes diff rpool/USERDATA/home_fdun0v
[sudo] password for mkandes: 
mkandes@hardtack:~$ zfs allow rpool/USERDATA/home_fdun0v
---- Permissions on rpool/USERDATA/home_fdun0v -----------------------
Local+Descendent permissions:
	user mkandes diff,snapshot
mkandes@hardtack:~$
```

```
mkandes@hardtack:~$ zfs diff rpool/USERDATA/home_fdun0v@snapshot-20260210T035238
M	/home/mkandes/.local/state/wireplumber
M	/home/mkandes/.local/share/gnome-shell
M	/home/mkandes/.config/google-chrome/Profile\00402/DIPS-wal
M	/home/mkandes/.cache/google-chrome/Profile\00402/Code\0040Cache/js/a7d6890432818909_0
M	/home/mkandes/.cache/google-chrome/Profile\00402/Code\0040Cache/js/37a202c0e6ee2278_0
M	/home/mkandes/.cache/google-chrome/Profile\00402/Code\0040Cache/js/9215c416c9667f87_0
M	/home/mkandes/.cache/google-chrome/Profile\00402/Code\0040Cache/js/ebbd6841d8a06572_0
M	/home/mkandes/.cache/google-chrome/Profile\00402/Code\0040Cache/js/11f302423f43e305_0
M	/home/mkandes/.cache/google-chrome/Profile\00402/Code\0040Cache/js/f51ea50eaba87670_0
M	/home/mkandes/.config/google-chrome
M	/home/mkandes/.cache/google-chrome/Profile\00402/Code\0040Cache/js/98c988c9e1ed1e45_0
M	/home/mkandes/.cache/google-chrome/Profile\00402/Code\0040Cache/js/c5bd73ae917d90bc_0
M	/home/mkandes/.config/google-chrome/ShaderCache/data_1
M	/home/mkandes/.config/google-chrome/segmentation_platform/ukm_db
M	/home/mkandes/.config/google-chrome/segmentation_platform/ukm_db-wal
M	/home/mkandes/.config/google-chrome/GrShaderCache/data_1
M	/home/mkandes/.config/google-chrome/GraphiteDawnCache/data_1
M	/home(on_delete_queue)
M	/home/mkandes/.config/google-chrome/Profile\00402/Search\0040Logos/metadata
M	/home/mkandes/.config/mozilla/firefox/n7dfuz0w.default-release/storage/default/moz-extension+++59251aff-dd52-4a4b-a3b4-6a04fe36a749^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite
M	/home/mkandes/.config/mozilla/firefox/n7dfuz0w.default-release/storage/default/moz-extension+++59251aff-dd52-4a4b-a3b4-6a04fe36a749^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite-wal
M	/home/mkandes/.config/google-chrome/Profile\00402/shared_proto_db/000007.log
M	/home/mkandes/.config/mozilla/firefox/n7dfuz0w.default-release/storage/private/uuid+++e1d17977-4f1a-419b-b578-c92c01274122/idb/eab70d39-3f0f-4700-8a4c-6503fb387576.sqlite
M	/home/mkandes/.config/mozilla/firefox/n7dfuz0w.default-release/storage/private/uuid+++e1d17977-4f1a-419b-b578-c92c01274122/idb/eab70d39-3f0f-4700-8a4c-6503fb387576.sqlite-wal
M	/home/mkandes/.cache/google-chrome/Profile\00402/Code\0040Cache/js/51e46a9df85d20ce_0
M	/home/mkandes/.cache/google-chrome/Profile\00402/Code\0040Cache/js/e6e8fce2eb0cec62_0
M	/home/mkandes/.cache/google-chrome/Profile\00402/Code\0040Cache/js/40b99e64aee22a36_0
-	/home/mkandes/.config/google-chrome/Profile\00402/WebStorage/102/CacheStorage/index.txt
M	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/a493883b13da359b_0
M	/home/mkandes/.cache/google-chrome/Profile\00402/Code\0040Cache/js/d61806c924e0f534_0
M	/home/mkandes/.cache/google-chrome/Profile\00402/Code\0040Cache/js/363aabdb1655a7cd_0
M	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/95d05a5d121ca1fb_0
M	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/4a85c98d9b86322c_0
M	/home/mkandes/.cache/google-chrome/Profile\00402/Code\0040Cache/js/a31591e8ca13b311_0
M	/home/mkandes/.cache/google-chrome/Profile\00402/Code\0040Cache/js/fb6611ac4462543c_0
M	/home/mkandes/.cache/google-chrome/Profile\00402/Code\0040Cache/js/aa84a12f4e82c2ef_0
M	/home/mkandes/.cache/google-chrome/Profile\00402/Code\0040Cache/js/a93935418c899dd3_0
M	/home/mkandes/.cache/google-chrome/Profile\00402/Code\0040Cache/js/d7f0c1d21993ec29_0
M	/home/mkandes/.cache/google-chrome/Profile\00402/Code\0040Cache/js/3ba90c23b004e7cf_0
M	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/b25cbd1194774f60_0
M	/home/mkandes/.config/google-chrome/Profile\00402/GPUCache/data_1
M	/home/mkandes/.config/google-chrome/Profile\00402/DawnWebGPUCache/data_1
M	/home/mkandes/.config/google-chrome/Profile\00402/DawnGraphiteCache/data_1
M	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/4cacbe29e41d5f50_0
M	/home/mkandes/.config/google-chrome/Profile\00402/Local\0040Storage/leveldb/000176.log
M	/home/mkandes/.config/google-chrome/Profile\00402/WebStorage/102/CacheStorage
M	/home/mkandes/.cache/google-chrome/Profile\00402/Code\0040Cache/js/6766246fb0bcc0b1_0
M	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/7c300404264c5c17_0
M	/home/mkandes/.config/mozilla/firefox/n7dfuz0w.default-release/datareporting
M	/home/mkandes/.config/mozilla/firefox/n7dfuz0w.default-release/datareporting/glean/db
M	/home/mkandes/.config/google-chrome/Profile\00402/Session\0040Storage/000854.log
-	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/fb445643a55aa1f3_0
-	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/08753200ec2848af_0
-	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/93d81321f8c35eab_0
-	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/968de8d4bd83f689_0
M	/home/mkandes/.cache/google-chrome/Profile\00402/Code\0040Cache/js/b20d8d3af0202b50_0
-	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/8774f6c8836d2c66_0
-	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/34b4ef0d277b8e33_0
-	/home/mkandes/.config/google-chrome/Profile\00402/Sessions/Session_13415168825770200
-	/home/mkandes/.config/google-chrome/Local\0040State
-	/home/mkandes/.local/share/gnome-shell/application_state
-	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/61c81ff7cb3915e4_0
-	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/15145040f7f12f31_0
-	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/80321105df21a3da_0
-	/home/mkandes/.config/google-chrome/Profile\00402/Sessions/Session_13415168894551159
-	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/index-dir/the-real-index
-	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/todelete_e9368e3781ae21d4_0_6
+	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/6d60c763e0d84d18_0
+	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/2f37c1422557e4ce_0
+	/home/mkandes/.config/google-chrome/Local\0040State
+	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/c4a14a935393db14_0
+	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/5ec14a2f01fa37ea_0
M	/home/mkandes/.cache/google-chrome/Profile\00402/Code\0040Cache/js/df0f570410e92c66_0
-	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/fe31d1dc9e9d3063_0
M	/home/mkandes/.config/google-chrome/Profile\00402/WebStorage/102/IndexedDB/indexeddb.leveldb/000004.log
-	/home/mkandes/.config/mozilla/firefox/n7dfuz0w.default-release/datareporting/aborted-session-ping
-	/home/mkandes/.config/google-chrome/Profile\00402/Network\0040Persistent\0040State
+	/home/mkandes/.cache/google-chrome/Profile\00402/Code\0040Cache/js/805a5292e5656e47_0
-	/home/mkandes/.config/mozilla/firefox/n7dfuz0w.default-release/datareporting/glean/db/data.safe.bin
+	/home/mkandes/.config/mozilla/firefox/n7dfuz0w.default-release/datareporting/glean/db/data.safe.bin
+	/home/mkandes/.config/google-chrome/Profile\00402/Sessions/Session_13415169205843178
+	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/b39f516fa164b425_0
+	/home/mkandes/.cache/google-chrome/Profile\00402/Code\0040Cache/js/9cbf7138ea1a56d8_0
+	/home/mkandes/.cache/google-chrome/Profile\00402/Code\0040Cache/js/494730297e0da4ba_0
+	/home/mkandes/.cache/google-chrome/Profile\00402/Code\0040Cache/js/index-dir/the-real-index
+	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/80321105df21a3da_0
+	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/968de8d4bd83f689_0
+	/home/mkandes/.cache/google-chrome/Profile\00402/Code\0040Cache/js/acd40d7ae7a06042_0
+	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/e686b3b22fb480d6_0
+	/home/mkandes/.config/google-chrome/Profile\00402/WebStorage/102/CacheStorage/index.txt
+	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/fb445643a55aa1f3_0
+	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/34b4ef0d277b8e33_0
+	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/ae156d7760207967_0
+	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/index-dir/the-real-index
+	/home/mkandes/.local/share/gnome-shell/application_state
+	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/15145040f7f12f31_0
+	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/93d81321f8c35eab_0
+	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/8774f6c8836d2c66_0
+	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/2c0c3656ef7df751_0
+	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/89b3196c4077f89b_0
+	/home/mkandes/.config/mozilla/firefox/n7dfuz0w.default-release/datareporting/aborted-session-ping
+	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/c2af85e2401ddc7b_0
+	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/b274af59cf9a7b0b_0
+	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/1cefd1829af7274d_0
-	/home/mkandes/.local/state/wireplumber/restore-stream
+	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/885b6d705410ae44_0
+	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/3c701f30601dd963_0
-	/home/mkandes/.cache/google-chrome/Profile\00402/Code\0040Cache/js/index-dir/the-real-index
-	/home/mkandes/.config/google-chrome/Profile\00402/Preferences
+	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/61c81ff7cb3915e4_0
+	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/08753200ec2848af_0
+	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/79e4fa5fe6113f2b_0
+	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/7d8fde8baa31509e_0
+	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/2fed611690c24307_0
+	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/7f72576afef97626_0
+	/home/mkandes/.local/state/wireplumber/restore-stream
+	/home/mkandes/.config/google-chrome/Profile\00402/Network\0040Persistent\0040State
+	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/32516f600e40580a_0
+	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/fe31d1dc9e9d3063_0
+	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/e9368e3781ae21d4_0
+	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/49bab7cc037b7add_0
+	/home/mkandes/.config/google-chrome/Profile\00402/Sessions/Session_13415169377195899
+	/home/mkandes/.config/google-chrome/Profile\00402/Preferences
M	/home/mkandes/.config/google-chrome/Profile\00402/History
M	/home/mkandes/.config/google-chrome/Profile\00402/History-journal
M	/home/mkandes/.cache/google-chrome/Profile\00402/Code\0040Cache/js
M	/home/mkandes/.config/google-chrome/Profile\00402
M	/home/mkandes/.cache/google-chrome/Profile\00402/Code\0040Cache/js/index-dir
M	/home/mkandes/.config/google-chrome/Profile\00402/Shared\0040Dictionary/db
M	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data
M	/home/mkandes/.cache/google-chrome/Profile\00402/Cache/Cache_Data/index-dir
M	/home/mkandes/.config/google-chrome/Profile\00402/Web\0040Data
M	/home/mkandes/.config/google-chrome/Profile\00402/Web\0040Data-journal
M	/home/mkandes/.config/google-chrome/Profile\00402/Favicons
M	/home/mkandes/.config/google-chrome/Profile\00402/Favicons-journal
M	/home/mkandes/.config/google-chrome/Profile\00402/Reporting\0040and\0040NEL
M	/home/mkandes/.config/google-chrome/Profile\00402/Reporting\0040and\0040NEL-journal
M	/home/mkandes/.config/google-chrome/Profile\00402/WebStorage/QuotaManager
M	/home/mkandes/.config/google-chrome/Profile\00402/WebStorage/QuotaManager-journal
M	/home/mkandes/.config/google-chrome/Profile\00402/Cookies
M	/home/mkandes/.config/google-chrome/Profile\00402/Cookies-journal
M	/home/mkandes/.config/google-chrome/Profile\00402/Sessions
M	/home/mkandes/.config/google-chrome/Profile\00402/Shared\0040Dictionary/db-journal
M	/home/mkandes/.config/google-chrome/Profile\00402/Network\0040Action\0040Predictor
M	/home/mkandes/.config/google-chrome/Profile\00402/Network\0040Action\0040Predictor-journal
M	/home/mkandes/.config/google-chrome/Profile\00402/Shortcuts
M	/home/mkandes/.config/google-chrome/Profile\00402/Shortcuts-journal
mkandes@hardtack:~$
```

# Reference(s):
- https://www.dwarmstrong.org/zfs-snapshots/
- https://klarasystems.com/articles/basics-of-zfs-snapshot-management/
- https://klarasystems.com/articles/introduction-to-zfs-replication/
- https://ubuntu.com/tutorials/using-zfs-snapshots-clones#1-overview
- https://docs.oracle.com/cd/E23824_01/html/821-1448/gavvx.html
