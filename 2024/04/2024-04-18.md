# Developing a new Spack instance

To begin the development of a new Spack instance that will be merged into one of SDSC's deployment branches, login into the HPC system where the new instance will be developed, tested, and, eventually, deployed. 

```
mkandes@hardtack:~$ ssh mkandes@login.expanse.sdsc.edu
Welcome to Bright release         9.0

                                                         Based on Rocky Linux 8
                                                                    ID: #000002

--------------------------------------------------------------------------------

                                 WELCOME TO
                  _______  __ ____  ___    _   _______ ______
                 / ____/ |/ // __ \/   |  / | / / ___// ____/
                / __/  |   // /_/ / /| | /  |/ /\__ \/ __/
               / /___ /   |/ ____/ ___ |/ /|  /___/ / /___
              /_____//_/|_/_/   /_/  |_/_/ |_//____/_____/

--------------------------------------------------------------------------------

Use the following commands to adjust your environment:

'module avail'            - show available modules
'module add <module>'     - adds a module to your environment for this session
'module initadd <module>' - configure module to be loaded at every login

-------------------------------------------------------------------------------
Last login: Mon Apr 15 08:49:01 2024 from 208.58.212.11
[mkandes@login01 ~]$
```

If you do not have a copy of your personal fork of the sdsc/spack repository on this system, then clone the fork to your HOME directory.

```
[mkandes@login01 ~]$ cd software/spack/
[mkandes@login01 spack]$ ls
releases  repositories
[mkandes@login01 spack]$ cd repositories/
[mkandes@login01 repositories]$ ls
sdsc  spack
[mkandes@login01 repositories]$ mkdir mkandes
[mkandes@login01 repositories]$ cd mkandes/
[mkandes@login01 mkandes]$ git clone https://github.com/mkandes/spack.git
Cloning into 'spack'...
remote: Enumerating objects: 563831, done.
remote: Counting objects: 100% (1/1), done.
remote: Total 563831 (delta 0), reused 0 (delta 0), pack-reused 563830
Receiving objects: 100% (563831/563831), 240.74 MiB | 38.71 MiB/s, done.
Resolving deltas: 100% (261513/261513), done.
Updating files: 100% (12424/12424), done.
[mkandes@login01 mkandes]$
```

Once your fork is cloned, enter the top-level directory of the repository and check that the current default branch in your fork is the deployment branch to which the new instance should be added.

```
[mkandes@login02 mkandes]$ cd spack/
[mkandes@login02 spack]$ pwd
/home/mkandes/software/spack/repositories/mkandes/spack
[mkandes@login02 spack]$ git branch
* sdsc-0.17.3
[mkandes@login02 spack]$
```

If it is, then before you proceed make sure to fetch any changes and resync your copy of the deployment branch with the sdsc/spack upstream repository. 

```
[mkandes@login02 spack]$ git remote -v
[mkandes@login02 spack]$ git remote add upstream https://github.com/sdsc/spack.git
[mkandes@login02 spack]$ git remote -v
origin	https://github.com/mkandes/spack.git (fetch)
origin	https://github.com/mkandes/spack.git (push)
upstream	https://github.com/sdsc/spack.git (fetch)
upstream	https://github.com/sdsc/spack.git (push)
[mkandes@login02 spack]$ git fetch --tags upstream
remote: Enumerating objects: 16388, done.
remote: Counting objects: 100% (5027/5027), done.
remote: Total 16388 (delta 5027), reused 5027 (delta 5027), pack-reused 11361
Receiving objects: 100% (16388/16388), 196.24 MiB | 4.35 MiB/s, done.
Resolving deltas: 100% (9868/9868), completed with 1191 local objects.
From https://github.com/sdsc/spack
 * [new branch]            FASTMath/ATPESC18                     -> upstream/FASTMath/ATPESC18
 * [new branch]            FASTMath/ATPESC19                     -> upstream/FASTMath/ATPESC19
 * [new branch]            PR/openblas                           -> upstream/PR/openblas
...
 * [new branch]            sdsc-0.15.4                           -> upstream/sdsc-0.15.4
 * [new branch]            sdsc-0.17.1                           -> upstream/sdsc-0.17.1
 * [new branch]            sdsc-0.17.2                           -> upstream/sdsc-0.17.2
 * [new branch]            sdsc-0.17.3                           -> upstream/sdsc-0.17.3
 * [new branch]            sdsc-0.18.0                           -> upstream/sdsc-0.18.0
 * [new branch]            sdsc-0.19.1                           -> upstream/sdsc-0.19.1
 * [new branch]            separate-wrapper-decorator            -> upstream/separate-wrapper-decorator
 * [new branch]            shorten-install-status-help           -> upstream/shorten-install-status-help
 * [new branch]            silo-qt4                              -> upstream/silo-qt4
 * [new branch]            spacktivate                           -> upstream/spacktivate
 * [new branch]            spec-language-ideas                   -> upstream/spec-language-ideas
 * [new branch]            spec-parse-inequalities               -> upstream/spec-parse-inequalities
 * [new branch]            spec-target-flag-option               -> upstream/spec-target-flag-option
 * [new branch]            stacks-debugging                      -> upstream/stacks-debugging
 * [new branch]            test-gitlab-check-stays-pending       -> upstream/test-gitlab-check-stays-pending
 * [new branch]            test/v0.13-with-fast-environments     -> upstream/test/v0.13-with-fast-environments
 * [new branch]            testing/wip_xsdk                      -> upstream/testing/wip_xsdk
 * [new branch]            tests/vtk-m-smoke-test-fix            -> upstream/tests/vtk-m-smoke-test-fix
 * [new branch]            topic-libSplash160                    -> upstream/topic-libSplash160
 * [new branch]            tutorials/advanced_packaging          -> upstream/tutorials/advanced_packaging
 * [new branch]            update/ipopt                          -> upstream/update/ipopt
 * [new branch]            v-dobrev/extend-default-spec-queries  -> upstream/v-dobrev/extend-default-spec-queries
 * [new branch]            vendor-clingo                         -> upstream/vendor-clingo
 * [new branch]            z3-bootstrap-2.6                      -> upstream/z3-bootstrap-2.6
 * [new branch]            z3-concretizer                        -> upstream/z3-concretizer
 ! [rejected]              releases/latest                       -> releases/latest  (would clobber existing tag)
[mkandes@login02 spack]$ git push
Username for 'https://github.com': mkandes
Password for 'https://mkandes@github.com': 
Everything up-to-date
[mkandes@login02 spack]$ git push --tags
Everything up-to-date
[mkandes@login02 spack]$
```
