# ARA Experiments

### "Hello World!" Experiment

Let's start again by repeating the ["Hello World!" Experiment](https://arawireless.readthedocs.io/en/latest/ara_experiments/ara_hello_world.html#hello-world-experiment) at the Agronomy Farm to see if there have been any updates to the list of containers available and/or ability to access its GPUs. 

After you login to the [ARA Portal](https://portal.arawireless.org) and have access to the [OpenStack Horizon Dashboad](https://docs.openstack.org/horizon/latest), set the [**Timezone**](https://arawireless.readthedocs.io/en/latest/getting_started/started_with_ara_portal.html#setting-the-user-time-zone) that you will use to specify the start and end dates (and times) for ARA leases. It's best to use your local timezone. Unfortuantely, however, the **Timezone** must be reset upon each login from its default [UTC](https://en.wikipedia.org/wiki/Coordinated_Universal_Time) setting as your choice of timezone is only stored temporarily within your current broswer session and not in your ARA user account configuration. 

To set the **Timezone**, select the *Settings* option from the drop-down menu associated with your username and the user icon in the upper right hand side of the dashboard. Once selected, the *User Settings* category will be displayed. Choose your local **Timezone** from the drop-down list available and then click the **Save** button to complete your change(s).

- **Language**: English (en)
- **Timezone**: UTC -07:00: United States (Los Angeles) Time
- **Items Per Page**: 20
- **Log Lines Per Instance**: 35

Any time you want to utilize the specialized resources made available as part of ARA, you must create a reservation and lease those resources for a specified amount of time. 

To create a lease, navigate to the *Project* tab, select *Reservations*, then click on the *Leases* category. Next, find the **+ create Lease** button on the right hand side of the *Leases* page and click it. A *Create Lease* pop-up window will be displayed. The initial *General* tab that the pop-up window opens with has three free-form text fields

- **Lease Name**: User-provided name for the lease, which must be unique across ARA 
- **Start Date**: Start date (and time) of the lease
- **End Date**: End date (and time) of the lease
  
Start by providing a **Lease Name**. Note, however, the name cannot contain certain characters. e.g., dashes are prohibited, but underscores are allowed. Next, enter the **Start Date** and **End Date** for the lease. The format to use is YYYY-MM-DD HH:MM and the maximum lease time for any reservation is up to 5 hours. If you do not specify a specific **Start Date** and **End Date** for the lease, the default lease time is 2 hours starting immediately (or when possible; i.e., if and when the resources requested are available). 

- **Lease Name**: mckandes_hello_world
- **Start Date**:
- **End Date**:

After providing the *General* lease settings, click the **Next** button in the bottom right of the pop-up window to move to the *Resources* tab. Here, you will be presented with 3 drop-down lists

- **Site**: ARA site where the requested resources are located 
- **Resource Type**: List of available resource types at the selected site
- **Device Type**: Specific type of device requested
  
and one free-form text field

- **Device ID**: Specific ID associated with the requsted device

To run this experiment on the Agronomy Farm's Edge Compute Node, select:

- **Site**: Agronomy Farm
- **Resource Type**: Compute Node
- **Device Type**: Edge
- **Device ID**: 000

The list of all available resources can be found in the *Project -> Summary* tab by clicking on *Overview*  category. A similar list is available in the ARA documentation [here](https://arawireless.readthedocs.io/en/latest/ara_technical_manual/ara_resource_specification.html). 

With all of the information required for the *General* and *Resources* tab, hit the **Create Lease** button to start the lease creation process. Once the lease **Status** becomes *Active*, you may procceed with creating a container that will run on the requested resources. 

To create the container, select the *Containers* category from the *Project -> Container* tab of the dashboard and then click on the **Create Container** button. A *Create Container* pop-up window will be displayed. The initial *Info* tab that the pop-up window opens with has three free-form text fields

- **Name**: User-provided name for the container instance to be created and run
- **Image**: Name (and tag) of the specific [arawirelesshub](https://hub.docker.com/u/arawirelesshub) container image available from DockerHub
- **Command**: Command that will be run within the container once it starts

two drop-down lists

- **Image Driver**: Selects the source of the container images; e.g. DockerHub
- **Image Pull Policy**: Sets the pull policy for the container --- *If not present*, *Always*, or *Never*

and one checkbox button

- [x] **Start container after creation**

At this time, you can only start your containers from the official container **Image**(s)  published by ARA and made available from the [arawirelesshub](https://hub.docker.com/u/arawirelesshub) community user account on DockerHub. For this experiment, choose the standarad Ubuntu 22.04 LTS container `arawirelesshub/ara-ubuntu:22.04` as the **Image** and set the **Command** to `/bin/bash` for interactive use. 

- **Name**: mckandes-hello-world-ubuntu
- **Image**: arawirelesshub/ara-ubuntu:22.04
- **Image Driver**: Docker Hub
- **Image Pull Policy**: Always
- **Command**: /bin/bash
- [x] **Start container after creation**

Next, go to the *Spec* tab, which has three free-form text fields

- **Hostname**: User-provided hostname for the container instance
- **CPU**: Number of virtual CPUs for the container instance
- **Memory**: Amount of memory for the container instance in MiB

and a drop-down list

- **Lease Name**

For this experiment, we'll set the hostname to indicate the ARA site and resource the container is running on and then select the lease created above from **Lease Name** drop-down list. You may leave the **CPU** and **Memory** fields blank as by default ARA should allocate to the container the total number of CPUs and memory available on the requested resource as each lease for an individual resource is exclusive per user while in use.

- **Hostname**: ag-farm-edge-node
- **CPU**:
- **Memory**:
- **Lease Name**: mckandes_hello_world

And finally, go to the *Networks* tab and select the **Network** into which the container and leased resources will be allocated. By default, each user starts with only the *ARA_Shared_Net* available. Select the *ARA_Shared_Net* as your network by clicking the up arrow that appears to the right-hand side of the line in the *Available* list. This will move the network from *Available* list to the *Allocated* list. Then hit the **Create** button to complete the container creation process. 

Once the container **Status** is *Running*, go ahead and check the container information and properties by clicking on the **Name** link in the *Containers* category list of items. Here is an example summary of the information provided by the container *Overview* tab.


Info
- **ID**: fe6ce273-6a19-421c-a277-4d55502fbe9d
- **Name**: mckandes-hello-world-ubuntu
- **Status**: Running
- **Status Detail**: Up 29 seconds
- **Status Reason**: -
- **Task State**": -
- **Command**: /bin/bash

Spec
- **Image**: arawirelesshub/ara-ubuntu:22.04
- **Image Driver**: docker
- **Image Pull Policy**: always
- **Hostname**: ag-farm-edge-node
- **Runtime**: runc
- **CPU**: 1
- **Memory**: 512
- **Disk**: 0 GB
- **Restart Policy**: {}
- **Auto Remove**: No
- **Auto Heal**: No
- **Addresses**: [ { "Port IP address": "10.0.4.14", "Floating IP address": "10.189.11.249" } ]
- **Ports**: []
- **Security Groups**: [ "12ae0b26-622b-4bbc-9be4-734fd49ffe25" ]

Miscellaneous
- **Host**: AgronomyFarm-Edge-000
- **Workdir**: -
- **Environment**: { "reservation_id": "cd33682e-5622-492c-b825-c57db6be0f50", "reservation_type": "NORMAL" }
- **Interactive**: Yes
- **Labels**": {}
- **Links**: [ { "href": "http://controller1intha.ara.iastate.edu:9517/v1/containers/fe6ce273-6a19-421c-a277-4d55502fbe9d", "rel": "self" }, { "href": "http://controller1intha.ara.iastate.edu:9517/containers/fe6ce273-6a19-421c-a277-4d55502fbe9d", "rel": "bookmark" } ]

Next, we'll attempt to login to the container via SSH through the [ARA Jumpbox](https://arawireless.readthedocs.io/en/latest/getting_started/ara_portal_extras.html#ara-jumpbox) using the *Floating IP address* associated with the container. 

```
mckandes@ara-jbox:~$ ssh -A jbox.arawireless.org
The authenticity of host 'jbox.arawireless.org (64.113.95.226)' can't be established.
ECDSA key fingerprint is SHA256:/jV3QvzyCB9Xnarx/MBtBU75m1O20ozup+m8h0CmnVk.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added 'jbox.arawireless.org,64.113.95.226' (ECDSA) to the list of known hosts.
mckandes@ara-jbox:~$ ssh root@10.189.11.249
ssh: connect to host 10.189.11.249 port 22: Connection refused
mckandes@ara-jbox:~$
```

If you run into login issues as shown here, first make sure your *default* Security Group has enabled the ICMP and SSH igress rules listed [here](https://arawireless.readthedocs.io/en/latest/help/ara_faq.html#faq-unable-to-ping-ssh). If these are correctly set, then the issue is likely that you still need to configure SSH within the container to allow root user logins. To do so, navigate to the container's *Console* tab and edit the `/etc/ssh/sshd_config` file to set *PermitRootLogin yes* and then run the `service ssh restart` command. 

```
root@ag-farm-edge-node:/# ls                                                                                                                                   
bin   dev  home  lib32  libx32  mnt  proc  run   srv  tmp  var                                                                                                 
boot  etc  lib   lib64  media   opt  root  sbin  sys  usr                                                                                                      
root@ag-farm-edge-node:/# cat /etc/ssh/sshd_config                                                                                                             
                                                                                                                                                               
# This is the sshd server system-wide configuration file.  See                                                                                                 
# sshd_config(5) for more information.                                                                                                                         
                                                                                                                                                               
# This sshd was compiled with PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games                                                     
                                                                                                                                                               
# The strategy used for options in the default sshd_config shipped with                                                                                        
# OpenSSH is to specify options with their default value where                                                                                                 
# possible, but leave them commented.  Uncommented options override the                                                                                        
# default value.                                                                                                                                               
                                                                                                                                                               
Include /etc/ssh/sshd_config.d/*.conf                                                                                                                          
                                                                                                                                                               
#Port 22                                                                                                                                                       
#AddressFamily any                                                                                                                                             
#ListenAddress 0.0.0.0                                                                                                                                         
#ListenAddress ::                                                                                                                                              
                                                                                                                                                               
#HostKey /etc/ssh/ssh_host_rsa_key                                                                                                                             
#HostKey /etc/ssh/ssh_host_ecdsa_key                                                                                                                           
#HostKey /etc/ssh/ssh_host_ed25519_key                                                                                                                         
                                                                                                                                                               
# Ciphers and keying                                                                                                                                           
#RekeyLimit default none                                                                                                                                       
                                                                                                                                                               
# Logging                                                                                                                                                      
#SyslogFacility AUTH                                                                                                                                           
#LogLevel INFO                                                                                                                                                 
                                                                                                                                                               
# Authentication:                                                                                                                                              
                                                                                                                                                               
#LoginGraceTime 2m                                                                                                                                             
#PermitRootLogin prohibit-password                                                                                                                             
PermitRootLogin yes                                                                                                                                            
#StrictModes yes                                                                                                                                               
#MaxAuthTries 6                                                                                                                                                
#MaxSessions 10
                                                                                                                                                               
#PubkeyAuthentication yes                                                                                                                                      
                                                                                                                                                               
# Expect .ssh/authorized_keys2 to be disregarded by default in future.                                                                                         
#AuthorizedKeysFile     .ssh/authorized_keys .ssh/authorized_keys2                                                                                             
                                                                                                                                                               
#AuthorizedPrincipalsFile none                                                                                                                                 
                                                                                                                                                               
#AuthorizedKeysCommand none                                                                                                                                    
#AuthorizedKeysCommandUser nobody                                                                                                                              
                                                                                                                                                               
# For this to work you will also need host keys in /etc/ssh/ssh_known_hosts                                                                                    
#HostbasedAuthentication no                                                                                                                                    
# Change to yes if you don't trust ~/.ssh/known_hosts for                                                                                                      
# HostbasedAuthentication                                                                                                                                      
#IgnoreUserKnownHosts no                                                                                                                                       
# Don't read the user's ~/.rhosts and ~/.shosts files                                                                                                          
#IgnoreRhosts yes                                                                                                                                              
                                                                                                                                                               
# To disable tunneled clear text passwords, change to no here!                                                                                                 
#PasswordAuthentication yes                                                                                                                                    
#PermitEmptyPasswords no                                                                                                                                       
                                                                                                                                                               
# Change to yes to enable challenge-response passwords (beware issues with                                                                                     
# some PAM modules and threads)                                                                                                                                
KbdInteractiveAuthentication no                                                                                                                                
                                                                                                                                                               
# Kerberos options                                                                                                                                             
#KerberosAuthentication no                                                                                                                                     
#KerberosOrLocalPasswd yes                                                                                                                                     
#KerberosTicketCleanup yes                                                                                                                                     
#KerberosGetAFSToken no                                                                                                                                        
                                                                                                                                                               
# GSSAPI options                                                                                                                                               
#GSSAPIAuthentication no                                                                                                                                       
#GSSAPICleanupCredentials yes                                                                                                                                  
#GSSAPIStrictAcceptorCheck yes                                                                                                                                 
#GSSAPIKeyExchange no
                                                                                                                                                               
# Set this to 'yes' to enable PAM authentication, account processing,                                                                                          
# and session processing. If this is enabled, PAM authentication will                                                                                          
# be allowed through the KbdInteractiveAuthentication and                                                                                                      
# PasswordAuthentication.  Depending on your PAM configuration,                                                                                                
# PAM authentication via KbdInteractiveAuthentication may bypass                                                                                               
# the setting of "PermitRootLogin without-password".                                                                                                           
# If you just want the PAM account and session checks to run without                                                                                           
# PAM authentication, then enable this but set PasswordAuthentication                                                                                          
# and KbdInteractiveAuthentication to 'no'.                                                                                                                    
UsePAM yes                                                                                                                                                     
                                                                                                                                                               
#AllowAgentForwarding yes                                                                                                                                      
#AllowTcpForwarding yes                                                                                                                                        
#GatewayPorts no                                                                                                                                               
X11Forwarding yes                                                                                                                                              
#X11DisplayOffset 10                                                                                                                                           
#X11UseLocalhost yes                                                                                                                                           
#PermitTTY yes                                                                                                                                                 
PrintMotd no                                                                                                                                                   
#PrintLastLog yes                                                                                                                                              
#TCPKeepAlive yes                                                                                                                                              
#PermitUserEnvironment no                                                                                                                                      
#Compression delayed                                                                                                                                           
#ClientAliveInterval 0                                                                                                                                         
#ClientAliveCountMax 3                                                                                                                                         
#UseDNS no                                                                                                                                                     
#PidFile /run/sshd.pid                                                                                                                                         
#MaxStartups 10:30:100                                                                                                                                         
#PermitTunnel no                                                                                                                                               
#ChrootDirectory none                                                                                                                                          
#VersionAddendum none                                                                                                                                          
                                                                                                                                                               
# no default banner path                                                                                                                                       
#Banner none                                                                                                                                                   
                                                                                                                                                               
# Allow client to pass locale environment variables                                                                                                            
AcceptEnv LANG LC_*
                                                                                                                                                               
# override default of no subsystems                                                                                                                            
Subsystem       sftp    /usr/lib/openssh/sftp-server                                                                                                           
                                                                                                                                                               
# Example of overriding settings on a per-user basis                                                                                                           
#Match User anoncvs                                                                                                                                            
#       X11Forwarding no                                                                                                                                       
#       AllowTcpForwarding no                                                                                                                                  
#       PermitTTY no                                                                                                                                           
#       ForceCommand cvs server                                                                                                                                
root@ag-farm-edge-node:/# cat /etc/ssh/sshd_config | grep PermitRootLogin                                                                                      
#PermitRootLogin prohibit-password                                                                                                                             
PermitRootLogin yes                                                                                                                                            
# the setting of "PermitRootLogin without-password".                                                                                                           
root@ag-farm-edge-node:/#
root@ag-farm-edge-node:/# 
```

If you are still unable to login, the issue here may be that you also still need to set the root password with the `passwd` command from the *Console* as well. 

```
root@ag-farm-edge-node:/# passwd                                                                                                                               
New password:                                                                                                                                                  
Retype new password:                                                                                                                                           
passwd: password updated successfully
root@ag-farm-edge-node:/# service ssh restart                                                                                                                  
 * Restarting OpenBSD Secure Shell server sshd                           [ OK ]                                                                                                                          
```

Once you have everything configured from the *Console*, you should be able to login successfully via SSH from the ARA Jumpbox.

```
mckandes@ara-jbox:~$ ssh root@10.189.11.249
The authenticity of host '10.189.11.249 (10.189.11.249)' can't be established.
ECDSA key fingerprint is SHA256:KwByPEvHD2RM1AzhygPKiogii+g7qg0rzfrXLNwdFdQ.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '10.189.11.249' (ECDSA) to the list of known hosts.
root@10.189.11.94's password: 
Welcome to Ubuntu 22.04.2 LTS (GNU/Linux 5.4.0-174-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

This system has been minimized by removing packages and content that are
not required on a system that users do not log into.

To restore this content, you can run the 'unminimize' command.

The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

root@ag-farm-edge-node:~#
```
