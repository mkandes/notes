# Upgrade to a new version of Spack

### Create a new deployment branch
A new deployment branch must be created as the first step in any upgrade to a new version of Spack. However, before you create the
new deployment branch, you must check whether or not the head of the `develop` branch in the `sdsc/spack` repository is ahead of or 
behind the commit of the release version you have targeted for the upgrade. If it is ahead of the release commit, then you should 
also find the release version number listed as a tag in the `sdsc/spack` repository. If you do not find the release tag, then the head of
the `develop` branch is likely behind the commit of target release version for the upgrade. In this case, you must first resynchronize 
the `develop`  branch of the `sdsc/spack` repository with the `develop` branch of the `spack/spack` upstream repository, including the
latest tags.

Listing the release tags
```
$ git clone https://github.com/sdsc/spack.git
Cloning into 'spack'...
remote: Enumerating objects: 577898, done.
remote: Counting objects: 100% (35/35), done.
remote: Compressing objects: 100% (21/21), done.
remote: Total 577898 (delta 7), reused 32 (delta 6), pack-reused 577863 (from 1)
Receiving objects: 100% (577898/577898), 440.97 MiB | 61.66 MiB/s, done.
Resolving deltas: 100% (265808/265808), done.
Updating files: 100% (12441/12441), done.
$ cd spack/
$ git tag -l v0.21.*
v0.21.0
v0.21.1
v0.21.2
$
```

Resyncing `develop` branch with upstream
```
mkandes@hardtack:~$ git clone https://github.com/sdsc/spack.git
Cloning into 'spack'...
remote: Enumerating objects: 577898, done.
remote: Counting objects: 100% (35/35), done.
remote: Compressing objects: 100% (21/21), done.
remote: Total 577898 (delta 7), reused 32 (delta 6), pack-reused 577863 (from 1)
Receiving objects: 100% (577898/577898), 439.20 MiB | 61.57 MiB/s, done.
Resolving deltas: 100% (266431/266431), done.
Updating files: 100% (12441/12441), done.
mkandes@hardtack:~$ cd spack/
mkandes@hardtack:~/spack$ git branch
* sdsc-0.17.3
mkandes@hardtack:~/spack$ git log -1
commit b62c4b176889a485e7ae0c2e857c7613e302afa6 (HEAD -> sdsc-0.17.3, origin/sdsc-0.17.3, origin/HEAD)
Author: Marty Kandes <mkandes@sdsc.edu>
Date:   Fri Sep 20 16:25:18 2024 -0700

    Deploy star@2.7.11b % gcc@10.2.0 to expanse/0.17.3/cpu/b
mkandes@hardtack:~/spack$ git remote -v
origin	https://github.com/sdsc/spack.git (fetch)
origin	https://github.com/sdsc/spack.git (push)
mkandes@hardtack:~/spack$ git checkout develop
Branch 'develop' set up to track remote branch 'develop' from 'origin'.
Switched to a new branch 'develop'
mkandes@hardtack:~/spack$ git branch
* develop
  sdsc-0.17.3
mkandes@hardtack:~/spack$ git log -1
commit 14209a86a66a3e701c72487a27dc3cfc067b40b7 (HEAD -> develop, origin/develop)
Author: Arne Becker <101113822+EbiArnie@users.noreply.github.com>
Date:   Fri Mar 8 18:42:26 2024 +0000

    perl-bio-eutilities and deps: new packages (#42869)
    
    This adds Spack packages for these Perl distributons:
    - Bio::DB::EUtilities and its dependencies:
    - Bio::ASN1::EntrezGene
    - Bio::Cluster
    - Bio::Variation
mkandes@hardtack:~/spack$
mkandes@hardtack:~/spack$ git remote add upstream https://github.com/spack/spack.git
mkandes@hardtack:~/spack$ git remote -v
origin	https://github.com/sdsc/spack.git (fetch)
origin	https://github.com/sdsc/spack.git (push)
upstream	https://github.com/spack/spack.git (fetch)
upstream	https://github.com/spack/spack.git (push)
mkandes@hardtack:~/spack$
mkandes@hardtack:~/spack$ git fetch --tags upstream
remote: Enumerating objects: 52120, done.
remote: Counting objects: 100% (18666/18666), done.
remote: Compressing objects: 100% (726/726), done.
remote: Total 52120 (delta 17875), reused 18342 (delta 17695), pack-reused 33454 (from 1)
Receiving objects: 100% (52120/52120), 18.82 MiB | 53.83 MiB/s, done.
Resolving deltas: 100% (29057/29057), completed with 6490 local objects.
From https://github.com/spack/spack
 * [new branch]            2023-04-05             -> upstream/2023-04-05
 * [new branch]            41639-setup-envsh-has-trouble-identifying-shell-inside-qemu-eg-multi-platform-docker-build -> upstream/41639-setup-envsh-has-trouble-identifying-shell-inside-qemu-eg-multi-platform-docker-build
 * [new branch]            45339-on_package_attributesrun_tests=true-doesnt-work-in-builder-classes -> upstream/45339-on_package_attributesrun_tests=true-doesnt-work-in-builder-classes
 * [new branch]            albestro/openblas-m2   -> upstream/albestro/openblas-m2
 * [new branch]            alby/libvterm          -> upstream/alby/libvterm
 * [new branch]            backports/v0.21.3      -> upstream/backports/v0.21.3
 * [new branch]            balay/llvm-19.1.0      -> upstream/balay/llvm-19.1.0
 * [new branch]            balay/petsc-3.21       -> upstream/balay/petsc-3.21
 * [new branch]            balay/petsc4py-remove-cython-dep -> upstream/balay/petsc4py-remove-cython-dep
 * [new branch]            balay/revert-ginkgo-mpi-ver-dependency -> upstream/balay/revert-ginkgo-mpi-ver-dependency
 * [new branch]            bug/stop_adding_s3_connection_info_all_mirrors -> upstream/bug/stop_adding_s3_connection_info_all_mirrors
 * [new branch]            bugfix/binary-index-update-thread-unsafe -> upstream/bugfix/binary-index-update-thread-unsafe
 * [new branch]            bugfix/compiler-bootstrapping-performance -> upstream/bugfix/compiler-bootstrapping-performance
 * [new branch]            bugfix/compiler-flag-propagation -> upstream/bugfix/compiler-flag-propagation
 * [new branch]            bugfix/compiler-siblings-in-path -> upstream/bugfix/compiler-siblings-in-path
 * [new branch]            bugfix/env-allow-plain-hash -> upstream/bugfix/env-allow-plain-hash
 * [new branch]            bugfix/environment-overwrite -> upstream/bugfix/environment-overwrite
 * [new branch]            bugfix/external-python -> upstream/bugfix/external-python
 * [new branch]            bugfix/intel-bootstrap-tests -> upstream/bugfix/intel-bootstrap-tests
 * [new branch]            bugfix/invalid-compiler-warning -> upstream/bugfix/invalid-compiler-warning
 * [new branch]            bugfix/patches-across-repos -> upstream/bugfix/patches-across-repos
 * [new branch]            bugfix/relative-develop-paths -> upstream/bugfix/relative-develop-paths
 * [new branch]            bugfix/rocm-conflicts  -> upstream/bugfix/rocm-conflicts
 * [new branch]            bugfix/setup-prepend-path-move-to-front -> upstream/bugfix/setup-prepend-path-move-to-front
 * [new branch]            bugfix/splice-multiple-nodes-same-name -> upstream/bugfix/splice-multiple-nodes-same-name
 * [new branch]            bugfix/transactional-concretization -> upstream/bugfix/transactional-concretization
 * [new branch]            cc-unique-rpaths       -> upstream/cc-unique-rpaths
 * [new branch]            ci/find-bottleneck     -> upstream/ci/find-bottleneck
 * [new branch]            cmd/dependents-deptype -> upstream/cmd/dependents-deptype
 * [new branch]            colorize-non-defaults-in-spec -> upstream/colorize-non-defaults-in-spec
 * [new branch]            conc-dev               -> upstream/conc-dev
 * [new branch]            containers/docs-centos-7-to-almalinux-9 -> upstream/containers/docs-centos-7-to-almalinux-9
 * [new branch]            cws/configPermission   -> upstream/cws/configPermission
 * [new branch]            cws/omegah_v10.8.5     -> upstream/cws/omegah_v10.8.5
 * [new branch]            cws/pumiFixSmokeTest   -> upstream/cws/pumiFixSmokeTest
 * [new branch]            cws/simmodsuiteRpc     -> upstream/cws/simmodsuiteRpc
 * [new branch]            dag-ordered-optimization -> upstream/dag-ordered-optimization
 * [new branch]            dependabot/pip/dot-github/workflows/requirements/mypy-1.11.1 -> upstream/dependabot/pip/dot-github/workflows/requirements/mypy-1.11.1
 * [new branch]            dependabot/pip/dot-github/workflows/requirements/style/mypy-1.10.1 -> upstream/dependabot/pip/dot-github/workflows/requirements/style/mypy-1.10.1
 * [new branch]            dependabot/pip/dot-github/workflows/requirements/style/mypy-1.11.1 -> upstream/dependabot/pip/dot-github/workflows/requirements/style/mypy-1.11.1
 * [new branch]            dependabot/pip/lib/spack/docs/docutils-0.21.2 -> upstream/dependabot/pip/lib/spack/docs/docutils-0.21.2
 * [new branch]            dependabot/pip/lib/spack/docs/python-levenshtein-0.26.0 -> upstream/dependabot/pip/lib/spack/docs/python-levenshtein-0.26.0
 * [new branch]            dependabot/pip/lib/spack/docs/sphinx-8.0.2 -> upstream/dependabot/pip/lib/spack/docs/sphinx-8.0.2
 * [new branch]            develop                -> upstream/develop
 * [new branch]            devtools-repair        -> upstream/devtools-repair
 * [new branch]            disinherit-directive   -> upstream/disinherit-directive
 * [new branch]            docker-entrypoint-bash-set-e -> upstream/docker-entrypoint-bash-set-e
 * [new branch]            docs/no-search-api-docs -> upstream/docs/no-search-api-docs
 * [new branch]            e4s-21.05              -> upstream/e4s-21.05
 * [new branch]            e4s-21.08              -> upstream/e4s-21.08
 * [new branch]            e4s-21.11              -> upstream/e4s-21.11
 * [new branch]            e4s-22.02              -> upstream/e4s-22.02
 * [new branch]            e4s-22.05              -> upstream/e4s-22.05
 * [new branch]            e4s-22.08              -> upstream/e4s-22.08
 * [new branch]            e4s-22.11              -> upstream/e4s-22.11
 * [new branch]            e4s-23.02              -> upstream/e4s-23.02
 * [new branch]            e4s-23.05              -> upstream/e4s-23.05
 * [new branch]            e4s-23.08              -> upstream/e4s-23.08
 * [new branch]            e4s-23.11              -> upstream/e4s-23.11
 * [new branch]            e4s-24.02              -> upstream/e4s-24.02
 * [new branch]            e4s-24.05              -> upstream/e4s-24.05
 * [new branch]            experimental/unified-dunder-and-dag-hash -> upstream/experimental/unified-dunder-and-dag-hash
 * [new branch]            external/license-info  -> upstream/external/license-info
 * [new branch]            f/env-location         -> upstream/f/env-location
 * [new branch]            factor-out-find-python -> upstream/factor-out-find-python
 * [new branch]            feat/mermaid-graph     -> upstream/feat/mermaid-graph
 * [new branch]            features/compiler-as-nodes -> upstream/features/compiler-as-nodes
 * [new branch]            features/conditional-format-strings -> upstream/features/conditional-format-strings
 * [new branch]            features/config-git-url -> upstream/features/config-git-url
 * [new branch]            features/error-message-chaining-2 -> upstream/features/error-message-chaining-2
 * [new branch]            features/git-url-parse -> upstream/features/git-url-parse
 * [new branch]            features/improved-python-detection -> upstream/features/improved-python-detection
 * [new branch]            features/improved-target-encoding -> upstream/features/improved-target-encoding
 * [new branch]            features/install-binary-no-build-deps -> upstream/features/install-binary-no-build-deps
 * [new branch]            features/keep-view-internals -> upstream/features/keep-view-internals
 * [new branch]            features/matrix-broadcast -> upstream/features/matrix-broadcast
 * [new branch]            features/ordered-matrices -> upstream/features/ordered-matrices
 * [new branch]            features/psid-separate-build-deps -> upstream/features/psid-separate-build-deps
 * [new branch]            features/read-compilers-from-packages-yaml -> upstream/features/read-compilers-from-packages-yaml
 * [new branch]            features/relocation-performance-offsets -> upstream/features/relocation-performance-offsets
 * [new branch]            features/restricted-reuse -> upstream/features/restricted-reuse
 * [new branch]            features/reuse-only    -> upstream/features/reuse-only
 * [new branch]            features/reuse-unknown-namespace -> upstream/features/reuse-unknown-namespace
 * [new branch]            features/spack-checkout -> upstream/features/spack-checkout
 * [new branch]            features/spack-test-new-interface-wip -> upstream/features/spack-test-new-interface-wip
 * [new branch]            features/spliced-install -> upstream/features/spliced-install
 * [new branch]            features/unify-for-non-environment-concretization -> upstream/features/unify-for-non-environment-concretization
 * [new branch]            features/virtual-like-separate-build-deps -> upstream/features/virtual-like-separate-build-deps
 * [new branch]            fix-linux-pam-for-recent-glibc -> upstream/fix-linux-pam-for-recent-glibc
 * [new branch]            fix/fewer-allocs-in-traversal -> upstream/fix/fewer-allocs-in-traversal
 * [new branch]            fix/python-tkinter     -> upstream/fix/python-tkinter
 * [new branch]            fix/spack-bootstrap-remove-args -> upstream/fix/spack-bootstrap-remove-args
 * [new branch]            fix/system-rpaths      -> upstream/fix/system-rpaths
 * [new branch]            fix/troubleshoot-rocm-issue -> upstream/fix/troubleshoot-rocm-issue
 * [new branch]            gartung-buildcache-check-fix -> upstream/gartung-buildcache-check-fix
 * [new branch]            hep-cloud-pipeline     -> upstream/hep-cloud-pipeline
 * [new branch]            hs/ci/regression-check -> upstream/hs/ci/regression-check
 * [new branch]            hs/feature/zipped-repo -> upstream/hs/feature/zipped-repo
 * [new branch]            hs/fix/checksum-reporting -> upstream/hs/fix/checksum-reporting
 * [new branch]            hs/fix/detection-avoid-fs-bomb -> upstream/hs/fix/detection-avoid-fs-bomb
 * [new branch]            hs/fix/drop-compiler-in-projections -> upstream/hs/fix/drop-compiler-in-projections
 * [new branch]            hs/fix/simplify-mro-stuff -> upstream/hs/fix/simplify-mro-stuff
 * [new branch]            hs/grpc/bump           -> upstream/hs/grpc/bump
 * [new branch]            hs/imports/remove-redundant -> upstream/hs/imports/remove-redundant
 * [new branch]            hs/windows/vtk-without-mpi -> upstream/hs/windows/vtk-without-mpi
 * [new branch]            install-status-format  -> upstream/install-status-format
 * [new branch]            isolate-util           -> upstream/isolate-util
 * [new branch]            ldlist                 -> upstream/ldlist
 * [new branch]            load-run-deps          -> upstream/load-run-deps
 * [new branch]            minimal-concretization -> upstream/minimal-concretization
 * [new branch]            mypy-check-untyped-defs -> upstream/mypy-check-untyped-defs
 * [new branch]            no-circular-imports-from-llnl -> upstream/no-circular-imports-from-llnl
 * [new branch]            package-metadata-caching -> upstream/package-metadata-caching
 * [new branch]            package/pyspy          -> upstream/package/pyspy
 * [new branch]            packages/apr-1.7.5     -> upstream/packages/apr-1.7.5
 * [new branch]            packages/audacious-4.4 -> upstream/packages/audacious-4.4
 * [new branch]            packages/cairo-1.18.0  -> upstream/packages/cairo-1.18.0
 * [new branch]            packages/colima        -> upstream/packages/colima
 * [new branch]            packages/curl-8.7.1    -> upstream/packages/curl-8.7.1
 * [new branch]            packages/dakota6.20    -> upstream/packages/dakota6.20
 * [new branch]            packages/drill-1.21.2  -> upstream/packages/drill-1.21.2
 * [new branch]            packages/erlang-27.0.1 -> upstream/packages/erlang-27.0.1
 * [new branch]            packages/glib-2.80.2   -> upstream/packages/glib-2.80.2
 * [new branch]            packages/httpd-2.4.62  -> upstream/packages/httpd-2.4.62
 * [new branch]            packages/hudi-url      -> upstream/packages/hudi-url
 * [new branch]            packages/intel-oneapi-mpi-external -> upstream/packages/intel-oneapi-mpi-external
 * [new branch]            packages/librsvg-2.58.2 -> upstream/packages/librsvg-2.58.2
 * [new branch]            packages/lzo-pkgconf   -> upstream/packages/lzo-pkgconf
 * [new branch]            packages/meshlab       -> upstream/packages/meshlab
 * [new branch]            packages/parallel-20240822 -> upstream/packages/parallel-20240822
 * [new branch]            packages/paraview-qt6  -> upstream/packages/paraview-qt6
 * [new branch]            packages/py-onnx-out-of-source-tree -> upstream/packages/py-onnx-out-of-source-tree
 * [new branch]            packages/py-pyzmq-26.0.3 -> upstream/packages/py-pyzmq-26.0.3
 * [new branch]            packages/qt-tools-6.7.2 -> upstream/packages/qt-tools-6.7.2
 * [new branch]            packages/qwt-qt6       -> upstream/packages/qwt-qt6
 * [new branch]            packages/r-new-versions -> upstream/packages/r-new-versions
 * [new branch]            packages/r-parse-description -> upstream/packages/r-parse-description
 * [new branch]            packages/rpackage-cran-urls -> upstream/packages/rpackage-cran-urls
 * [new branch]            packages/spherepack-url -> upstream/packages/spherepack-url
 * [new branch]            packages/suite-sparse-new-versions -> upstream/packages/suite-sparse-new-versions
 * [new branch]            packages/util-linux-uuid-variant-provider -> upstream/packages/util-linux-uuid-variant-provider
 * [new branch]            per-instance-stage-directories -> upstream/per-instance-stage-directories
 * [new branch]            psakiev/ctest-pkg      -> upstream/psakiev/ctest-pkg
 * [new branch]            psakiev/custom-dev-check -> upstream/psakiev/custom-dev-check
 * [new branch]            psakiev/improve-stage-cmd -> upstream/psakiev/improve-stage-cmd
 * [new branch]            psakievich/bug-ref-reuse -> upstream/psakievich/bug-ref-reuse
 * [new branch]            psakievich/reuse-with-identical-sources -> upstream/psakievich/reuse-with-identical-sources
 * [new branch]            py-pycm-new-package    -> upstream/py-pycm-new-package
 * [new branch]            python/add-underscore-pypi-by-default -> upstream/python/add-underscore-pypi-by-default
 * [new branch]            python/use-wheels      -> upstream/python/use-wheels
 * [new branch]            python/use-wheels-2    -> upstream/python/use-wheels-2
 * [new branch]            refactor-solver-transforms -> upstream/refactor-solver-transforms
 * [new branch]            refactor/compiler-detection-through-external-find -> upstream/refactor/compiler-detection-through-external-find
 * [new branch]            releases/v0.10         -> upstream/releases/v0.10
 * [new branch]            releases/v0.11         -> upstream/releases/v0.11
 * [new branch]            releases/v0.12         -> upstream/releases/v0.12
 * [new branch]            releases/v0.13         -> upstream/releases/v0.13
 * [new branch]            releases/v0.14         -> upstream/releases/v0.14
 * [new branch]            releases/v0.15         -> upstream/releases/v0.15
 * [new branch]            releases/v0.16         -> upstream/releases/v0.16
 * [new branch]            releases/v0.17         -> upstream/releases/v0.17
 * [new branch]            releases/v0.18         -> upstream/releases/v0.18
 * [new branch]            releases/v0.19         -> upstream/releases/v0.19
 * [new branch]            releases/v0.20         -> upstream/releases/v0.20
 * [new branch]            releases/v0.21         -> upstream/releases/v0.21
 * [new branch]            releases/v0.22         -> upstream/releases/v0.22
 * [new branch]            remove-deprecated-arg-from-test -> upstream/remove-deprecated-arg-from-test
 * [new branch]            revert-34153-revert-34087-revert-33746-add-shared-pr-binary-mirror -> upstream/revert-34153-revert-34087-revert-33746-add-shared-pr-binary-mirror
 * [new branch]            revert-36332-packages/jupyter -> upstream/revert-36332-packages/jupyter
 * [new branch]            show-sha256-in-spec    -> upstream/show-sha256-in-spec
 * [new branch]            solve-profile          -> upstream/solve-profile
 * [new branch]            solver-prefer-older    -> upstream/solver-prefer-older
 * [new branch]            speed-up-build-cache   -> upstream/speed-up-build-cache
 * [new branch]            sync-dependency-attributes -> upstream/sync-dependency-attributes
 * [new branch]            test/environment-activate-deps -> upstream/test/environment-activate-deps
 * [new branch]            traceback-for-failed-install -> upstream/traceback-for-failed-install
 * [new branch]            update/spython-0.3.0   -> upstream/update/spython-0.3.0
 * [new branch]            versions/git-versions-branches -> upstream/versions/git-versions-branches
 * [new branch]            wdconinc-patch-1       -> upstream/wdconinc-patch-1
 * [new branch]            win/port-gdal          -> upstream/win/port-gdal
 * [new branch]            woptim/extend-commit-fetch -> upstream/woptim/extend-commit-fetch
 * [new branch]            woptim/mfem-change-test -> upstream/woptim/mfem-change-test
 * [new branch]            woptim/radiuss-packages-update -> upstream/woptim/radiuss-packages-update
 * [new branch]            wspear-gpgme-fix       -> upstream/wspear-gpgme-fix
 * [new tag]               develop-2024-03-10     -> develop-2024-03-10
 * [new tag]               develop-2024-03-17     -> develop-2024-03-17
 * [new tag]               develop-2024-03-24     -> develop-2024-03-24
 * [new tag]               develop-2024-03-31     -> develop-2024-03-31
 * [new tag]               develop-2024-04-07     -> develop-2024-04-07
 * [new tag]               develop-2024-04-14     -> develop-2024-04-14
 * [new tag]               develop-2024-04-21     -> develop-2024-04-21
 * [new tag]               develop-2024-04-28     -> develop-2024-04-28
 * [new tag]               develop-2024-05-05     -> develop-2024-05-05
 * [new tag]               develop-2024-05-12     -> develop-2024-05-12
 * [new tag]               develop-2024-05-19     -> develop-2024-05-19
 * [new tag]               develop-2024-05-26     -> develop-2024-05-26
 * [new tag]               develop-2024-06-02     -> develop-2024-06-02
 * [new tag]               develop-2024-06-09     -> develop-2024-06-09
 * [new tag]               develop-2024-06-16     -> develop-2024-06-16
 * [new tag]               develop-2024-06-23     -> develop-2024-06-23
 * [new tag]               develop-2024-06-30     -> develop-2024-06-30
 * [new tag]               develop-2024-07-07     -> develop-2024-07-07
 * [new tag]               develop-2024-07-14     -> develop-2024-07-14
 * [new tag]               develop-2024-07-21     -> develop-2024-07-21
 * [new tag]               develop-2024-07-28     -> develop-2024-07-28
 * [new tag]               develop-2024-08-04     -> develop-2024-08-04
 * [new tag]               develop-2024-08-11     -> develop-2024-08-11
 * [new tag]               develop-2024-08-18     -> develop-2024-08-18
 * [new tag]               develop-2024-08-25     -> develop-2024-08-25
 * [new tag]               develop-2024-09-01     -> develop-2024-09-01
 * [new tag]               develop-2024-09-08     -> develop-2024-09-08
 * [new tag]               develop-2024-09-15     -> develop-2024-09-15
 * [new tag]               develop-2024-09-22     -> develop-2024-09-22
 ! [rejected]              releases/latest        -> releases/latest  (would clobber existing tag)
 * [new tag]               v0.22.0                -> v0.22.0
 * [new tag]               v0.22.1                -> v0.22.1
 * [new tag]               v0.22.2                -> v0.22.2
mkandes@hardtack:~/spack$ 


```
