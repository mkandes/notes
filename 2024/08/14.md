# Revisit HTCondor (for ARA Demo)

Starting with the current version of the `DataCenterCompute-v0.yaml` Heat Orchestration Template, create the Stack. Once the container has startedd running, login via SSH through the ARA Jump Host. Let's start with a central manager configuration using the new `get.htcondor.org` helper script method and investigate the base configration, which uses the pool password method to generate the new token-based approach for security.

*Command*:
```
curl -fsSL https://get.htcondor.org | GET_HTCONDOR_PASSWORD="XXXXXXXXXX" /bin/bash -s -- --no-dry-run --central-manager 10.0.4.242
```

*Output*:
```
root@DataCenterCompute000:~# curl -fsSL https://get.htcondor.org | GET_HTCONDOR_PASSWORD="XXXXXXXXXX" /bin/bash -s -- --no-dry-run --central-manager 10.0.4.242
# Installing HTCondor as central manager for Ubuntu jammy
+ echo -e '\n# Adding our repository'

# Adding our repository
+ apt_get='DEBIAN_FRONTEND=noninteractive apt-get'
+ sh -c 'DEBIAN_FRONTEND=noninteractive apt-get update'
Hit:1 http://security.ubuntu.com/ubuntu jammy-security InRelease
Hit:2 https://research.cs.wisc.edu/htcondor/repo/ubuntu/23.0 jammy InRelease
Hit:3 http://archive.ubuntu.com/ubuntu jammy InRelease                      
Hit:4 http://archive.ubuntu.com/ubuntu jammy-updates InRelease
Hit:5 http://archive.ubuntu.com/ubuntu jammy-backports InRelease
Reading package lists... Done
W: https://research.cs.wisc.edu/htcondor/repo/ubuntu/23.0/dists/jammy/InRelease: Key is stored in legacy trusted.gpg keyring (/etc/apt/trusted.gpg), see the DEPRECATION section in apt-key(8) for details.
+ sh -c 'DEBIAN_FRONTEND=noninteractive apt-get install -y gnupg'
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
gnupg is already the newest version (2.2.27-3ubuntu2.1).
gnupg set to manually installed.
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
+ sh -c 'mkdir -p /etc/apt/keyrings'
+ sh -c 'curl -fsSL https://research.cs.wisc.edu/htcondor/repo/keys/HTCondor-current-Key -o /etc/apt/keyrings/HTCondor-current-Key'
+ sh -c 'DEBIAN_FRONTEND=noninteractive apt-get install apt-transport-https'
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following NEW packages will be installed:
  apt-transport-https
0 upgraded, 1 newly installed, 0 to remove and 0 not upgraded.
Need to get 1510 B of archives.
After this operation, 170 kB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu jammy-updates/universe amd64 apt-transport-https all 2.4.12 [1510 B]
Fetched 1510 B in 0s (7390 B/s)               
Selecting previously unselected package apt-transport-https.
(Reading database ... 48156 files and directories currently installed.)
Preparing to unpack .../apt-transport-https_2.4.12_all.deb ...
Unpacking apt-transport-https (2.4.12) ...
Setting up apt-transport-https (2.4.12) ...
NEEDRESTART-VER: 3.5
NEEDRESTART-KCUR: 5.4.0-149-generic
NEEDRESTART-KSTA: 0
NEEDRESTART-UCSTA: 0
+ HTCONDOR_LIST=/etc/apt/sources.list.d/htcondor.list
+ sh -c 'echo "deb [signed-by=/etc/apt/keyrings/HTCondor-current-Key] https://research.cs.wisc.edu/htcondor/repo/ubuntu/current jammy main" > /etc/apt/sources.list.d/htcondor.list'
+ sh -c 'echo "deb-src [signed-by=/etc/apt/keyrings/HTCondor-current-Key] https://research.cs.wisc.edu/htcondor/repo/ubuntu/current jammy main" >> /etc/apt/sources.list.d/htcondor.list'
+ echo -e '\n# Updating package lists'

# Updating package lists
+ sh -c 'DEBIAN_FRONTEND=noninteractive apt-get update'
Hit:1 http://security.ubuntu.com/ubuntu jammy-security InRelease
Hit:2 https://research.cs.wisc.edu/htcondor/repo/ubuntu/23.0 jammy InRelease
Get:3 https://research.cs.wisc.edu/htcondor/repo/ubuntu/current jammy InRelease [5901 B]
Hit:4 http://archive.ubuntu.com/ubuntu jammy InRelease
Hit:5 http://archive.ubuntu.com/ubuntu jammy-updates InRelease
Get:6 https://research.cs.wisc.edu/htcondor/repo/ubuntu/current jammy/main Sources [7019 B]
Hit:7 http://archive.ubuntu.com/ubuntu jammy-backports InRelease    
Get:8 https://research.cs.wisc.edu/htcondor/repo/ubuntu/current jammy/main amd64 Packages [82.1 kB]
Fetched 95.0 kB in 1s (188 kB/s)    
Reading package lists... Done
W: https://research.cs.wisc.edu/htcondor/repo/ubuntu/23.0/dists/jammy/InRelease: Key is stored in legacy trusted.gpg keyring (/etc/apt/trusted.gpg), see the DEPRECATION section in apt-key(8) for details.
+ echo -e '\n# Installing ps'

# Installing ps
+ sh -c 'DEBIAN_FRONTEND=noninteractive apt-get install -y procps'
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
procps is already the newest version (2:3.3.17-6ubuntu2.1).
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
+ case $lsb_dist.$dist_version in
+ echo -e '\n# Preconfiguring packages for Ubuntu.'

# Preconfiguring packages for Ubuntu.
+ sh -c 'DEBIAN_FRONTEND=noninteractive apt-get install -y keyboard-configuration console-setup tzdata'
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
console-setup is already the newest version (1.205ubuntu3).
console-setup set to manually installed.
keyboard-configuration is already the newest version (1.205ubuntu3).
keyboard-configuration set to manually installed.
tzdata is already the newest version (2024a-0ubuntu0.22.04.1).
tzdata set to manually installed.
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
+ echo -e '\n# Installing HTCondor binaries and dependencies'

# Installing HTCondor binaries and dependencies
+ [[ ! -n central manager ]]
+ sh -c 'DEBIAN_FRONTEND=noninteractive apt-get install -y condor'
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following additional packages will be installed:
  condor-upgrade-checks fonts-glyphicons-halflings libboost-python1.74.0 libdate-manip-perl libjs-bootstrap libmunge2
  libpcre2-16-0 libpcre2-32-0 libpcre2-posix3 libscitokens0 libvomsapi1v5 pcre2-utils pelican pelican-osdf-compat
  python3-certifi python3-requests python3-urllib3
Suggested packages:
  docker.io coop-computing-tools singularity-container slurm-client python3-socks python-requests-doc
The following NEW packages will be installed:
  condor condor-upgrade-checks fonts-glyphicons-halflings libboost-python1.74.0 libdate-manip-perl libjs-bootstrap
  libmunge2 libpcre2-16-0 libpcre2-32-0 libpcre2-posix3 libscitokens0 libvomsapi1v5 pcre2-utils pelican
  pelican-osdf-compat python3-certifi python3-requests python3-urllib3
0 upgraded, 18 newly installed, 0 to remove and 0 not upgraded.
Need to get 27.0 MB of archives.
After this operation, 94.5 MB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu jammy/main amd64 libdate-manip-perl all 6.86-1 [946 kB]
Get:2 https://research.cs.wisc.edu/htcondor/repo/ubuntu/23.0 jammy/main amd64 libscitokens0 amd64 1.1.1-1.1 [123 kB]
Get:3 https://research.cs.wisc.edu/htcondor/repo/ubuntu/current jammy/main amd64 condor-upgrade-checks all 23.9.6-1.1 [42.3 kB]
Get:4 https://research.cs.wisc.edu/htcondor/repo/ubuntu/current jammy/main amd64 condor amd64 23.9.6-1.1 [8524 kB]
Get:5 https://research.cs.wisc.edu/htcondor/repo/ubuntu/current jammy/main amd64 pelican amd64 7.9.9-1 [15.9 MB]
Get:6 https://research.cs.wisc.edu/htcondor/repo/ubuntu/current jammy/main amd64 pelican-osdf-compat amd64 7.9.9-1 [1502 B]
Get:7 http://archive.ubuntu.com/ubuntu jammy/main amd64 python3-certifi all 2020.6.20-1 [150 kB]
Get:8 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 python3-urllib3 all 1.26.5-1~exp1ubuntu0.1 [98.2 kB]
Get:9 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 python3-requests all 2.25.1+dfsg-2ubuntu0.1 [48.8 kB]
Get:10 http://archive.ubuntu.com/ubuntu jammy/universe amd64 libmunge2 amd64 0.5.14-6 [15.7 kB]
Get:11 http://archive.ubuntu.com/ubuntu jammy/universe amd64 fonts-glyphicons-halflings all 1.009~3.4.1+dfsg-2 [117 kB]
Get:12 http://archive.ubuntu.com/ubuntu jammy/universe amd64 libjs-bootstrap all 3.4.1+dfsg-2 [124 kB]
Get:13 http://archive.ubuntu.com/ubuntu jammy/universe amd64 libvomsapi1v5 amd64 2.1.0~rc2-2 [140 kB]
Get:14 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 libpcre2-16-0 amd64 10.39-3ubuntu0.1 [203 kB]
Get:15 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 libpcre2-32-0 amd64 10.39-3ubuntu0.1 [194 kB]
Get:16 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 libpcre2-posix3 amd64 10.39-3ubuntu0.1 [6130 B]
Get:17 http://archive.ubuntu.com/ubuntu jammy-updates/universe amd64 pcre2-utils amd64 10.39-3ubuntu0.1 [128 kB]
Get:18 http://archive.ubuntu.com/ubuntu jammy/main amd64 libboost-python1.74.0 amd64 1.74.0-14ubuntu3 [299 kB]
Fetched 27.0 MB in 1s (23.3 MB/s)              
Selecting previously unselected package libdate-manip-perl.
(Reading database ... 48160 files and directories currently installed.)
Preparing to unpack .../00-libdate-manip-perl_6.86-1_all.deb ...
Unpacking libdate-manip-perl (6.86-1) ...
Selecting previously unselected package python3-certifi.
Preparing to unpack .../01-python3-certifi_2020.6.20-1_all.deb ...
Unpacking python3-certifi (2020.6.20-1) ...
Selecting previously unselected package python3-urllib3.
Preparing to unpack .../02-python3-urllib3_1.26.5-1~exp1ubuntu0.1_all.deb ...
Unpacking python3-urllib3 (1.26.5-1~exp1ubuntu0.1) ...
Selecting previously unselected package python3-requests.
Preparing to unpack .../03-python3-requests_2.25.1+dfsg-2ubuntu0.1_all.deb ...
Unpacking python3-requests (2.25.1+dfsg-2ubuntu0.1) ...
Selecting previously unselected package libmunge2.
Preparing to unpack .../04-libmunge2_0.5.14-6_amd64.deb ...
Unpacking libmunge2 (0.5.14-6) ...
Selecting previously unselected package fonts-glyphicons-halflings.
Preparing to unpack .../05-fonts-glyphicons-halflings_1.009~3.4.1+dfsg-2_all.deb ...
Unpacking fonts-glyphicons-halflings (1.009~3.4.1+dfsg-2) ...
Selecting previously unselected package libjs-bootstrap.
Preparing to unpack .../06-libjs-bootstrap_3.4.1+dfsg-2_all.deb ...
Unpacking libjs-bootstrap (3.4.1+dfsg-2) ...
Selecting previously unselected package libscitokens0:amd64.
Preparing to unpack .../07-libscitokens0_1.1.1-1.1_amd64.deb ...
Unpacking libscitokens0:amd64 (1.1.1-1.1) ...
Selecting previously unselected package libvomsapi1v5:amd64.
Preparing to unpack .../08-libvomsapi1v5_2.1.0~rc2-2_amd64.deb ...
Unpacking libvomsapi1v5:amd64 (2.1.0~rc2-2) ...
Selecting previously unselected package libpcre2-16-0:amd64.
Preparing to unpack .../09-libpcre2-16-0_10.39-3ubuntu0.1_amd64.deb ...
Unpacking libpcre2-16-0:amd64 (10.39-3ubuntu0.1) ...
Selecting previously unselected package libpcre2-32-0:amd64.
Preparing to unpack .../10-libpcre2-32-0_10.39-3ubuntu0.1_amd64.deb ...
Unpacking libpcre2-32-0:amd64 (10.39-3ubuntu0.1) ...
Selecting previously unselected package libpcre2-posix3:amd64.
Preparing to unpack .../11-libpcre2-posix3_10.39-3ubuntu0.1_amd64.deb ...
Unpacking libpcre2-posix3:amd64 (10.39-3ubuntu0.1) ...
Selecting previously unselected package pcre2-utils.
Preparing to unpack .../12-pcre2-utils_10.39-3ubuntu0.1_amd64.deb ...
Unpacking pcre2-utils (10.39-3ubuntu0.1) ...
Selecting previously unselected package condor-upgrade-checks.
Preparing to unpack .../13-condor-upgrade-checks_23.9.6-1.1_all.deb ...
Unpacking condor-upgrade-checks (23.9.6-1.1) ...
Selecting previously unselected package libboost-python1.74.0.
Preparing to unpack .../14-libboost-python1.74.0_1.74.0-14ubuntu3_amd64.deb ...
Unpacking libboost-python1.74.0 (1.74.0-14ubuntu3) ...
Selecting previously unselected package condor.
Preparing to unpack .../15-condor_23.9.6-1.1_amd64.deb ...
Unpacking condor (23.9.6-1.1) ...
Selecting previously unselected package pelican.
Preparing to unpack .../16-pelican_7.9.9-1_amd64.deb ...
Unpacking pelican (7.9.9-1) ...
Selecting previously unselected package pelican-osdf-compat.
Preparing to unpack .../17-pelican-osdf-compat_7.9.9-1_amd64.deb ...
Unpacking pelican-osdf-compat (7.9.9-1) ...
Setting up libscitokens0:amd64 (1.1.1-1.1) ...
Setting up libvomsapi1v5:amd64 (2.1.0~rc2-2) ...
Setting up fonts-glyphicons-halflings (1.009~3.4.1+dfsg-2) ...
Setting up libpcre2-16-0:amd64 (10.39-3ubuntu0.1) ...
Setting up libpcre2-32-0:amd64 (10.39-3ubuntu0.1) ...
Setting up libmunge2 (0.5.14-6) ...
Setting up pelican (7.9.9-1) ...
Setting up python3-certifi (2020.6.20-1) ...
Setting up python3-urllib3 (1.26.5-1~exp1ubuntu0.1) ...
Setting up libpcre2-posix3:amd64 (10.39-3ubuntu0.1) ...
Setting up libboost-python1.74.0 (1.74.0-14ubuntu3) ...
Setting up pelican-osdf-compat (7.9.9-1) ...
Setting up libdate-manip-perl (6.86-1) ...
Setting up pcre2-utils (10.39-3ubuntu0.1) ...
Setting up libjs-bootstrap (3.4.1+dfsg-2) ...
Setting up python3-requests (2.25.1+dfsg-2ubuntu0.1) ...
Setting up condor-upgrade-checks (23.9.6-1.1) ...
Setting up condor (23.9.6-1.1) ...
System has not been booted with systemd as init system (PID 1). Can't operate.
Failed to connect to bus: Host is down
Created symlink /etc/systemd/system/multi-user.target.wants/condor.service → /lib/systemd/system/condor.service.
Processing triggers for libc-bin (2.35-0ubuntu3.8) ...
Processing triggers for man-db (2.10.2-1) ...
NEEDRESTART-VER: 3.5
NEEDRESTART-KCUR: 5.4.0-149-generic
NEEDRESTART-KSTA: 0
NEEDRESTART-UCSTA: 0

# Configuring role, if any ...
Account: condor_pool@DataCenterCompute000
CredType: password

Operation succeeded.

# Start the HTCondor service in the background (without systemd)
+ sh -c condor_master

root@DataCenterCompute000:~#
```

It looks like there is a problem with using `systemd` within the Zun containers by default.
```
System has not been booted with systemd as init system (PID 1). Can't operate.
```
Checking with the ARA team to see if this is a configuration choice in their deployment or simply a limitation of Zun. For the time being, we will processed with the manual backgrounding of the HTCondor processes/daemons as instructed. In any case, the HTCondor daemons for the central manager still appear to have started up automatically upon installation.

```
top - 18:55:46 up 444 days, 23:05,  0 users,  load average: 0.21, 0.31, 0.29
Tasks:  10 total,   1 running,   9 sleeping,   0 stopped,   0 zombie
%Cpu(s):  0.0 us,  0.0 sy,  0.0 ni,100.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
MiB Mem : 386420.9 total, 336092.3 free,   8853.6 used,  41474.9 buff/cache
MiB Swap:   8192.0 total,   8182.4 free,      9.6 used. 374970.5 avail Mem 

    PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND
      1 root      20   0    4620   3632   3196 S   0.0   0.0   0:00.02 bash
  10132 root      20   0   15424   5432   3804 S   0.0   0.0   0:00.00 sshd
  10149 root      20   0   17168  11292   8920 S   0.0   0.0   0:00.15 sshd
  10204 root      20   0    6200   5404   3620 S   0.0   0.0   0:00.02 bash
  11423 condor    20   0   22208  13060  10884 S   0.0   0.0   0:00.01 condor_master
  11457 root      20   0    8612   4296   3972 S   0.0   0.0   0:00.00 condor_procd
  11458 condor    20   0   18448  14040  12480 S   0.0   0.0   0:00.01 condor_shared_p
  11459 condor    20   0   19308  15776  13624 S   0.0   0.0   0:00.04 condor_collecto
  11460 condor    20   0   19036  15048  13128 S   0.0   0.0   0:00.04 condor_negotiat
  11522 root      20   0    7796   3416   3048 R   0.0   0.0   0:00.00 top
```
