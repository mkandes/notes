# Serving headless VNC via login nodes?

```
[mkandes@exp-7-59 ~]$ ifconfig
eno1: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 9000
        inet 10.21.7.59  netmask 255.255.0.0  broadcast 10.21.255.255
        inet6 fe80::e643:4bff:fec3:8caa  prefixlen 64  scopeid 0x20<link>
        ether e4:43:4b:c3:8c:aa  txqueuelen 1000  (Ethernet)
        RX packets 2052724578  bytes 7897005855930 (7.1 TiB)
        RX errors 0  dropped 12393  overruns 0  frame 0
        TX packets 502787882  bytes 95742669553 (89.1 GiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

eno1.450: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 9000
        inet 198.202.102.92  netmask 255.255.252.0  broadcast 198.202.103.255
        inet6 fe80::e643:4bff:fec3:8caa  prefixlen 64  scopeid 0x20<link>
        ether e4:43:4b:c3:8c:aa  txqueuelen 1000  (Ethernet)
        RX packets 354806799  bytes 1033989966215 (962.9 GiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 77147478  bytes 47493741570 (44.2 GiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

ib0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 4092
        inet 10.22.7.59  netmask 255.255.0.0  broadcast 10.22.255.255
        inet6 fe80::1e34:da03:5a:41a0  prefixlen 64  scopeid 0x20<link>
Infiniband hardware address can be incorrect! Please read BUGS section in ifconfig(8).
        infiniband 00:00:10:29:FE:80:00:00:00:00:00:00:00:00:00:00:00:00:00:00  txqueuelen 256  (InfiniBand)
        RX packets 325363896  bytes 737308889136 (686.6 GiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 588575494  bytes 1755636414808 (1.5 TiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 69962947  bytes 262266205776 (244.2 GiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 69962947  bytes 262266205776 (244.2 GiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

[mkandes@exp-7-59 ~]$
```

```
[mkandes@exp-7-59 ~]$ ip addr
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: eno3: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group default qlen 1000
    link/ether e4:43:4b:c3:8c:ca brd ff:ff:ff:ff:ff:ff
    altname enp1s0f0
3: eno1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9000 qdisc mq state UP group default qlen 1000
    link/ether e4:43:4b:c3:8c:aa brd ff:ff:ff:ff:ff:ff
    altname enp5s0f0
    inet 10.21.7.59/16 brd 10.21.255.255 scope global eno1
       valid_lft forever preferred_lft forever
    inet6 fe80::e643:4bff:fec3:8caa/64 scope link 
       valid_lft forever preferred_lft forever
4: eno4: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group default qlen 1000
    link/ether e4:43:4b:c3:8c:cb brd ff:ff:ff:ff:ff:ff
    altname enp1s0f1
5: eno2: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group default qlen 1000
    link/ether e4:43:4b:c3:8c:ac brd ff:ff:ff:ff:ff:ff
    altname enp5s0f1
6: ib0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 4092 qdisc mq state UP group default qlen 256
    link/infiniband 00:00:10:29:fe:80:00:00:00:00:00:00:1c:34:da:03:00:5a:41:a0 brd 00:ff:ff:ff:ff:12:40:1b:ff:ff:00:00:00:00:00:00:ff:ff:ff:ff
    inet 10.22.7.59/16 brd 10.22.255.255 scope global ib0
       valid_lft forever preferred_lft forever
    inet6 fe80::1e34:da03:5a:41a0/64 scope link 
       valid_lft forever preferred_lft forever
7: eno1.450@eno1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9000 qdisc noqueue state UP group default qlen 1000
    link/ether e4:43:4b:c3:8c:aa brd ff:ff:ff:ff:ff:ff
    inet 198.202.102.92/22 brd 198.202.103.255 scope global eno1.450
       valid_lft forever preferred_lft forever
    inet6 fe80::e643:4bff:fec3:8caa/64 scope link 
       valid_lft forever preferred_lft forever
[mkandes@exp-7-59 ~]$
```

```
[mkandes@login01 ~]$ host 10.22.7.59
59.7.22.10.in-addr.arpa domain name pointer exp-7-59.ib.cluster.
[mkandes@login01 ~]$ host 10.21.7.59
59.7.21.10.in-addr.arpa domain name pointer exp-7-59.cm.cluster.
[mkandes@login01 ~]$ host 198.202.102.92
92.102.202.198.in-addr.arpa domain name pointer exp-7-59.expanse.sdsc.edu.
[mkandes@login01 ~]$
```

```
Singularity> lsof -i :5901
COMMAND      PID    USER   FD   TYPE    DEVICE SIZE/OFF NODE NAME
Xtigervnc 480294 mkandes    9u  IPv4 677000321      0t0  TCP localhost.localdomain:5901 (LISTEN)
Xtigervnc 480294 mkandes   10u  IPv6 677000322      0t0  TCP localhost6.localdomain6:5901 (LISTEN)
Singularity>
```

```
mkandes@hardtack:~$ ssh -f -N -J login01.expanse.sdsc.edu -L 5901:localhost:5901 10.21.7.59
(mkandes@login01.expanse.sdsc.edu) TOTP code for mkandes: 548975
(mkandes@10.21.7.59) TOTP code for mkandes: 853812
mkandes@hardtack:~$
```

```
mkandes@hardtack:~$ lsof -i :5901
COMMAND     PID    USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
ssh       14796 mkandes    3u  IPv6  73684      0t0  TCP ip6-localhost:5901 (LISTEN)
ssh       14796 mkandes    6u  IPv4  73685      0t0  TCP localhost:5901 (LISTEN)
ssh       14796 mkandes    7u  IPv4  78608      0t0  TCP localhost:5901->localhost:53366 (ESTABLISHED)
xtigervnc 14803 mkandes    3u  IPv4  82014      0t0  TCP localhost:53366->localhost:5901 (ESTABLISHED)
mkandes@hardtack:~$
```

# Reference(s):
- https://unix.stackexchange.com/questions/693885/hardening-reverse-ssh-tunnel-via-jump-host
- https://ramesh-sahoo.medium.com/accessing-remote-servers-via-ssh-tunnel-reverse-ssh-tunnels-ssh-socks-proxy-ssh-via-a-jump-5e5cfddaf2a3
- https://ryanwendel.medium.com/forwarding-reverse-shells-through-a-jump-box-using-ssh-7111f1d55e3a
- https://serverfault.com/questions/1060445/vnc-proxy-jump-possibly-with-ssh
- https://superuser.com/questions/96489/an-ssh-tunnel-via-multiple-hops
- https://blog.ippon.tech/ssh-reverse-tunnel-to-private-database
- https://goteleport.com/blog/ssh-proxyjump-ssh-proxycommand/
- https://forums.freebsd.org/threads/ssh-tunnel-to-access-bhyve-vnc-over-jump-host.79823/
