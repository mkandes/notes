# How to install and run MLCFlow (on Expanse)

### Option 1: Using JupyterLab for interactive development and testing

Before starting a new interactive development session to continue your MLCFlow exploration and testing work, you may want to first remove cached configuration and log information placed in your HOME directory.

*COMMAND:*
```
rm -rf .galyleo/ .conda/ .nv/ .local/ .ipython/ .jupyter/ .cache/ .mlc-log.txt mlc-run-script-versions.json version_info.json hardware/
```
*OUTPUT:*

```
N/A
```

Make any final changes to your conda environment YAML file prior to launching your JupyterLab with galyleo.

*FILE:*
```
name: mlperf-inference-vision-image-classification-resnet50-imagenet-python-edge-onnxruntime-cpu

channels:
  - conda-forge

dependencies:
  - python=3.12
  - pip
  - wheel
  - numpy=1.26.4=py312heda63a1_0
  - opencv=4.11.0=headless_py312hcb6eebc_9
  - pillow=11.2.1=py312h80c1187_0
  - onnxruntime=1.22.0=py312h2a9cbd2_0_cpu
  - jupyterlab
  - matplotlib
  - networkx
#  - pip:
#    - mlcommons-loadgen==5.1.0

variables:
  ENV_VAR_X: 'MLC_REPOS'
```

When ready, launch your JupyterLab session on Expanse with galyleo. First, make sure galyleo is in your PATH.


*COMMAND:*
```
export PATH="/cm/shared/apps/sdsc/galyleo:${PATH}"
```
*OUTPUT:*
```
N/A
```

Then run your launch command.

*COMMAND:*
```
galyleo launch --account use300 --partition ind-compute --cpus 128 --memory 242 --time-limit 08:00:00 --conda-yml mlperf-inference-vision-image-classification-resnet50-imagenet-python-edge-onnxruntime-cpu.yaml
```
*OUTPUT:*
```
[mkandes@login02 ~]$ galyleo launch --account use300 --partition ind-compute --cpus 128 --memory 242 --time-limit 08:00:00 --conda-yml mlperf-inference-vision-image-classification-resnet50-imagenet-python-edge-onnxruntime-cpu.yaml
Preparing galyleo for launch into Jupyter orbit ...
Listing all launch parameters ...
  command-line options       : values
    -A | --account           : use300
    -R | --reservation       : 
    -p | --partition         : ind-compute
    -q | --qos               : 
    -N | --nodes             : 1
    -c | --cpus              : 128
    -m | --memory            : 242 GB
    -g | --gpus              : 
       | --gres              : 
    -t | --time-limit        : 08:00:00
    -C | --constraint        : 
    -i | --interface         : lab
    -d | --notebook-dir      : 
       | --scratch-dir       : "/scratch/${USER}/job_${SLURM_JOB_ID}"
    -e | --env-modules       : singularitypro
       | --append-modulepath : 
    -s | --sif               : 
    -B | --bind              : 
       | --nv                : 
       | --conda-init        : 
       | --conda-env         : 
       | --conda-yml         : /home/mkandes/mlperf-inference-vision-image-classification-resnet50-imagenet-python-edge-onnxruntime-cpu.yaml
       | --conda-version     : latest
       | --mamba             : false
       | --cache             : false
       | --spark-home        : 
       | --disable-checklist : false
       | --checklist-timeout : 10 s
    -Q | --quiet             : 1
Your token is 
monotone-sincere-slouchy
200
Generating Jupyter launch script ...
md5sum: mlperf-inference-vision-image-classification-resnet50-imagenet-python-edge-onnxruntime-cpu.md5: No such file or directory
Submitted Jupyter launch script to Slurm. Your SLURM_JOB_ID is 40829790.
Success! Token linked to jobid.
Please copy and paste the HTTPS URL provided below into your web browser.
Do not share this URL with others. It is the password to your Jupyter notebook session.
Your Jupyter notebook session will begin once compute resources are allocated to your job by the scheduler.
https://monotone-sincere-slouchy.expanse-user-content.sdsc.edu/?token=4186c3a33f9fc6fdad5f
[mkandes@login02 ~]$
```

When your JupyterLab session begins, you can use the Terminal application to interactively develop and test your MLCFlow deployment and MLPerf Inference Benchmark.

