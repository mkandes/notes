# Deploying sdsc-0.21.2 on Expanse: Part III

```
mkandes@hardtack:~$ ssh exp
Last login: Wed May  7 12:33:55 2025 from 208.58.212.11
[mkandes@login01 ~]$ sudo -u spack_cpu ssh login01
PIN+Yubi: 
Welcome to Bright release         9.0

                                                         Based on Rocky Linux 8
                                                                    ID: #000002

--------------------------------------------------------------------------------

                                 WELCOME TO
                  _______  __ ____  ___    _   _______ ______
                 / ____/ |/ // __ \/   |  / | / / ___// ____/
                / __/  |   // /_/ / /| | /  |/ /\__ \/ __/
               / /___ /   |/ ____/ ___ |/ /|  /___/ / /___
              /_____//_/|_/_/   /_/  |_/_/ |_//____/_____/

--------------------------------------------------------------------------------

Use the following commands to adjust your environment:

'module avail'            - show available modules
'module add <module>'     - adds a module to your environment for this session
'module initadd <module>' - configure module to be loaded at every login

-------------------------------------------------------------------------------
Last login: Wed May  7 12:41:28 2025 from 198.202.100.13
[spack_cpu@login01 ~]$
```

```
[spack_cpu@login01 ~]$ srun --partition=ind-shared --reservation=root_73  --account=use300 --nodes=1 --nodelist=exp-15-56 --ntasks-per-node=1 --cpus-per-task=16 --mem=32G --time=12:00:00 --pty --wait=0 /bin/bash
[spack_cpu@exp-15-56 ~]$
```

```
[spack_cpu@exp-15-56 ~]$ cd /cm/shared/apps/spack/
[spack_cpu@exp-15-56 spack]$ ls
0.15.4  0.17.3  0.21.2  cpu  gpu
[spack_cpu@exp-15-56 spack]$
```

```
[spack_cpu@exp-15-56 spack]$ cd 0.21.2/
[spack_cpu@exp-15-56 0.21.2]$ ls -lahtr
total 0
drwxrwsr-x 7 root spack 5 May  7 12:44 ..
drwxrwsr-x 2 root spack 0 May  7 12:48 .
[spack_cpu@exp-15-56 0.21.2]$
```

```
[spack_cpu@exp-15-56 0.21.2]$ mkdir cpu
[spack_cpu@exp-15-56 0.21.2]$ ls -lahtr
total 0
drwxrwsr-x 7 root      spack 5 May  7 12:44 ..
drwxr-sr-x 2 spack_cpu spack 0 May  7 19:23 cpu
drwxrwsr-x 3 root      spack 1 May  7 19:23 .
[spack_cpu@exp-15-56 0.21.2]$ 
```

```
[spack_cpu@exp-15-56 0.21.2]$ cd cpu/
[spack_cpu@exp-15-56 cpu]$ git clone https://github.com/sdsc/spack.git
Cloning into 'spack'...
remote: Enumerating objects: 625834, done.
remote: Total 625834 (delta 0), reused 0 (delta 0), pack-reused 625834 (from 1)
Receiving objects: 100% (625834/625834), 455.92 MiB | 47.52 MiB/s, done.
Resolving deltas: 100% (291384/291384), done.
Updating files: 100% (12153/12153), done.
[spack_cpu@exp-15-56 cpu]$ ls -lahtr
total 0
drwxrwsr-x 3 root      spack  1 May  7 19:23 ..
drwxr-sr-x 3 spack_cpu spack  1 May  7 19:24 .
drwxr-sr-x 9 spack_cpu spack 25 May  7 19:25 spack
[spack_cpu@exp-15-56 cpu]$
```

```
[spack_cpu@exp-15-56 cpu]$ mv spack/ dev/
[spack_cpu@exp-15-56 cpu]$ pwd
/cm/shared/apps/spack/0.21.2/cpu
[spack_cpu@exp-15-56 cpu]$ ls -lahtr
total 0
drwxrwsr-x 3 root      spack  1 May  7 19:23 ..
drwxr-sr-x 9 spack_cpu spack 25 May  7 19:25 dev
drwxr-sr-x 3 spack_cpu spack  1 May  7 19:25 .
[spack_cpu@exp-15-56 cpu]$
```

```
[spack_cpu@exp-15-56 cpu]$ cd dev/
[spack_cpu@exp-15-56 dev]$ ls
bin           COPYRIGHT  LICENSE-APACHE  pyproject.toml  SECURITY.md
CHANGELOG.md  etc        LICENSE-MIT     pytest.ini      share
CITATION.cff  lib        NOTICE          README.md       var
[spack_cpu@exp-15-56 dev]$ git branch
* sdsc-0.21.2
[spack_cpu@exp-15-56 dev]$
```

```
[spack_cpu@exp-15-56 dev]$ cd etc/spack/
[spack_cpu@exp-15-56 spack]$ ls
defaults  repos.yaml  sdsc
[spack_cpu@exp-15-56 spack]$ cd sdsc/
[spack_cpu@exp-15-56 sdsc]$ ls
exp
[spack_cpu@exp-15-56 sdsc]$ cd exp/
[spack_cpu@exp-15-56 exp]$ ls
cpu  gpu
[spack_cpu@exp-15-56 exp]$ cd cpu/
[spack_cpu@exp-15-56 cpu]$ ls
dev
[spack_cpu@exp-15-56 cpu]$ cd dev/
[spack_cpu@exp-15-56 dev]$ ls
deploy.sh  specs  yamls
[spack_cpu@exp-15-56 dev]$ pwd
/cm/shared/apps/spack/0.21.2/cpu/dev/etc/spack/sdsc/exp/cpu/dev
[spack_cpu@exp-15-56 dev]$
```

```
[spack_cpu@exp-15-56 dev]$ pwd
/cm/shared/apps/spack/0.21.2/cpu/dev/etc/spack/sdsc/exp/cpu/dev
[spack_cpu@exp-15-56 dev]$ ls -lahtr
total 36K
drwxr-sr-x 3 spack_cpu spack   1 May  7 19:25 ..
drwxr-sr-x 4 spack_cpu spack  24 May  7 19:25 specs
drwxr-sr-x 2 spack_cpu spack   3 May  7 19:25 yamls
-rw-r--r-- 1 spack_cpu spack 36K May  7 19:35 deploy.sh
drwxr-sr-x 4 spack_cpu spack   3 May  7 19:35 .
[spack_cpu@exp-15-56 dev]$ grep SPACK_INSTANCE_DIR deploy.sh 
declare -xr SPACK_INSTANCE_DIR='/home/mkandes/software/spack/repos/sdsc/cpu'
. "${SPACK_INSTANCE_DIR}/share/spack/setup-env.sh"
cp -p yamls/compilers.yaml "${SPACK_INSTANCE_DIR}/etc/spack/compilers.yaml"
cp -p yamls/modules.yaml "${SPACK_INSTANCE_DIR}/etc/spack/modules.yaml"
cp -p yamls/packages.yaml "${SPACK_INSTANCE_DIR}/etc/spack/packages.yaml"
[spack_cpu@exp-15-56 dev]$
```

```
[spack_cpu@exp-15-56 dev]$ sed -i "s|SPACK_INSTANCE_DIR='/home/mkandes/software/spack/repos/sdsc/cpu'|SPACK_INSTANCE_DIR=\"/cm/shared/apps/spack/\${SPACK_VERSION}/\${SPACK_INSTANCE_NAME}/\${SPACK_INSTANCE_VERSION}\"|" deploy.sh
[spack_cpu@exp-15-56 dev]$ grep SPACK_INSTANCE_DIR deploy.sh 
declare -xr SPACK_INSTANCE_DIR="/cm/shared/apps/spack/${SPACK_VERSION}/${SPACK_INSTANCE_NAME}/${SPACK_INSTANCE_VERSION}"
. "${SPACK_INSTANCE_DIR}/share/spack/setup-env.sh"
cp -p yamls/compilers.yaml "${SPACK_INSTANCE_DIR}/etc/spack/compilers.yaml"
cp -p yamls/modules.yaml "${SPACK_INSTANCE_DIR}/etc/spack/modules.yaml"
cp -p yamls/packages.yaml "${SPACK_INSTANCE_DIR}/etc/spack/packages.yaml"
[spack_cpu@exp-15-56 dev]$
```
