# Deploying spack-0.21.2 on Expanse: Part VI

```
[mkandes@login02 ~]$ sudo -u spack_gpu ssh login02
PIN+Yubi: 
Welcome to Bright release         9.0

                                                         Based on Rocky Linux 8
                                                                    ID: #000002

--------------------------------------------------------------------------------

                                 WELCOME TO
                  _______  __ ____  ___    _   _______ ______
                 / ____/ |/ // __ \/   |  / | / / ___// ____/
                / __/  |   // /_/ / /| | /  |/ /\__ \/ __/
               / /___ /   |/ ____/ ___ |/ /|  /___/ / /___
              /_____//_/|_/_/   /_/  |_/_/ |_//____/_____/

--------------------------------------------------------------------------------

Use the following commands to adjust your environment:

'module avail'            - show available modules
'module add <module>'     - adds a module to your environment for this session
'module initadd <module>' - configure module to be loaded at every login

-------------------------------------------------------------------------------
[spack_gpu@login02 ~]$
```

```
[spack_gpu@login02 ~]$ ls -lahtr
total 164K
-rw-r--r--    1 spack_gpu spack  334 May 11  2019 .emacs
-rw-r--r--    1 spack_gpu spack  141 Nov  8  2019 .bash_profile
-rw-r--r--    1 spack_gpu spack   18 Nov  8  2019 .bash_logout
-rw-r--r--    1 spack_gpu spack  658 Mar 20  2020 .zshrc
-rw-r--r--    1 spack_gpu spack  172 Apr 23  2020 .kshrc
drwx------    2 spack_gpu spack    3 Jan 13  2021 .ssh
-rw-r--r--    1 spack_gpu spack 1.6K Jan 27  2023 .bashrc
-rw-r--r--    1 spack_gpu spack   75 Jan 28  2023 .gitconfig
drwxr-xr-x    5 spack_gpu spack    5 Apr 22  2023 .spack
drwxr-xr-x    8 spack_gpu spack    8 Apr 24  2023 software
drwxr-xr-x    2 spack_gpu spack    3 Sep 18  2023 .vim
drwxr-xr-x    3 spack_gpu spack    3 Sep 19  2023 .cmake
drwx------    3 spack_gpu spack    3 Sep 19  2023 .nv
drwxr-xr-x    2 spack_gpu spack    3 Sep 20  2023 .conda
drwxr-xr-x    4 spack_gpu spack    4 Sep 20  2023 .cache
drwx------    5 spack_gpu spack    5 Sep 20  2023 .config
-rw-r--r--    1 spack_gpu spack  180 Oct 10  2023 .wget-hsts
-rw-------    1 spack_gpu spack  38K Oct 11  2023 .viminfo
-rw-------    1 spack_gpu spack  194 Sep  6  2024 .lesshst
drwxr-x---   11 spack_gpu spack   22 Sep  6  2024 .
-rw-------    1 spack_gpu spack 111K Nov 13 08:14 .bash_history
drwxr-xr-x 5459 root      root     0 May 13 18:15 ..
[spack_gpu@login02 ~]$
```

```
[spack_gpu@login02 ~]$ mv .cmake/ .cmake.bak/
[spack_gpu@login02 ~]$ mv .conda/ .conda.bak/
[spack_gpu@login02 ~]$ mv .cache/ .cache.bak/
[spack_gpu@login02 ~]$ mv .spack/ .spack.bak/
[spack_gpu@login02 ~]$ ls .config/
htop  matplotlib  procps
[spack_gpu@login02 ~]$ rm -rf .config/
[spack_gpu@login02 ~]$ ls -lahtr
total 163K
-rw-r--r--    1 spack_gpu spack  334 May 11  2019 .emacs
-rw-r--r--    1 spack_gpu spack  141 Nov  8  2019 .bash_profile
-rw-r--r--    1 spack_gpu spack   18 Nov  8  2019 .bash_logout
-rw-r--r--    1 spack_gpu spack  658 Mar 20  2020 .zshrc
-rw-r--r--    1 spack_gpu spack  172 Apr 23  2020 .kshrc
drwx------    2 spack_gpu spack    3 Jan 13  2021 .ssh
-rw-r--r--    1 spack_gpu spack 1.6K Jan 27  2023 .bashrc
-rw-r--r--    1 spack_gpu spack   75 Jan 28  2023 .gitconfig
drwxr-xr-x    5 spack_gpu spack    5 Apr 22  2023 .spack.bak
drwxr-xr-x    8 spack_gpu spack    8 Apr 24  2023 software
drwxr-xr-x    2 spack_gpu spack    3 Sep 18  2023 .vim
drwxr-xr-x    3 spack_gpu spack    3 Sep 19  2023 .cmake.bak
drwx------    3 spack_gpu spack    3 Sep 19  2023 .nv
drwxr-xr-x    2 spack_gpu spack    3 Sep 20  2023 .conda.bak
drwxr-xr-x    4 spack_gpu spack    4 Sep 20  2023 .cache.bak
-rw-r--r--    1 spack_gpu spack  180 Oct 10  2023 .wget-hsts
-rw-------    1 spack_gpu spack  38K Oct 11  2023 .viminfo
-rw-------    1 spack_gpu spack  194 Sep  6  2024 .lesshst
-rw-------    1 spack_gpu spack 111K Nov 13 08:14 .bash_history
drwxr-xr-x 5459 root      root     0 May 13 18:15 ..
drwxr-x---   10 spack_gpu spack   21 May 13 18:37 .
[spack_gpu@login02 ~]$
```

```
[spack_gpu@login02 ~]$ srun --partition=ind-gpu-shared --reservation=root_73  --account=use300 --nodes=1 --ntasks-per-node=1 --cpus-per-task=1 --mem=92G --gpus=1 --time=00:30:00 --pty --wait=0 /bin/bash
srun: error: Unable to allocate resources: Invalid qos specification
[spack_gpu@login02 ~]$
```

```
[spack_gpu@login02 ~]$ sacctmgr show assoc format=user,qos%144
      User                                                                                                                                              QOS 
---------- ------------------------------------------------------------------------------------------------------------------------------------------------ 
                                                                                       debug-normal,large-shared-normal,normal,preempt-normal,shared-normal 
                                                                                       debug-normal,large-shared-normal,normal,preempt-normal,shared-normal 
 spack_gpu                                                                             debug-normal,large-shared-normal,normal,preempt-normal,shared-normal 
[spack_gpu@login02 ~]$
```

```
[mkandes@login01 ~]$ sacctmgr show assoc format=user,qos%320 where user=mkandes
      User                                                                                                                                                                                                                                                                                                                              QOS 
---------- -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
   mkandes                                                                                                                                                                                                                                                             debug-normal,large-shared-normal,normal,preempt-normal,shared-normal 
   mkandes                                                                                                                                                          debug-normal,gpu-debug-normal,gpu-normal,gpu-preempt-normal,gpu-shared-normal,ind-shared-oneweek,large-shared-normal,normal,preempt-normal,shared-normal,shared-oneweek 
   mkandes                                                                                                                                                          debug-normal,gpu-debug-normal,gpu-normal,gpu-preempt-normal,gpu-shared-normal,ind-shared-oneweek,large-shared-normal,normal,preempt-normal,shared-normal,shared-oneweek 
   mkandes                                                                                                                                                          debug-normal,gpu-debug-normal,gpu-normal,gpu-preempt-normal,gpu-shared-normal,ind-shared-oneweek,large-shared-normal,normal,preempt-normal,shared-normal,shared-oneweek 
   mkandes                                                                                                                                                          debug-normal,gpu-debug-normal,gpu-normal,gpu-preempt-normal,gpu-shared-normal,ind-shared-oneweek,large-shared-normal,normal,preempt-normal,shared-normal,shared-oneweek 
   mkandes                     cw3e-normal,cw3e-shared-normal,debug-normal,gpu-debug-normal,gpu-normal,gpu-preempt-normal,gpu-shared-normal,gpu-unlim,ind-gpu-normal,ind-gpu-shared-normal,ind-normal,ind-oneweek,ind-shared-normal,ind-shared-oneweek,large-shared-normal,normal,oneweek,preempt-normal,shared-normal,shared-oneweek,unlim 
[mkandes@login01 ~]$
```

```
[spack_gpu@login02 ~]$ scontrol show partition ind-gpu-shared
PartitionName=ind-gpu-shared
   AllowGroups=ALL AllowAccounts=ALL AllowQos=ind-gpu-shared-normal,ind-gpu-shared-janssen,gpu-unlim
   AllocNodes=ALL Default=NO QoS=N/A
   DefaultTime=01:00:00 DisableRootJobs=NO ExclusiveUser=NO GraceTime=0 Hidden=NO
   MaxNodes=1 MaxTime=2-00:00:00 MinNodes=1 LLN=NO MaxCPUsPerNode=64 MaxCPUsPerSocket=UNLIMITED
   Nodes=exp-15-[57-60]
   PriorityJobFactor=1 PriorityTier=300 RootOnly=NO ReqResv=NO OverSubscribe=NO
   OverTimeLimit=NONE PreemptMode=OFF
   State=UP TotalCPUs=160 TotalNodes=4 SelectTypeParameters=NONE
   JobDefaults=(null)
   DefMemPerCPU=1024 MaxMemPerNode=376832
   TRES=cpu=160,mem=1542000M,node=4,billing=57600,gres/gpu=16
   TRESBillingWeights=gres/gpu=3600,cpu=360.00,mem=37.40G,node=0
   ResumeTimeout=GLOBAL SuspendTimeout=GLOBAL SuspendTime=GLOBAL PowerDownOnIdle=NO

[spack_gpu@login02 ~]$
```

```
[mkandes@login01 ~]$ sacctmgr --immediate modify user spack_gpu set qos+=gpu-debug-normal,gpu-normal,gpu-preempt-normal,gpu-shared-normal
 Modified user associations...
  C = expanse    A = use300               U = spack_gpu
[mkandes@login01 ~]$ sacctmgr show assoc format=user,account,qos%128 where user=spack_gpu
      User    Account                                                                                                                              QOS 
---------- ---------- -------------------------------------------------------------------------------------------------------------------------------- 
 spack_gpu     use300 debug-normal,gpu-debug-normal,gpu-normal,gpu-preempt-normal,gpu-shared-normal,large-shared-normal,normal,preempt-normal,shared-+ 
[mkandes@login01 ~]$ sacctmgr show assoc format=user,account,qos%192 where user=spack_gpu
      User    Account                                                                                                                                                                                              QOS 
---------- ---------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 
 spack_gpu     use300                                                            debug-normal,gpu-debug-normal,gpu-normal,gpu-preempt-normal,gpu-shared-normal,large-shared-normal,normal,preempt-normal,shared-normal 
[mkandes@login01 ~]$
```

```
[mkandes@login01 ~]$ sacctmgr --immediate modify user spack_gpu set qos+=gpu-unlim,ind-gpu-normal,ind-gpu-shared-normal
 Modified user associations...
  C = expanse    A = use300               U = spack_gpu
[mkandes@login01 ~]$ sacctmgr show assoc format=user,account,qos%256 where user=spack_gpu
      User    Account                                                                                                                                                                                                                                                              QOS 
---------- ---------- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
 spack_gpu     use300                                                                             debug-normal,gpu-debug-normal,gpu-normal,gpu-preempt-normal,gpu-shared-normal,gpu-unlim,ind-gpu-normal,ind-gpu-shared-normal,large-shared-normal,normal,preempt-normal,shared-normal 
[mkandes@login01 ~]$ sacctmgr show assoc format=user,account,qos%192 where user=spack_gpu
      User    Account                                                                                                                                                                                              QOS 
---------- ---------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 
 spack_gpu     use300             debug-normal,gpu-debug-normal,gpu-normal,gpu-preempt-normal,gpu-shared-normal,gpu-unlim,ind-gpu-normal,ind-gpu-shared-normal,large-shared-normal,normal,preempt-normal,shared-normal 
[mkandes@login01 ~]$ 
```
