# Setting up perfSONAR on JS2 + AraHaul

### perfSONAR Central Archive on JetStream2 (JS2)

```
curl -s https://downloads.perfsonar.net/install | sh -s - --auto-updates --add perfsonar-grafana --add perfsonar-grafana-toolkit --add perfsonar-psconfig-hostmetrics --add perfsonar-psconfig-publisher archive /tmp/perfSONAR-pSConfig-AraHaul.json
```

```
apt-get -y install ntp
```

```
apt-get -y install perfsonar-toolkit-ntp
```

```
/usr/lib/perfsonar/scripts/configure_ntpd new
```

```
systemctl restart ntp
```

```
systemctl status ntp
```

```
systemctl restart apache2
```

```
psconfig publish /tmp/perfSONAR-pSConfig-AraHaul.json
```

```
/usr/lib/perfsonar/archive/perfsonar-scripts/psconfig_archive.sh
```

### perfSONAR TestPoint on AraHaul at Wilson Hall

```
root@WilsonHall-Host-000:~# ip -br addr show to 192.168.42.129 | awk '{print $1}'
eth2@if11
root@WilsonHall-Host-000:~# ip addr
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
760: eth0@if761: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1350 qdisc noqueue state UP group default qlen 1000
    link/ether fa:16:3e:f0:97:c9 brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 10.0.4.211/24 brd 10.0.4.255 scope global eth0
       valid_lft forever preferred_lft forever
765: eth1@if10: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UNKNOWN group default 
    link/ether 68:05:ca:fd:d7:68 brd ff:ff:ff:ff:ff:ff
    inet 192.168.0.129/24 brd 192.168.0.255 scope global eth1
       valid_lft forever preferred_lft forever
767: eth2@if11: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default 
    link/ether 02:42:c0:a8:2a:81 brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 192.168.42.129/24 brd 192.168.42.255 scope global eth2
       valid_lft forever preferred_lft forever
root@WilsonHall-Host-000:~# netstat -ie | grep -B1 "192.168.42.129"
eth2: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.42.129  netmask 255.255.255.0  broadcast 192.168.42.255
root@WilsonHall-Host-000:~# netstat -ie | grep -B1 "192.168.42.129" | head -n1 | awk '{print $1}'
eth2:
root@WilsonHall-Host-000:~# netstat -ie | grep -B1 "192.168.21.10" | head -n1 | awk '{print $1}'
root@WilsonHall-Host-000:~# netstat -ie | grep -B1 "192.168.42.129" | head -n1 | awk '{print $1}'
eth2:
root@WilsonHall-Host-000:~# $ ip -br addr show to 192.168.42.129 | awk '{print $3,$1}'
-bash: $: command not found
root@WilsonHall-Host-000:~# $ ip -br addr show to 192.168.42.129                      
-bash: $: command not found
root@WilsonHall-Host-000:~# ip -br addr show to 192.168.42.129
eth2@if11        UP             192.168.42.129/24 
root@WilsonHall-Host-000:~# host ps10g.sdsc.access-ci.org
ps10g.sdsc.access-ci.org has address 198.202.105.14
root@WilsonHall-Host-000:~# host ps10g.sdsc.access-ci.org
ps10g.sdsc.access-ci.org has address 198.202.105.14
root@WilsonHall-Host-000:~# host ps10g.iu.access-ci.org | awk '{print $4}'
149.165.238.188
root@WilsonHall-Host-000:~# ip route add 149.165.238.188/32 via 192.168.42.1 dev eth2@if11
Cannot find device "eth2@if11"
root@WilsonHall-Host-000:~# ip route add 149.165.238.188/32 via 192.168.42.1 dev 192.168.42.129
Cannot find device "192.168.42.129"
root@WilsonHall-Host-000:~# ip route add 149.165.238.188/32 via 192.168.42.1 dev eth2          
root@WilsonHall-Host-000:~# host ps10g.psc.access-ci.org | awk '{print $4}'
192.231.243.63
address
handled
handled
root@WilsonHall-Host-000:~# ip route add 192.231.243.63/32 via 192.168.42.1 dev eth2
root@WilsonHall-Host-000:~# host ps10g.psc.access-ci.org | awk '{print $4}' | head -n1
192.231.243.63
root@WilsonHall-Host-000:~# host ps10g.sdsc.access-ci.org | awk '{print $4}'           
198.202.105.14
root@WilsonHall-Host-000:~# ip route add 198.202.105.14/32 via 192.168.42.1 dev eth2
root@WilsonHall-Host-000:~#
```

```
root@WilsonHall-Host-000:~# dig ps10g.psc.access-ci.org +short -4
192.231.243.63
```

```
root@WilsonHall-Host-000:~# pscheduler task clock --help             
Usage: task [task-options] clock [test-options]

-h, --help            show this help message and exit
  --dest=DEST           Destination host
  --source=SOURCE       Source address or interface
  --source-node=SOURCE_NODE
                        Source pScheduler node, if different
  --timeout=TIMEOUT     Timeout for each round trip

Examples:

  task clock --dest ps.example.com
      Measure the difference between the local host and ps.example.com.

  task clock --dest ps.example.com --timeout PT5S
      Measure the difference between the local host and ps.example.com
      with a timeout of five seconds for each host.

  task clock --source ps2.example.org --dest ps.example.com
      Measure the time difference between ps2.example.org and
      ps.example.com.
root@WilsonHall-Host-000:~#
```
