# Setting up perfSONAR on JS2 + AraHaul

### perfSONAR Central Archive on JetStream2 (JS2)

```
root@js2-perfsonar-ara-archive:~# apt-get -y install ntp
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following additional packages will be installed:
  libevent-pthreads-2.1-7 libopts25 sntp
Suggested packages:
  ntp-doc
The following packages will be REMOVED:
  systemd-timesyncd
The following NEW packages will be installed:
  libevent-pthreads-2.1-7 libopts25 ntp sntp
0 upgraded, 4 newly installed, 1 to remove and 3 not upgraded.
Need to get 855 kB of archives.
After this operation, 2294 kB of additional disk space will be used.
Get:1 http://nova.clouds.archive.ubuntu.com/ubuntu jammy/universe amd64 libopts25 amd64 1:5.18.16-4 [59.5 kB]
Get:2 http://nova.clouds.archive.ubuntu.com/ubuntu jammy/universe amd64 ntp amd64 1:4.2.8p15+dfsg-1ubuntu2 [721 kB]
Get:3 http://nova.clouds.archive.ubuntu.com/ubuntu jammy/main amd64 libevent-pthreads-2.1-7 amd64 2.1.12-stable-1build3 [7642 B]
Get:4 http://nova.clouds.archive.ubuntu.com/ubuntu jammy/universe amd64 sntp amd64 1:4.2.8p15+dfsg-1ubuntu2 [67.1 kB]
Fetched 855 kB in 0s (3029 kB/s)
Selecting previously unselected package libopts25:amd64.
(Reading database ... 127115 files and directories currently installed.)
Preparing to unpack .../libopts25_1%3a5.18.16-4_amd64.deb ...
Unpacking libopts25:amd64 (1:5.18.16-4) ...
dpkg: systemd-timesyncd: dependency problems, but removing anyway as you requested:
 perfsonar-toolkit-ntp depends on time-daemon; however:
  Package time-daemon is not installed.
  Package systemd-timesyncd which provides time-daemon is to be removed.

(Reading database ... 127120 files and directories currently installed.)
Removing systemd-timesyncd (249.11-0ubuntu3.16) ...
Selecting previously unselected package ntp.
(Reading database ... 127106 files and directories currently installed.)
Preparing to unpack .../ntp_1%3a4.2.8p15+dfsg-1ubuntu2_amd64.deb ...
Unpacking ntp (1:4.2.8p15+dfsg-1ubuntu2) ...
Selecting previously unselected package libevent-pthreads-2.1-7:amd64.
Preparing to unpack .../libevent-pthreads-2.1-7_2.1.12-stable-1build3_amd64.deb ...
Unpacking libevent-pthreads-2.1-7:amd64 (2.1.12-stable-1build3) ...
Selecting previously unselected package sntp.
Preparing to unpack .../sntp_1%3a4.2.8p15+dfsg-1ubuntu2_amd64.deb ...
Unpacking sntp (1:4.2.8p15+dfsg-1ubuntu2) ...
Setting up libopts25:amd64 (1:5.18.16-4) ...
Setting up ntp (1:4.2.8p15+dfsg-1ubuntu2) ...

Configuration file '/etc/ntp.conf'
 ==> File on system created by you or by a script.
 ==> File also in package provided by package maintainer.
   What would you like to do about it ?  Your options are:
    Y or I  : install the package maintainer's version
    N or O  : keep your currently-installed version
      D     : show the differences between the versions
      Z     : start a shell to examine the situation
 The default action is to keep your current version.
*** ntp.conf (Y/I/N/O/D/Z) [default=N] ? Y
Installing new version of config file /etc/ntp.conf ...
Created symlink /etc/systemd/system/network-pre.target.wants/ntp-systemd-netif.path → /lib/systemd/system/ntp-systemd-netif.path.
Created symlink /etc/systemd/system/multi-user.target.wants/ntp.service → /lib/systemd/system/ntp.service.
ntp-systemd-netif.service is a disabled or a static unit, not starting it.
Setting up libevent-pthreads-2.1-7:amd64 (2.1.12-stable-1build3) ...
Setting up sntp (1:4.2.8p15+dfsg-1ubuntu2) ...
Processing triggers for man-db (2.10.2-1) ...
Processing triggers for dbus (1.12.20-2ubuntu4.1) ...
Processing triggers for libc-bin (2.35-0ubuntu3.10) ...
Scanning processes...                                                                                                                             
Scanning candidates...                                                                                                                            
Scanning linux images...                                                                                                                          

Running kernel seems to be up-to-date.

Restarting services...
 systemctl restart packagekit.service

No containers need to be restarted.

No user sessions are running outdated binaries.

No VM guests are running outdated hypervisor (qemu) binaries on this host.
root@js2-perfsonar-ara-archive:~# systemctl status ntp
● ntp.service - Network Time Service
     Loaded: loaded (/lib/systemd/system/ntp.service; enabled; vendor preset: enabled)
     Active: active (running) since Fri 2025-09-12 01:44:35 UTC; 15s ago
       Docs: man:ntpd(8)
    Process: 20144 ExecStart=/usr/lib/ntp/ntp-systemd-wrapper (code=exited, status=0/SUCCESS)
   Main PID: 20150 (ntpd)
      Tasks: 2 (limit: 35881)
     Memory: 1.3M
        CPU: 26ms
     CGroup: /system.slice/ntp.service
             └─20150 /usr/sbin/ntpd -p /var/run/ntpd.pid -g -u 117:125

Sep 12 01:44:39 js2-perfsonar-ara-archive ntpd[20150]: Soliciting pool server 23.186.168.126
Sep 12 01:44:39 js2-perfsonar-ara-archive ntpd[20150]: Soliciting pool server 83.147.242.172
Sep 12 01:44:39 js2-perfsonar-ara-archive ntpd[20150]: Soliciting pool server 198.46.254.130
Sep 12 01:44:40 js2-perfsonar-ara-archive ntpd[20150]: Soliciting pool server 50.117.3.52
Sep 12 01:44:40 js2-perfsonar-ara-archive ntpd[20150]: Soliciting pool server 23.186.168.132
Sep 12 01:44:40 js2-perfsonar-ara-archive ntpd[20150]: Soliciting pool server 170.187.147.56
Sep 12 01:44:40 js2-perfsonar-ara-archive ntpd[20150]: Soliciting pool server 185.125.190.58
Sep 12 01:44:41 js2-perfsonar-ara-archive ntpd[20150]: Soliciting pool server 185.125.190.56
Sep 12 01:44:41 js2-perfsonar-ara-archive ntpd[20150]: Soliciting pool server 23.186.168.125
Sep 12 01:44:41 js2-perfsonar-ara-archive ntpd[20150]: Soliciting pool server 104.167.215.195
root@js2-perfsonar-ara-archive:~#
```

```
root@js2-perfsonar-ara-archive:~# /usr/lib/perfsonar/scripts/configure_ntpd new
root@js2-perfsonar-ara-archive:~# ls -lahtr /etc/ntp.conf
-rw-r--r-- 1 root root 882 Sep 12 01:45 /etc/ntp.conf
root@js2-perfsonar-ara-archive:~# cat -lahtr /etc/ntp.conf
cat: invalid option -- 'l'
Try 'cat --help' for more information.
root@js2-perfsonar-ara-archive:~# cat /etc/ntp.conf
# /etc/ntp.conf, configuration for NTP
# by default act only as a basic NTP client
restrict -4 default nomodify nopeer noquery notrap
restrict -6 default nomodify nopeer noquery notrap
# allow NTP messages from the loopback address, useful for debugging
restrict 127.0.0.1
restrict ::1
logfile /var/log/ntpd
driftfile /var/lib/ntp/ntp.drift
statsdir  /var/lib/ntp/
statistics loopstats peerstats clockstats
filegen loopstats file loopstats type day enable
filegen peerstats file peerstats type day enable
filegen clockstats file clockstats type day enable

# You should have at least 4 NTP servers

server chronos.es.net iburst   # ESnet - New York, NY USA 

server navobs1.gatech.edu iburst   # gatech.edu 

server navobs1.wustl.edu iburst   # wustl.edu 

server now.okstate.edu iburst   # okstate.edu 

server time-d-wwv.nist.gov iburst   # NIST, WWV, Fort Collins, Colorado, D 

root@js2-perfsonar-ara-archive:~# systemctl restart ntp
root@js2-perfsonar-ara-archive:~# systemctl status ntp
● ntp.service - Network Time Service
     Loaded: loaded (/lib/systemd/system/ntp.service; enabled; vendor preset: enabled)
     Active: active (running) since Fri 2025-09-12 01:46:54 UTC; 4s ago
       Docs: man:ntpd(8)
    Process: 20276 ExecStart=/usr/lib/ntp/ntp-systemd-wrapper (code=exited, status=0/SUCCESS)
   Main PID: 20284 (ntpd)
      Tasks: 2 (limit: 35881)
     Memory: 1.3M
        CPU: 21ms
     CGroup: /system.slice/ntp.service
             └─20284 /usr/sbin/ntpd -p /var/run/ntpd.pid -g -u 117:125

Sep 12 01:46:54 js2-perfsonar-ara-archive ntpd[20276]: ntp-4 is maintained by Network Time Foundation,
Sep 12 01:46:54 js2-perfsonar-ara-archive ntpd[20276]: Inc. (NTF), a non-profit 501(c)(3) public-benefit
Sep 12 01:46:54 js2-perfsonar-ara-archive ntpd[20276]: corporation.  Support and training for ntp-4 are
Sep 12 01:46:54 js2-perfsonar-ara-archive ntpd[20276]: available at https://www.nwtime.org/support
Sep 12 01:46:54 js2-perfsonar-ara-archive ntpd[20276]: ----------------------------------------------------
Sep 12 01:46:54 js2-perfsonar-ara-archive ntpd[20284]: proto: precision = 0.050 usec (-24)
Sep 12 01:46:54 js2-perfsonar-ara-archive ntpd[20284]: basedate set to 2022-02-04
Sep 12 01:46:54 js2-perfsonar-ara-archive ntpd[20284]: gps base set to 2022-02-06 (week 2196)
Sep 12 01:46:54 js2-perfsonar-ara-archive ntpd[20284]: switching logging to file /var/log/ntpd
Sep 12 01:46:54 js2-perfsonar-ara-archive systemd[1]: Started Network Time Service.
root@js2-perfsonar-ara-archive:~#
```


```
curl -s https://downloads.perfsonar.net/install | sh -s - --auto-updates --add perfsonar-grafana --add perfsonar-grafana-toolkit --add perfsonar-psconfig-hostmetrics --add perfsonar-psconfig-publisher archive /tmp/perfSONAR-pSConfig-AraHaul.json
```

```
systemctl restart apache2
```

```
psconfig publish /tmp/perfSONAR-pSConfig-AraHaul.json
```

```
/usr/lib/perfsonar/archive/perfsonar-scripts/psconfig_archive.sh
```

### perfSONAR TestPoint on AraHaul at Wilson Hall

```
route add 8.8.8.8 gw 192.168.42.1 dev eth1
```
