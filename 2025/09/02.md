# Setting up perfSONAR archiver on JS2

```
root@perfsonar-archiver:~# systemctl status logstash
● logstash.service - logstash
     Loaded: loaded (/usr/lib/systemd/system/logstash.service; enabled; preset: enabled)
    Drop-In: /etc/systemd/system/logstash.service.d
             └─override.conf, timeout-override.conf
     Active: active (running) since Tue 2025-09-02 14:07:31 UTC; 6min ago
   Main PID: 12118 (java)
      Tasks: 109 (limit: 35946)
     Memory: 1.4G (peak: 1.4G)
        CPU: 1min 42.342s
     CGroup: /system.slice/logstash.service
             └─12118 /usr/share/logstash/jdk/bin/java -Xms1g -Xmx1g -Djava.awt.headless=true -Dfile.encoding=UTF-8 -Djruby.compile.invokedynamic=t>

Sep 02 14:07:44 perfsonar-archiver logstash[12118]: [2025-09-02T14:07:44,072][INFO ][logstash.filters.geoip   ][pscheduler] DatabaseManager is not>
Sep 02 14:07:44 perfsonar-archiver logstash[12118]: [2025-09-02T14:07:44,084][INFO ][logstash.filters.geoip   ][pscheduler] Using geoip database {>
Sep 02 14:07:44 perfsonar-archiver logstash[12118]: [2025-09-02T14:07:44,098][INFO ][logstash.javapipeline    ][pscheduler] Starting pipeline {:pi>
Sep 02 14:07:44 perfsonar-archiver logstash[12118]: [2025-09-02T14:07:44,897][INFO ][logstash.javapipeline    ][prometheus] Pipeline Java executio>
Sep 02 14:07:44 perfsonar-archiver logstash[12118]: [2025-09-02T14:07:44,921][INFO ][logstash.javapipeline    ][prometheus] Pipeline started {"pip>
Sep 02 14:07:45 perfsonar-archiver logstash[12118]: [2025-09-02T14:07:45,564][INFO ][logstash.javapipeline    ][pscheduler] Pipeline Java executio>
Sep 02 14:07:45 perfsonar-archiver logstash[12118]: [2025-09-02T14:07:45,678][INFO ][logstash.javapipeline    ][pscheduler] Pipeline started {"pip>
Sep 02 14:07:45 perfsonar-archiver logstash[12118]: [2025-09-02T14:07:45,680][INFO ][logstash.inputs.http     ][pscheduler][4d121e6e24f1d4243fae8c>
Sep 02 14:07:45 perfsonar-archiver logstash[12118]: [2025-09-02T14:07:45,690][INFO ][logstash.agent           ] Pipelines running {:count=>2, :run>
Sep 02 14:07:45 perfsonar-archiver logstash[12118]: /usr/share/logstash/vendor/bundle/jruby/3.1.0/gems/manticore-0.9.1-java/lib/manticore/client.r>
root@perfsonar-archiver:~#
```

```
root@perfsonar-archiver:~# systemctl status opensearch
● opensearch.service - OpenSearch
     Loaded: loaded (/usr/lib/systemd/system/opensearch.service; enabled; preset: enabled)
    Drop-In: /etc/systemd/system/opensearch.service.d
             └─override.conf
     Active: active (running) since Tue 2025-09-02 14:07:10 UTC; 7min ago
       Docs: https://opensearch.org/
   Main PID: 11578 (java)
      Tasks: 126 (limit: 35946)
     Memory: 9.0G (peak: 9.0G)
        CPU: 1min 46.725s
     CGroup: /system.slice/opensearch.service
             └─11578 /usr/share/opensearch/jdk/bin/java -Xshare:auto -Dopensearch.networkaddress.cache.ttl=60 -Dopensearch.networkaddress.cache.ne>

Sep 02 14:07:00 perfsonar-archiver systemd-entrypoint[11578]: WARNING: System::setSecurityManager has been called by org.opensearch.bootstrap.Open>
Sep 02 14:07:00 perfsonar-archiver systemd-entrypoint[11578]: WARNING: Please consider reporting this to the maintainers of org.opensearch.bootstr>
Sep 02 14:07:00 perfsonar-archiver systemd-entrypoint[11578]: WARNING: System::setSecurityManager will be removed in a future release
Sep 02 14:07:01 perfsonar-archiver systemd-entrypoint[11578]: Sep 02, 2025 2:07:01 PM sun.util.locale.provider.LocaleProviderAdapter <clinit>
Sep 02 14:07:01 perfsonar-archiver systemd-entrypoint[11578]: WARNING: COMPAT locale provider will be removed in a future release
Sep 02 14:07:01 perfsonar-archiver systemd-entrypoint[11578]: WARNING: A terminally deprecated method in java.lang.System has been called
Sep 02 14:07:01 perfsonar-archiver systemd-entrypoint[11578]: WARNING: System::setSecurityManager has been called by org.opensearch.bootstrap.Secu>
Sep 02 14:07:01 perfsonar-archiver systemd-entrypoint[11578]: WARNING: Please consider reporting this to the maintainers of org.opensearch.bootstr>
Sep 02 14:07:01 perfsonar-archiver systemd-entrypoint[11578]: WARNING: System::setSecurityManager will be removed in a future release
Sep 02 14:07:10 perfsonar-archiver systemd[1]: Started opensearch.service - OpenSearch.
root@perfsonar-archiver:~#
```

```
root@perfsonar-archiver:~# cat /etc/perfsonar/opensearch/logstash_login
perfsonar:XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXx.
```

```
root@perfsonar-archiver:~# psarchive troubleshoot
OpenSearch running ...... OK
Logstash running ...... OK
OpenSearch API (Localhost) ...... OK
Logstash Endpoint (Localhost) ...... OK
OpenSearch API (HTTPS Proxy) ...... OK
Logstash Proxy Credentials ...... OK
Logstash Endpoint (HTTPS Proxy) ...... OK
Logstash->OpenSearch Credentials ...... OK
Logstash->OpenSearch Authentication ...... OK
OpenSearch Data Exists ...... FAIL

There is no data in the database. This may be expected if this is a new archive and/or you have not yet setup measurements. If you reached this point, then the basic operations of your archive seem to be functioning. A good next step would be to login to a host running measurements and do the following:
1. Run pscheduler troubleshoot to make sure pScheduler is functioning
2. Run psconfig stats pscheduler to check if pSConfig is configuring pscheduler tests
3. If the measurement host is separate from this archive host, run psarchive troubleshoot --host ARCHIVE_HOSTNAME (replace ARCHIVE_HOSTNAME with the address of this host) from the measurement host

root@perfsonar-archiver:~# psarchive troubleshoot –skip-opensearch-data
usage: troubleshoot [-h] [--host HOST] [--quiet] [--skip-logstash-proxy] [--skip-opensearch-data]
troubleshoot: error: unrecognized arguments: –skip-opensearch-data
root@perfsonar-archiver:~# psarchive troubleshoot --skip-opensearch-data
OpenSearch running ...... OK
Logstash running ...... OK
OpenSearch API (Localhost) ...... OK
Logstash Endpoint (Localhost) ...... OK
OpenSearch API (HTTPS Proxy) ...... OK
Logstash Proxy Credentials ...... OK
Logstash Endpoint (HTTPS Proxy) ...... OK
Logstash->OpenSearch Credentials ...... OK
Logstash->OpenSearch Authentication ...... OK
root@perfsonar-archiver:~#
```

```
root@perfsonar-archiver:~# ls /etc/apache2/
apache2.conf  conf-available  conf-enabled  envvars  magic  mods-available  mods-enabled  ports.conf  sites-available  sites-enabled
root@perfsonar-archiver:~#
```

```
root@perfsonar-archiver:/var/log/apache2# systemctl status apache2
● apache2.service - The Apache HTTP Server
     Loaded: loaded (/usr/lib/systemd/system/apache2.service; enabled; preset: enabled)
     Active: active (running) since Tue 2025-09-02 14:07:32 UTC; 55min ago
       Docs: https://httpd.apache.org/docs/2.4/
    Process: 12622 ExecStart=/usr/sbin/apachectl start (code=exited, status=0/SUCCESS)
   Main PID: 12625 (apache2)
      Tasks: 71 (limit: 35946)
     Memory: 79.6M (peak: 81.1M)
        CPU: 2.519s
     CGroup: /system.slice/apache2.service
             ├─12625 /usr/sbin/apache2 -k start
             ├─12628 "elmond           " -k start
             ├─12629 "host_exporter    " -k start
             ├─12630 /usr/sbin/apache2 -k start
             └─12631 /usr/sbin/apache2 -k start

Sep 02 14:07:32 perfsonar-archiver systemd[1]: Starting apache2.service - The Apache HTTP Server...
Sep 02 14:07:32 perfsonar-archiver systemd[1]: Started apache2.service - The Apache HTTP Server.
root@perfsonar-archiver:/var/log/apache2#
```

# Setting up perfSonar measurement hosts on ARA

```
mckandes@ara-jbox:~$ nmap -Pn 149.165.151.187
Starting Nmap 7.80 ( https://nmap.org ) at 2025-09-02 10:15 CDT
Nmap scan report for perfsonar-archiver.sta160003.projects.jetstream-cloud.org (149.165.151.187)
Host is up (0.00066s latency).
Not shown: 997 closed ports
PORT    STATE    SERVICE
53/tcp  filtered domain
80/tcp  filtered http
443/tcp open     https

Nmap done: 1 IP address (1 host up) scanned in 1.35 seconds
mckandes@ara-jbox:~$
```

```
mckandes@ara-jbox:~$ curl -k https://149.165.151.187/logstash
<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<html><head>
<title>401 Unauthorized</title>
</head><body>
<h1>Unauthorized</h1>
<p>This server could not verify that you
are authorized to access the document
requested.  Either you supplied the wrong
credentials (e.g., bad password), or your
browser doesn't understand how to supply
the credentials required.</p>
<hr>
<address>Apache/2.4.58 (Ubuntu) Server at 149.165.151.187 Port 443</address>
</body></html>
mckandes@ara-jbox:~$
```

```
mckandes@ara-jbox:~$ ssh icicle@10.189.10.177

The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

To run a command as administrator (user "root"), use "sudo <command>".
See "man sudo_root" for details.

icicle@DataCenter-ComputeNode-Compute-001:~$ curl -k https://149.165.151.187/logstash
<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<html><head>
<title>401 Unauthorized</title>
</head><body>
<h1>Unauthorized</h1>
<p>This server could not verify that you
are authorized to access the document
requested.  Either you supplied the wrong
credentials (e.g., bad password), or your
browser doesn't understand how to supply
the credentials required.</p>
<hr>
<address>Apache/2.4.58 (Ubuntu) Server at 149.165.151.187 Port 443</address>
</body></html>
icicle@DataCenter-ComputeNode-Compute-001:~$
```

```
Setting up pscheduler-server (5.2.1-1) ...
debconf: unable to initialize frontend: Dialog
debconf: (No usable dialog-like program is installed, so the dialog based frontend cannot be used. at /usr/share/perl5/Debconf/FrontEnd/Dialog.pm line 78.)
debconf: falling back to frontend: Readline
Configuring pscheduler-server
-----------------------------

The pscheduler-server package must have a database installed and configured before it can be used. This can be optionally handled with dbconfig-common.

If you are an advanced database administrator and know that you want to perform this configuration manually, or if your database has already been installed and configured, you should refuse this option. Details on what needs to be done should most likely be provided in
/usr/share/doc/pscheduler-server.

Otherwise, you should probably choose this option.

Configure database for pscheduler-server with dbconfig-common? [yes/no]
```

# Reference(s):
- https://docs.perfsonar.net/install_debian.html
- https://docs.perfsonar.net/troubleshooting_overview.html
- https://docs.perfsonar.net/manage_logs.html
