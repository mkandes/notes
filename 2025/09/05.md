# Setting up perfSONAR on JS2 + ARA

### perfsonar-archive on JS2

```
mkandes@hardtack:~$ ssh ubuntu@149.165.154.129
The authenticity of host '149.165.154.129 (149.165.154.129)' can't be established.
ED25519 key fingerprint is SHA256:6bFn0wedKG5E4iz2PwGOiHyKKSGA2He6RSdvxRIknX4.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '149.165.154.129' (ED25519) to the list of known hosts.

 System information as of Fri Sep  5 21:12:02 UTC 2025

  System load:  0.0               Processes:               198
  Usage of /:   9.4% of 57.97GB   Users logged in:         0
  Memory usage: 1%                IPv4 address for enp1s0: 10.0.113.70
  Swap usage:   0%

══════════════════════════https://jetstream.status.io/══════════════════════════

Overall Jetstream2 Status:   Operational 

Active Status Items:
 ◦   Software packages fail to install or upgrade with APT 


════════════════════════════════════════════════════════════════════════════════

ubuntu@perfsonar-archive:~$ hostname -f
perfsonar-archive.js2local
ubuntu@perfsonar-archive:~$
```

```
ubuntu@perfsonar-archive:~$ sudo -i
root@perfsonar-archive:~# cd /tmp
root@perfsonar-archive:/tmp# vi 3by3.json
root@perfsonar-archive:/tmp# curl -s https://downloads.perfsonar.net/install | sh -s - --auto-updates \
--add perfsonar-grafana \
--add perfsonar-grafana-toolkit \
--add perfsonar-psconfig-hostmetrics \
--add perfsonar-psconfig-publisher \
archive /tmp/3by3.json 

#
# Starting perfSONAR installation 2025-09-05T22:23:22
#


#
# Installing prerequisites
#

Reading package lists...
Building dependency tree...
Reading state information...
curl is already the newest version (7.81.0-1ubuntu1.20).
curl set to manually installed.
software-properties-common is already the newest version (0.99.22.9).
software-properties-common set to manually installed.
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.

#
# Importing package lists and keys
#

  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   396  100   396    0     0   1689      0 --:--:-- --:--:-- --:--:--  1692
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  3867  100  3867    0     0  29794      0 --:--:-- --:--:-- --:--:-- 29976
gpg: keybox '/tmp/tmp.hh4zW2Bejs/keyring' created
gpg: key 351ED8279AFA4E0A: public key "perfSONAR Debian Archive Main Signing Key <debian@perfsonar.net>" imported
gpg: Total number processed: 1
gpg:               imported: 1
Hit:1 https://nvidia.github.io/libnvidia-container/stable/ubuntu18.04/amd64  InRelease
```

```
#
# Setting up pSConfig remotes
#

/tmp/3by3.json:
=== Grafana Agent ===
Added remote configuration /tmp/3by3.json

=== HostMetrics Agent ===
Added remote configuration /tmp/3by3.json



Installation completed successfully.

Output logged to /root/install-perfsonar-2025-09-05T22:23:22
root@perfsonar-archive:/tmp# psarchive troubleshoot
OpenSearch running ...... OK
Logstash running ...... OK
OpenSearch API (Localhost) ...... OK
Logstash Endpoint (Localhost) ...... OK
OpenSearch API (HTTPS Proxy) ...... OK
Logstash Proxy Credentials ...... OK
Logstash Endpoint (HTTPS Proxy) ...... OK
Logstash->OpenSearch Credentials ...... OK
Logstash->OpenSearch Authentication ...... OK
OpenSearch Data Exists ...... FAIL

There is no data in the database. This may be expected if this is a new archive and/or you have not yet setup measurements. If you reached this point, then the basic operations of your archive seem to be functioning. A good next step would be to login to a host running measurements and do the following:
1. Run pscheduler troubleshoot to make sure pScheduler is functioning
2. Run psconfig stats pscheduler to check if pSConfig is configuring pscheduler tests
3. If the measurement host is separate from this archive host, run psarchive troubleshoot --host ARCHIVE_HOSTNAME (replace ARCHIVE_HOSTNAME with the address of this host) from the measurement host

root@perfsonar-archive:/tmp# systemctl restart httpd
Failed to restart httpd.service: Unit httpd.service not found.
root@perfsonar-archive:/tmp# systemctl restart apache2
root@perfsonar-archive:/tmp# psconfig publish 3by3.json 

Success! File saved to /usr/lib/perfsonar/web-psconfig/3by3.json
Published file can be accessed at https://perfsonar-archive/psconfig/3by3.json
Execute the following on a host running an agent to use this file:
    psconfig remote add "https://perfsonar-archive/psconfig/3by3.json"

root@perfsonar-archive:/tmp#
```

### DataCenter_ComputeNode_Compute_000_perfSONAR_testpoint on ARA

```
mkandes@hardtack:~$ ssh -A ara
mckandes@ara-jbox:~$ ssh icicle@10.189.11.35

The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

To run a command as administrator (user "root"), use "sudo <command>".
See "man sudo_root" for details.

icicle@DataCenter-ComputeNode-Compute-000:~$
```

```
root@DataCenter-ComputeNode-Compute-000:/tmp# vi 3by3.json
root@DataCenter-ComputeNode-Compute-000:/tmp# cd /etc/perfsonar/
lsregistrationdaemon-logger.conf  psconfig/
lsregistrationdaemon.conf         toolkit/
root@DataCenter-ComputeNode-Compute-000:/tmp# cd /etc/perfsonar/psconfig/
root@DataCenter-ComputeNode-Compute-000:/etc/perfsonar/psconfig# ls
archives.d                    pscheduler-agent.json  transforms.d
pscheduler-agent-logger.conf  pscheduler.d
root@DataCenter-ComputeNode-Compute-000:/etc/perfsonar/psconfig# cd pscheduler.d/
root@DataCenter-ComputeNode-Compute-000:/etc/perfsonar/psconfig/pscheduler.d# ls
root@DataCenter-ComputeNode-Compute-000:/etc/perfsonar/psconfig/pscheduler.d# mv /tmp/3by3.json ./
root@DataCenter-ComputeNode-Compute-000:/etc/perfsonar/psconfig/pscheduler.d# cd ~/
root@DataCenter-ComputeNode-Compute-000:~# /usr/bin/supervisord -c /etc/supervisord.conf
2025-09-05 22:41:30,479 CRIT Supervisor is running as root.  Privileges were not dropped because no user is specified in the config file.  If you intend to run as root, you can set user=root in the config file to avoid this message.
2025-09-05 22:41:30,482 INFO RPC interface 'supervisor' initialized
2025-09-05 22:41:30,482 CRIT Server 'unix_http_server' running without any HTTP authentication checking
2025-09-05 22:41:30,482 INFO supervisord started with pid 25219
2025-09-05 22:41:31,484 INFO spawned: 'rsyslog' with pid 25220
2025-09-05 22:41:31,485 INFO spawned: 'owamp-server' with pid 25221
2025-09-05 22:41:31,486 INFO spawned: 'twamp-server' with pid 25222
2025-09-05 22:41:31,487 INFO spawned: 'postgresql' with pid 25223
2025-09-05 22:41:31,488 INFO spawned: 'pscheduler-ticker' with pid 25224
2025-09-05 22:41:31,489 INFO spawned: 'pscheduler-archiver' with pid 25225
2025-09-05 22:41:31,490 INFO spawned: 'pscheduler-scheduler' with pid 25228
2025-09-05 22:41:31,490 INFO spawned: 'pscheduler-runner' with pid 25229
2025-09-05 22:41:31,491 INFO spawned: 'apache2' with pid 25230
2025-09-05 22:41:31,492 INFO spawned: 'psconfig-pscheduler-agent' with pid 25231
2025-09-05 22:41:31,493 INFO spawned: 'perfsonar-host-exporter' with pid 25232
2025-09-05 22:41:31,494 INFO spawned: 'perfsonar-lsregistrationdaemon' with pid 25233
2025-09-05 22:41:31,511 INFO exited: perfsonar-host-exporter (exit status 2; not expected)
/usr/lib/pscheduler/daemons/ticker:110: DeprecationWarning: setDaemon() is deprecated, set the daemon attribute instead
  http_queue_worker.setDaemon(True)
2025-09-05 22:41:33,181 INFO success: rsyslog entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)
2025-09-05 22:41:33,181 INFO success: owamp-server entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)
2025-09-05 22:41:33,181 INFO success: twamp-server entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)
2025-09-05 22:41:33,181 INFO success: postgresql entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)
2025-09-05 22:41:33,181 INFO success: pscheduler-ticker entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)
2025-09-05 22:41:33,181 INFO success: pscheduler-archiver entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)
2025-09-05 22:41:33,181 INFO success: pscheduler-scheduler entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)
2025-09-05 22:41:33,181 INFO success: pscheduler-runner entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)
2025-09-05 22:41:33,181 INFO success: apache2 entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)
2025-09-05 22:41:33,181 INFO success: psconfig-pscheduler-agent entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)
2025-09-05 22:41:33,182 INFO spawned: 'perfsonar-host-exporter' with pid 25615
2025-09-05 22:41:33,183 INFO success: perfsonar-lsregistrationdaemon entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)
2025-09-05 22:41:33,200 INFO exited: perfsonar-host-exporter (exit status 2; not expected)
2025-09-05 22:41:35,203 INFO spawned: 'perfsonar-host-exporter' with pid 25629
2025-09-05 22:41:35,220 INFO exited: perfsonar-host-exporter (exit status 2; not expected)
2025-09-05 22:41:38,225 INFO spawned: 'perfsonar-host-exporter' with pid 25651
2025-09-05 22:41:38,242 INFO exited: perfsonar-host-exporter (exit status 2; not expected)
2025-09-05 22:41:39,243 INFO gave up: perfsonar-host-exporter entered FATAL state, too many start retries too quickly
```

### DataCenter_ComputeNode_Compute_001_perfSONAR_testpoint on ARA

```
mkandes@hardtack:~$ ssh -A ara
mckandes@ara-jbox:~$ ssh icicle@10.189.11.181

The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

To run a command as administrator (user "root"), use "sudo <command>".
See "man sudo_root" for details.

icicle@DataCenter-ComputeNode-Compute-001:~$
```

```
root@DataCenter-ComputeNode-Compute-001:~# /usr/bin/supervisord -c /etc/supervisord.conf
2025-09-05 22:42:35,490 CRIT Supervisor is running as root.  Privileges were not dropped because no user is specified in the config file.  If you intend to run as root, you can set user=root in the config file to avoid this message.
2025-09-05 22:42:35,493 INFO RPC interface 'supervisor' initialized
2025-09-05 22:42:35,493 CRIT Server 'unix_http_server' running without any HTTP authentication checking
2025-09-05 22:42:35,493 INFO supervisord started with pid 25214
2025-09-05 22:42:36,495 INFO spawned: 'rsyslog' with pid 25215
2025-09-05 22:42:36,496 INFO spawned: 'owamp-server' with pid 25216
2025-09-05 22:42:36,497 INFO spawned: 'twamp-server' with pid 25217
2025-09-05 22:42:36,497 INFO spawned: 'postgresql' with pid 25218
2025-09-05 22:42:36,498 INFO spawned: 'pscheduler-ticker' with pid 25219
2025-09-05 22:42:36,499 INFO spawned: 'pscheduler-archiver' with pid 25220
2025-09-05 22:42:36,500 INFO spawned: 'pscheduler-scheduler' with pid 25223
2025-09-05 22:42:36,501 INFO spawned: 'pscheduler-runner' with pid 25224
2025-09-05 22:42:36,502 INFO spawned: 'apache2' with pid 25225
2025-09-05 22:42:36,503 INFO spawned: 'psconfig-pscheduler-agent' with pid 25226
2025-09-05 22:42:36,504 INFO spawned: 'perfsonar-host-exporter' with pid 25227
2025-09-05 22:42:36,505 INFO spawned: 'perfsonar-lsregistrationdaemon' with pid 25228
2025-09-05 22:42:36,521 INFO exited: perfsonar-host-exporter (exit status 2; not expected)
/usr/lib/pscheduler/daemons/ticker:110: DeprecationWarning: setDaemon() is deprecated, set the daemon attribute instead
  http_queue_worker.setDaemon(True)
2025-09-05 22:42:38,146 INFO success: rsyslog entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)
2025-09-05 22:42:38,146 INFO success: owamp-server entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)
2025-09-05 22:42:38,146 INFO success: twamp-server entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)
2025-09-05 22:42:38,146 INFO success: postgresql entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)
2025-09-05 22:42:38,146 INFO success: pscheduler-ticker entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)
2025-09-05 22:42:38,146 INFO success: pscheduler-archiver entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)
2025-09-05 22:42:38,146 INFO success: pscheduler-scheduler entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)
2025-09-05 22:42:38,146 INFO success: pscheduler-runner entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)
2025-09-05 22:42:38,146 INFO success: apache2 entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)
2025-09-05 22:42:38,146 INFO success: psconfig-pscheduler-agent entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)
2025-09-05 22:42:38,147 INFO spawned: 'perfsonar-host-exporter' with pid 25610
2025-09-05 22:42:38,147 INFO success: perfsonar-lsregistrationdaemon entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)
2025-09-05 22:42:38,164 INFO exited: perfsonar-host-exporter (exit status 2; not expected)
2025-09-05 22:42:40,168 INFO spawned: 'perfsonar-host-exporter' with pid 25624
2025-09-05 22:42:40,185 INFO exited: perfsonar-host-exporter (exit status 2; not expected)
2025-09-05 22:42:43,190 INFO spawned: 'perfsonar-host-exporter' with pid 25645
2025-09-05 22:42:43,224 INFO exited: perfsonar-host-exporter (exit status 2; not expected)
2025-09-05 22:42:44,225 INFO gave up: perfsonar-host-exporter entered FATAL state, too many start retries too quickly
```

# Reference(s):
- https://github.com/preese/Step-by-step-to-perfSONAR-TPs-Archive
- https://www.youtube.com/watch?v=XkR5T6GYxIA
