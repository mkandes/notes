# How to install and run MLCFlow (on Expanse)

Let's use a JupyterLab session on Expanse for our development environment. 
You can launch a JupyterLab session on Exapsne with [galyleo](https://github.com/mkandes/galyleo). 
First, you need to put the location of galyleo in your [PATH](https://en.wikipedia.org/wiki/PATH_(variable)) environment variable.

*Command*:
```
export PATH="/cm/shared/apps/sdsc/galyleo:${PATH}"
```

*Output*:
```
[mkandes@login01 ~]$ export PATH="/cm/shared/apps/sdsc/galyleo:${PATH}"
[mkandes@login01 ~]$ echo $?
0
[mkandes@login01 ~]$
```

Once galyleo is in your PATH, you can run its launch command to create your JupyterLab session. 
For the REHS project this summer, we are targeting Expanse's GPU-accelerated compute nodes for our MLPerf Inference Benchmarks.
As such, we'll start by grabing a JupyterLab session on one of Expanse's gpu-debug nodes. 
But first, we need to define our software environment. 
Use the following conda environment yaml file as your starting point for developing a software environment that is compatible with MLCFlow and your specific MLPerf Inference Benchamrk.

```
name: mlcflow-dev

channels:
  - conda-forge
  - nvidia

dependencies:
  - python=3.9
  - pip
  - jupyterlab
  - cudatoolkit=11.8
  - cudnn
```

Create a copy of this yaml file in your [HOME](https://en.wikipedia.org/wiki/Home_directory) directory on Expanse.

```
[mkandes@login01 ~]$ echo $HOME
/home/mkandes
[mkandes@login01 ~]$ ls
data  mlcflow-dev.yaml  projects  references  scripts  software  tmp
[mkandes@login01 ~]$ cat mlcflow-dev.yaml 
name: mlcflow-dev

channels:
  - conda-forge
  - nvidia

dependencies:
  - python=3.9
  - pip
  - jupyterlab
  - cudatoolkit=11.8
  - cudnn
[mkandes@login01 ~]$
```

You're now ready to launch the JupyterLab session with this initial development environment.
Run the following galyleo launch command. Don't forget to change your account.

*Command*:
```
galyleo launch --account abc123 --partition gpu-debug --cpus 10 --memory 92 --gpus 1 --time-limit 00:30:00 --conda-yml mlcflow-dev.yaml
```

*Output*:
```
[mkandes@login01 ~]$ galyleo launch --account use300 --partition gpu-debug --cpus 10 --memory 92 --gpus 1 --time-limit 00:30:00 --conda-yml mlcflow-dev.yaml 
Preparing galyleo for launch into Jupyter orbit ...
Listing all launch parameters ...
  command-line options       : values
    -A | --account           : use300
    -R | --reservation       : 
    -p | --partition         : gpu-debug
    -q | --qos               : 
    -N | --nodes             : 1
    -c | --cpus              : 10
    -m | --memory            : 92 GB
    -g | --gpus              : 1
       | --gres              : 
    -t | --time-limit        : 00:30:00
    -C | --constraint        : 
    -i | --interface         : lab
    -d | --notebook-dir      : 
       | --scratch-dir       : "/scratch/${USER}/job_${SLURM_JOB_ID}"
    -e | --env-modules       : singularitypro
       | --append-modulepath : 
    -s | --sif               : 
    -B | --bind              : 
       | --nv                : 
       | --conda-init        : 
       | --conda-env         : 
       | --conda-yml         : /home/mkandes/mlcflow-dev.yaml
       | --conda-version     : latest
       | --mamba             : false
       | --cache             : false
       | --spark-home        : 
       | --disable-checklist : false
       | --checklist-timeout : 10 s
    -Q | --quiet             : 1
Your token is 
catatonic-supplier-gush
200
Generating Jupyter launch script ...
md5sum: mlcflow-dev.md5: No such file or directory
Submitted Jupyter launch script to Slurm. Your SLURM_JOB_ID is 40678928.
Success! Token linked to jobid.
Please copy and paste the HTTPS URL provided below into your web browser.
Do not share this URL with others. It is the password to your Jupyter notebook session.
Your Jupyter notebook session will begin once compute resources are allocated to your job by the scheduler.
https://catatonic-supplier-gush.expanse-user-content.sdsc.edu/?token=c006deeb55b1e399fcc84fb09c8e4218
[mkandes@login01 ~]$
```

Copy and paste the URL provided in your web broswer and then wait.
Once the job begins running, it will build a new copy of your conda environment and then open the JupyterLab session.
You can use JupyterLab's Terminal application to run command-line arguments within your conda environment --- e.g., `pip install mlcflow.
See how far the conda environment you've generate can support running your benchmark successfully. 
If you need to add additional software in the environment, you can modify it on the fly with conda and/or pip-based installs.
If you reach a point where you want to start from scratch, then go ahead and shutdown the JupyterLab session,
modify your conda yaml file with the new changes, and then start another development session with JupyterLab. 
This should allow you to iterate fairly quickly when making many changes to your conda environment. 

When you first start up a new JupyterLab session, you'll probably just want to make sure conda is setup correctly and installed all of the software you asked for.

```
mkandes@exp-7-59 ~]$ which conda
/scratch/mkandes/job_40678928/miniconda3/condabin/conda
[mkandes@exp-7-59 ~]$ conda env list

# conda environments:
#
base                   /scratch/mkandes/job_40678928/miniconda3
mlcflow-dev          * /scratch/mkandes/job_40678928/miniconda3/envs/mlcflow-dev

[mkandes@exp-7-59 ~]$ conda list
# packages in environment at /scratch/mkandes/job_40678928/miniconda3/envs/mlcflow-dev:
#
# Name                           Version          Build               Channel
_libgcc_mutex                    0.1              conda_forge         conda-forge
_openmp_mutex                    4.5              2_gnu               conda-forge
anyio                            4.9.0            pyh29332c3_0        conda-forge
argon2-cffi                      25.1.0           pyhd8ed1ab_0        conda-forge
argon2-cffi-bindings             21.2.0           py39h8cd3c5a_5      conda-forge
arrow                            1.3.0            pyhd8ed1ab_1        conda-forge
asttokens                        3.0.0            pyhd8ed1ab_1        conda-forge
async-lru                        2.0.5            pyh29332c3_0        conda-forge
attrs                            25.3.0           pyh71513ae_0        conda-forge
babel                            2.17.0           pyhd8ed1ab_0        conda-forge
beautifulsoup4                   4.13.4           pyha770c72_0        conda-forge
bleach                           6.2.0            pyh29332c3_4        conda-forge
bleach-with-css                  6.2.0            h82add2a_4          conda-forge
brotli-python                    1.1.0            py39hf88036b_3      conda-forge
bzip2                            1.0.8            h4bc722e_7          conda-forge
ca-certificates                  2025.6.15        hbd8a1cb_0          conda-forge
cached-property                  1.5.2            hd8ed1ab_1          conda-forge
cached_property                  1.5.2            pyha770c72_1        conda-forge
certifi                          2025.6.15        pyhd8ed1ab_0        conda-forge
cffi                             1.17.1           py39h15c3d72_0      conda-forge
charset-normalizer               3.4.2            pyhd8ed1ab_0        conda-forge
comm                             0.2.2            pyhd8ed1ab_1        conda-forge
cuda-version                     11.8             h70ddcb2_3          conda-forge
cudatoolkit                      11.8.0           h4ba93d1_13         conda-forge
cudnn                            9.10.1.4         haad7af6_0          conda-forge
debugpy                          1.8.14           py39hf88036b_0      conda-forge
decorator                        5.2.1            pyhd8ed1ab_0        conda-forge
defusedxml                       0.7.1            pyhd8ed1ab_0        conda-forge
exceptiongroup                   1.3.0            pyhd8ed1ab_0        conda-forge
executing                        2.2.0            pyhd8ed1ab_0        conda-forge
fqdn                             1.5.1            pyhd8ed1ab_1        conda-forge
h11                              0.16.0           pyhd8ed1ab_0        conda-forge
h2                               4.2.0            pyhd8ed1ab_0        conda-forge
hpack                            4.1.0            pyhd8ed1ab_0        conda-forge
httpcore                         1.0.9            pyh29332c3_0        conda-forge
httpx                            0.28.1           pyhd8ed1ab_0        conda-forge
hyperframe                       6.1.0            pyhd8ed1ab_0        conda-forge
idna                             3.10             pyhd8ed1ab_1        conda-forge
importlib-metadata               8.7.0            pyhe01879c_1        conda-forge
importlib_resources              6.5.2            pyhd8ed1ab_0        conda-forge
ipykernel                        6.29.5           pyh3099207_0        conda-forge
ipython                          8.18.1           pyh707e725_3        conda-forge
isoduration                      20.11.0          pyhd8ed1ab_1        conda-forge
jedi                             0.19.2           pyhd8ed1ab_1        conda-forge
jinja2                           3.1.6            pyhd8ed1ab_0        conda-forge
json5                            0.12.0           pyhd8ed1ab_0        conda-forge
jsonpointer                      3.0.0            py39hf3d152e_1      conda-forge
jsonschema                       4.24.0           pyhd8ed1ab_0        conda-forge
jsonschema-specifications        2025.4.1         pyh29332c3_0        conda-forge
jsonschema-with-format-nongpl    4.24.0           hd8ed1ab_0          conda-forge
jupyter-lsp                      2.2.5            pyhe01879c_2        conda-forge
jupyter_client                   8.6.3            pyhd8ed1ab_1        conda-forge
jupyter_core                     5.8.1            pyh31011fe_0        conda-forge
jupyter_events                   0.12.0           pyh29332c3_0        conda-forge
jupyter_server                   2.16.0           pyhe01879c_0        conda-forge
jupyter_server_terminals         0.5.3            pyhd8ed1ab_1        conda-forge
jupyterlab                       4.4.3            pyhd8ed1ab_0        conda-forge
jupyterlab_pygments              0.3.0            pyhd8ed1ab_2        conda-forge
jupyterlab_server                2.27.3           pyhd8ed1ab_1        conda-forge
keyutils                         1.6.1            h166bdaf_0          conda-forge
krb5                             1.21.3           h659f571_0          conda-forge
ld_impl_linux-64                 2.43             h1423503_5          conda-forge
libcudnn                         9.10.1.4         h7d33bf5_0          conda-forge
libcudnn-dev                     9.10.1.4         h0fdc2d1_0          conda-forge
libedit                          3.1.20250104     pl5321h7949ede_0    conda-forge
libexpat                         2.7.0            h5888daf_0          conda-forge
libffi                           3.4.6            h2dba641_1          conda-forge
libgcc                           15.1.0           h767d61c_3          conda-forge
libgcc-ng                        15.1.0           h69a702a_3          conda-forge
libgomp                          15.1.0           h767d61c_3          conda-forge
liblzma                          5.8.1            hb9d3cd8_2          conda-forge
libnsl                           2.0.1            hb9d3cd8_1          conda-forge
libsodium                        1.0.20           h4ab18f5_0          conda-forge
libsqlite                        3.50.1           h6cd9bfd_7          conda-forge
libstdcxx                        15.1.0           h8f9b012_3          conda-forge
libstdcxx-ng                     15.1.0           h4852527_3          conda-forge
libuuid                          2.38.1           h0b41bf4_0          conda-forge
libxcrypt                        4.4.36           hd590300_1          conda-forge
libzlib                          1.3.1            hb9d3cd8_2          conda-forge
markupsafe                       3.0.2            py39h9399b63_1      conda-forge
matplotlib-inline                0.1.7            pyhd8ed1ab_1        conda-forge
mistune                          3.1.3            pyh29332c3_0        conda-forge
nbclient                         0.10.2           pyhd8ed1ab_0        conda-forge
nbconvert-core                   7.16.6           pyh29332c3_0        conda-forge
nbformat                         5.10.4           pyhd8ed1ab_1        conda-forge
ncurses                          6.5              h2d0b736_3          conda-forge
nest-asyncio                     1.6.0            pyhd8ed1ab_1        conda-forge
notebook-shim                    0.2.4            pyhd8ed1ab_1        conda-forge
openssl                          3.5.0            h7b32b05_1          conda-forge
overrides                        7.7.0            pyhd8ed1ab_1        conda-forge
packaging                        25.0             pyh29332c3_1        conda-forge
pandocfilters                    1.5.0            pyhd8ed1ab_0        conda-forge
parso                            0.8.4            pyhd8ed1ab_1        conda-forge
pexpect                          4.9.0            pyhd8ed1ab_1        conda-forge
pickleshare                      0.7.5            pyhd8ed1ab_1004     conda-forge
pip                              25.1.1           pyh8b19718_0        conda-forge
pkgutil-resolve-name             1.3.10           pyhd8ed1ab_2        conda-forge
platformdirs                     4.3.8            pyhe01879c_0        conda-forge
prometheus_client                0.22.1           pyhd8ed1ab_0        conda-forge
prompt-toolkit                   3.0.51           pyha770c72_0        conda-forge
psutil                           7.0.0            py39h8cd3c5a_0      conda-forge
ptyprocess                       0.7.0            pyhd8ed1ab_1        conda-forge
pure_eval                        0.2.3            pyhd8ed1ab_1        conda-forge
pycparser                        2.22             pyh29332c3_1        conda-forge
pygments                         2.19.2           pyhd8ed1ab_0        conda-forge
pysocks                          1.7.1            pyha55dd90_7        conda-forge
python                           3.9.23           hc30ae73_0_cpython  conda-forge
python-dateutil                  2.9.0.post0      pyhff2d567_1        conda-forge
python-fastjsonschema            2.21.1           pyhd8ed1ab_0        conda-forge
python-json-logger               2.0.7            pyhd8ed1ab_0        conda-forge
python_abi                       3.9              7_cp39              conda-forge
pytz                             2025.2           pyhd8ed1ab_0        conda-forge
pyyaml                           6.0.2            py39h9399b63_2      conda-forge
pyzmq                            27.0.0           py39h4e4fb57_0      conda-forge
readline                         8.2              h8c095d6_2          conda-forge
referencing                      0.36.2           pyh29332c3_0        conda-forge
requests                         2.32.4           pyhd8ed1ab_0        conda-forge
rfc3339-validator                0.1.4            pyhd8ed1ab_1        conda-forge
rfc3986-validator                0.1.1            pyh9f0ad1d_0        conda-forge
rpds-py                          0.25.1           py39h20260ba_0      conda-forge
send2trash                       1.8.3            pyh0d859eb_1        conda-forge
setuptools                       80.9.0           pyhff2d567_0        conda-forge
six                              1.17.0           pyhd8ed1ab_0        conda-forge
sniffio                          1.3.1            pyhd8ed1ab_1        conda-forge
soupsieve                        2.7              pyhd8ed1ab_0        conda-forge
stack_data                       0.6.3            pyhd8ed1ab_1        conda-forge
terminado                        0.18.1           pyh0d859eb_0        conda-forge
tinycss2                         1.4.0            pyhd8ed1ab_0        conda-forge
tk                               8.6.13           noxft_hd72426e_102  conda-forge
tomli                            2.2.1            pyhd8ed1ab_1        conda-forge
tornado                          6.5.1            py39h8cd3c5a_0      conda-forge
traitlets                        5.14.3           pyhd8ed1ab_1        conda-forge
types-python-dateutil            2.9.0.20250516   pyhd8ed1ab_0        conda-forge
typing-extensions                4.14.0           h32cad80_0          conda-forge
typing_extensions                4.14.0           pyhe01879c_0        conda-forge
typing_utils                     0.1.0            pyhd8ed1ab_1        conda-forge
tzdata                           2025b            h78e105d_0          conda-forge
uri-template                     1.3.0            pyhd8ed1ab_1        conda-forge
urllib3                          2.5.0            pyhd8ed1ab_0        conda-forge
wcwidth                          0.2.13           pyhd8ed1ab_1        conda-forge
webcolors                        24.11.1          pyhd8ed1ab_0        conda-forge
webencodings                     0.5.1            pyhd8ed1ab_3        conda-forge
websocket-client                 1.8.0            pyhd8ed1ab_1        conda-forge
wheel                            0.45.1           pyhd8ed1ab_1        conda-forge
yaml                             0.2.5            h7f98852_2          conda-forge
zeromq                           4.3.5            h3b0a872_7          conda-forge
zipp                             3.23.0           pyhd8ed1ab_0        conda-forge
zstandard                        0.23.0           py39h8cd3c5a_2      conda-forge
[mkandes@exp-7-59 ~]$ 
```


# Reference(s):
- https://docs.mlcommons.org/mlcflow/
