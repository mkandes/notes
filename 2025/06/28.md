# How to install and run MLCFlow (on Expanse) [Part II]

```
[mkandes@exp-15-58 ~]$ mlc show cache
[2025-06-29 15:07:09,509 cache_action.py:101 INFO] - Showing cache with tags: None
[mkandes@exp-15-58 ~]$
```

```
[mkandes@exp-15-58 ~]$ mlc help cache

    ####################################################################################################################
    Cache Action
    ####################################################################################################################
    Currently, the following actions are supported for Cache:
    1. find/search
    2. show
    3. list
    4. remove(rm)

    
        Access function to simulate CLI actions in Python.

        Args:
        options (dict): Dictionary containing action and relevant parameters.
        
        Adds a new item to the repository.

        Args:
            i (dict): Input dictionary with the following keys:
                - item_repo (tuple): Repository alias and UID (default: local repo).
                - item (str): Item alias and optional UID in "alias,uid" format.
                - tags (str): Comma-separated tags.
                - new_tags (str): Additional comma-separated tags to add.
                - yaml (bool): Whether to save metadata in YAML format. Defaults to JSON.

        Returns:
            dict: Result of the operation with 'return' code and error/message if applicable.
        
    ####################################################################################################################
    Target: Cache
    Action: Find (Alias: Search)
    ####################################################################################################################

    The `find` (or `search`) action retrieves the path of cache generated by a particular script. 

    Syntax:

    mlc find cache --tags=<list_of_tag_used_to_run_the_particular_script> 

    Example Command:

    mlc find cache --tags=get,dataset,igbh

        
    ####################################################################################################################
    Target: Cache
    Action: List
    ####################################################################################################################

    Lists all cached items along with their paths.

    Example Command:

    mlc list cache

        
    ####################################################################################################################
    Target: Cache
    Action: Remove(rm)
    ####################################################################################################################

    The `rm` action removes one or more caches generated while running scripts through MLCFlow.

    Syntax:

    mlc rm cache --tags=<list_of_tag_used_to_run_the_particular_script> 

    Options:
        1. `-f`: Force removes caches without confirmation. Without `-f`, the user will be prompted for confirmation before deletion.

    To remove all generated caches, use:
        
    mlc rm cache

    Example Command:

    mlc rm cache --tags=get,dataset,igbh

        
    ####################################################################################################################
    Target: Cache
    Action: Find (Alias: Search)
    ####################################################################################################################

    The `find` (or `search`) action retrieves the path of cache generated by a particular script. 

    Syntax:

    mlc find cache --tags=<list_of_tag_used_to_run_the_particular_script> 

    Example Command:

    mlc find cache --tags=get,dataset,igbh

        
    ####################################################################################################################
    Target: Cache
    Action: Show
    ####################################################################################################################

    Retrieves the path and metadata of caches generated while running scripts through MLCFlow.
        
    Syntax:
        
    mlc show cache --tags=<list_of_tags_used_while_running_script>

    Example Command:

    mlc show cache --tags=get,dataset,igbh

    Note:
    - The `find` action is a subset of `show`. It retrieves only the path of the searched cache.

        
        Update the tags of found items based on the input.

        Args:
            i (dict): Input dictionary with:
                - tags (str): Comma-separated tags to search for.
                - search_tags (str): Tags to add/update in the found items' meta.

        Returns:
            dict: Return code and message.
        
[mkandes@exp-15-58 ~]$
```

```
[mkandes@exp-15-58 ~]$  mlc list cache
[2025-06-29 15:09:37,497 cache_action.py:154 INFO] - Listing all the caches and their paths
......................................................
[mkandes@exp-15-58 ~]$
```

```
[mkandes@exp-15-58 ~]$ mlcr help
[2025-06-29 15:10:19,467 module.py:576 INFO] - * mlcr help
Traceback (most recent call last):
  File "/scratch/mkandes/job_40744653/miniconda3/envs/mlcflow-dev/bin/mlcr", line 8, in <module>
    sys.exit(mlcr())
  File "/scratch/mkandes/job_40744653/miniconda3/envs/mlcflow-dev/lib/python3.9/site-packages/mlc/main.py", line 86, in mlcr
    main()
  File "/scratch/mkandes/job_40744653/miniconda3/envs/mlcflow-dev/lib/python3.9/site-packages/mlc/main.py", line 273, in main
    res = method(run_args)
  File "/scratch/mkandes/job_40744653/miniconda3/envs/mlcflow-dev/lib/python3.9/site-packages/mlc/script_action.py", line 309, in run
    return self.call_script_module_function("run", run_args)
  File "/scratch/mkandes/job_40744653/miniconda3/envs/mlcflow-dev/lib/python3.9/site-packages/mlc/script_action.py", line 244, in call_script_module_function
    raise ScriptExecutionError(f"Script {function_name} execution failed. Error : {error}")
mlc.script_action.ScriptExecutionError: Script run execution failed. Error : no scripts were found with tags: help (when variations ignored)
[mkandes@exp-15-58 ~]$
```

```
[mkandes@exp-15-58 ~]$ cat /scratch/mkandes/job_40744653/miniconda3/envs/mlcflow-dev/bin/mlcr
#!/scratch/mkandes/job_40744653/miniconda3/envs/mlcflow-dev/bin/python
# -*- coding: utf-8 -*-
import re
import sys
from mlc.main import mlcr
if __name__ == '__main__':
    sys.argv[0] = re.sub(r'(-script\.pyw|\.exe)?$', '', sys.argv[0])
    sys.exit(mlcr())
[mkandes@exp-15-58 ~]$ 
```

- https://github.com/mlcommons/mlperf-automations/blob/9a1f0fab584a3736d5964e0b0b78f3a6699f3c9f/.github/workflows/test-mlc-script-features.yml#L148
- https://github.com/mlcommons/mlperf-automations/blob/9a1f0fab584a3736d5964e0b0b78f3a6699f3c9f/docs/getting-started.md?plain=1#L33

```
[mkandes@exp-15-58 ~]$ mlcr detect,os -j
[2025-06-29 15:33:49,588 module.py:576 INFO] - * mlcr detect,os
[2025-06-29 15:33:49,624 module.py:5128 INFO] -        ! cd /home/mkandes
[2025-06-29 15:33:49,624 module.py:5129 INFO] -        ! call /home/mkandes/MLC/repos/mlcommons@mlperf-automations/script/detect-os/run.sh from tmp-run.sh
[2025-06-29 15:33:58,435 module.py:5274 INFO] -        ! call "postprocess" from /home/mkandes/MLC/repos/mlcommons@mlperf-automations/script/detect-os/customize.py
[2025-06-29 15:33:58,583 module.py:2197 INFO] - {
  "return": 0,
  "env": {
    "MLC_HOST_OS_TYPE": "linux",
    "MLC_HOST_OS_BITS": "64",
    "MLC_HOST_OS_FLAVOR": "rocky",
    "MLC_HOST_OS_FLAVOR_LIKE": "rhel centos fedora",
    "MLC_HOST_OS_VERSION": "8.9",
    "MLC_HOST_OS_KERNEL_VERSION": "4.18.0-513.24.1.el8_9.x86_64",
    "MLC_HOST_OS_GLIBC_VERSION": "2.28",
    "MLC_HOST_OS_MACHINE": "x86_64",
    "MLC_HOST_OS_PACKAGE_MANAGER": "dnf",
    "MLC_HOST_OS_PACKAGE_MANAGER_INSTALL_CMD": "dnf install -y",
    "MLC_HOST_OS_PACKAGE_MANAGER_UPDATE_CMD": "dnf update -y",
    "+MLC_HOST_OS_DEFAULT_LIBRARY_PATH": [
      "/usr/x86_64-redhat-linux/lib64",
      "/usr/lib64",
      "/usr/local/lib64",
      "/lib64",
      "/usr/x86_64-redhat-linux/lib",
      "/usr/local/lib",
      "/lib",
      "/usr/lib"
    ],
    "MLC_HOST_PLATFORM_FLAVOR": "x86_64",
    "MLC_HOST_PYTHON_BITS": "64",
    "MLC_HOST_SYSTEM_NAME": "exp-15-58"
  },
  "new_env": {
    "MLC_HOST_OS_TYPE": "linux",
    "MLC_HOST_OS_BITS": "64",
    "MLC_HOST_OS_FLAVOR": "rocky",
    "MLC_HOST_OS_FLAVOR_LIKE": "rhel centos fedora",
    "MLC_HOST_OS_VERSION": "8.9",
    "MLC_HOST_OS_KERNEL_VERSION": "4.18.0-513.24.1.el8_9.x86_64",
    "MLC_HOST_OS_GLIBC_VERSION": "2.28",
    "MLC_HOST_OS_MACHINE": "x86_64",
    "MLC_HOST_OS_PACKAGE_MANAGER": "dnf",
    "MLC_HOST_OS_PACKAGE_MANAGER_INSTALL_CMD": "dnf install -y",
    "MLC_HOST_OS_PACKAGE_MANAGER_UPDATE_CMD": "dnf update -y",
    "+MLC_HOST_OS_DEFAULT_LIBRARY_PATH": [
      "/usr/x86_64-redhat-linux/lib64",
      "/usr/lib64",
      "/usr/local/lib64",
      "/lib64",
      "/usr/x86_64-redhat-linux/lib",
      "/usr/local/lib",
      "/lib",
      "/usr/lib"
    ],
    "MLC_HOST_PLATFORM_FLAVOR": "x86_64",
    "MLC_HOST_PYTHON_BITS": "64",
    "MLC_HOST_SYSTEM_NAME": "exp-15-58"
  },
  "state": {
    "os_uname_machine": "x86_64",
    "os_uname_all": "Linux exp-15-58 4.18.0-513.24.1.el8_9.x86_64 #1 SMP Thu Apr 4 18:13:02 UTC 2024 x86_64 x86_64 x86_64 GNU/Linux"
  },
  "new_state": {
    "os_uname_machine": "x86_64",
    "os_uname_all": "Linux exp-15-58 4.18.0-513.24.1.el8_9.x86_64 #1 SMP Thu Apr 4 18:13:02 UTC 2024 x86_64 x86_64 x86_64 GNU/Linux"
  },
  "deps": []
}
[mkandes@exp-15-58 ~]$
```

```
mkandes@exp-15-58 ~]$ mlc help script

    ####################################################################################################################
    Script Action
    ####################################################################################################################

    The following actions are currently supported for scripts:
    1.  Add
    2.  Find
    3.  Show
    4.  Move(mv)
    5.  Remove(rm)
    6.  Copy(cp)
    7.  Run
    8.  Docker
    9.  Test
    10. Experiment

    Scripts in MLCFlow can be identified using different methods:

    Using tags: --tags=<comma-separated-tags> (e.g., --tags=detect,os)
    Using alias: <script_alias> (e.g., detect-os)
    Using UID: <script_uid> (e.g., 5b4e0237da074764)
    Using both alias and UID: <script_alias>,<script_uid> (e.g., detect-os,5b4e0237da074764)

    
        Access function to simulate CLI actions in Python.

        Args:
        options (dict): Dictionary containing action and relevant parameters.
        
    ####################################################################################################################
    Target: Script
    Action: Add
    ####################################################################################################################

    The `add` action creates a new script in a registered MLC repository.  

    Syntax:

    mlc add script <user@repo>:new_script --tags=benchmark

    Options:
        --template_tags: A comma-separated list of tags to create a new MLC script based on existing templates.  

    Example Output:
          
      arjun@intel-spr-i9:~$ mlc add script gateoverflow@mlperf-automations --tags=benchmark --template_tags=app,mlperf,inference
      More than one script found for None:
      1. /home/arjun/MLC/repos/gateoverflow@mlperf-automations/script/app-mlperf-inference-mlcommons-python
      2. /home/arjun/MLC/repos/gateoverflow@mlperf-automations/script/app-mlperf-inference-ctuning-cpp-tflite
      3. /home/arjun/MLC/repos/gateoverflow@mlperf-automations/script/app-mlperf-inference
      4. /home/arjun/MLC/repos/gateoverflow@mlperf-automations/script/app-mlperf-inference-mlcommons-cpp
      Select the correct one (enter number, default=1): 1
      [2025-02-14 02:58:33,453 main.py:664 INFO] - Folder successfully copied from /home/arjun/MLC/repos/
        gateoverflow@mlperf-automations/script/app-mlperf-inference-mlcommons-python to /home/arjun/MLC/repos/
        gateoverflow@mlperf-automations/script/gateoverflow@mlperf-automations

        
    ####################################################################################################################
    Target: Script
    Action: doc
    ####################################################################################################################

    The `doc` action creates automatic README for scripts from the contents in `meta.yaml`.  

    Example Command:

    mlc doc script --tags=detect,os

        
    ####################################################################################################################
    Target: Script
    Action: Docker
    ####################################################################################################################

    The `docker` action runs scripts inside a containerized environment.  

    An MLCFlow script can be executed inside a Docker container using either of the following syntaxes:

    1. Docker Run: mlc docker run --tags=<script tags> <run flags> (e.g., mlc docker run --tags=detect,os --docker_dt 
                       --docker_cache=no)
    2. Docker Script: mlc docker script --tags=<script tags> <run flags> (e.g., mlc docker script --tags=detect,os 
                          --docker_dt --docker_cache=no)

    Flags Available:

    1. --docker_dt or --docker_detached:
        Runs the specified script inside a Docker container in detached mode (e.g., `mlc docker run --tags=detect,os --docker_dt).
        By default, the Docker container is launched in interactive mode.
    2. --docker_cache:
        Disabling this flag forces Docker to build all layers from scratch, ignoring cached layers. (e.g., mlc docker run --tags=detect,os --docker_cache=no)
        By default, the value is set to true/yes.
    3. --docker_rebuild:
        Enables rebuilding the Docker container even if an existing container with the same tag is present. (e.g., mlc docker run --tags=detect,os --docker_rebuild)
        By default, the value is set to False.
    4. --dockerfile_recreate:
        Forces recreation of the **Dockerfile** during execution. (e.g., mlc docker run --tags=detect,os --docker_rebuild --dockerfile_recreate)
        By default, the value is set to False.

    Example Command:

    mlc docker script --tags=detect,os -j

        
    ####################################################################################################################
    Target: Script
    Action: Experiment
    ####################################################################################################################

    The `experiment` action currently does the function same as of run script, proper workflow will be added in future.
    experiment-specific functionality.

    Example Command:

    mlc experiment script --tags=detect,os -j

        
    ####################################################################################################################
    Target: Script
    Action: Find (Alias: Search)
    ####################################################################################################################

    The `find` (or `search`) action retrieves the path of scripts available in MLC repositories.

    Example Command:

    mlc find script --tags=detect,os -f

        
    ####################################################################################################################
    Target: Script
    Action: List
    ####################################################################################################################

    The `list` action displays all scripts and their paths from repositories registered in MLC.  

    Example Command:

    mlc list script

        
    ####################################################################################################################
    Target: Script
    Action: Remove(rm)
    ####################################################################################################################

    The `remove` (`rm`) action deletes one or more scripts from MLC repositories.  

    Example Command:

    mlc rm script --tags=detect,os -f

        
    ####################################################################################################################
    Target: Script
    Action: Run
    ####################################################################################################################

    The `run` action executes a script from an MLC repository.  

    Example Command:

    mlc run script --tags=detect,os -j

    Options:

    1. -j: Displays the output in JSON format.
    2. Instead of using `mlc run script --tags=`, you can simply use `mlcr`.
    3. *<Individual script inputs>: The `mlcr` command can accept additional inputs defined in the script's `input_mappings` metadata.  

        
    ####################################################################################################################
    Target: Script
    Action: Find (Alias: Search)
    ####################################################################################################################

    The `find` (or `search`) action retrieves the path of scripts available in MLC repositories.

    Example Command:

    mlc find script --tags=detect,os -f

        
    ####################################################################################################################
    Target: Script
    Action: Show
    ####################################################################################################################

    The `show` action retrieves the path and metadata of the searched script in MLC repositories.  

    Example Command:

    mlc show script --tags=detect,os

    Example Output:
          
      arjun@intel-spr-i9:~$ mlc show script --tags=detect,os
      [2025-02-14 02:56:16,604 main.py:1404 INFO] - Showing script with tags: detect,os
      Location: /home/arjun/MLC/repos/gateoverflow@mlperf-automations/script/detect-os:
      Main Script Meta:
        uid: 863735b7db8c44fc
        alias: detect-os
        tags: ['detect-os', 'detect', 'os', 'info']
        new_env_keys: ['MLC_HOST_OS_*', '+MLC_HOST_OS_*', 'MLC_HOST_PLATFORM_*', 'MLC_HOST_PYTHON_*', 'MLC_HOST_SYSTEM_NAME', 
                       'MLC_RUN_STATE_DOCKER', '+PATH']
        new_state_keys: ['os_uname_*']
      ......................................................
      For full script meta, see meta file at /home/arjun/MLC/repos/gateoverflow@mlperf-automations/script/detect-os/meta.yaml

    Note:
    - The `find` action is a subset of `show`, retrieving only the path of the searched script in MLC repositories.

        
    ####################################################################################################################
    Target: Script
    Action: test
    ####################################################################################################################

    The `test` action validates scripts that are configured with a `tests` section in `meta.yaml`.  

    Example Command:

    mlc test script --tags=benchmark

        
        Update the tags of found items based on the input.

        Args:
            i (dict): Input dictionary with:
                - tags (str): Comma-separated tags to search for.
                - search_tags (str): Tags to add/update in the found items' meta.

        Returns:
            dict: Return code and message.
        
[mkandes@exp-15-58 ~]$
```

